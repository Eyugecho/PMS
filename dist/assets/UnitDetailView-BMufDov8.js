import{P as M,l as B,a5 as V,R as f,r as a,j as e,bp as H,m,G as t,b as g,ai as S,f as A,h as y,u as Q,ao as G,ae as Z,af as J,ag as X,U as pe,V as ue,a2 as ee,a3 as te,q as re,t as se,v as ne,w as ae,x as C,y as h,z as ie,Z as oe,F as N,B as w,k as me,n as je,a as ge,g as fe}from"./index-DL-CLDEe.js";import{E as ce}from"./EarningCard-BMH7Gi22.js";import{D as ye}from"./DonutChart-ESgzekUH.js";const le=()=>{const c=B();V(),f.useState(null),f.useState(null);const[i,p]=f.useState(0),[k,l]=f.useState(0),[D,o]=f.useState(!1),P=()=>{o(!0),A().then(b=>{const x=y.api+y.getCount;fetch(x,{method:"GET",headers:{Authorization:`Bearer ${b}`,accept:"application/json","Content-Type":"application/json"}}).then(n=>n.json()).then(n=>{n.success?(p(n.data.used_kpis),l(n.data.my_kpi)):(p(0),l(0),toast.warning(n.message)),o(!1)}).catch(n=>{p(0),l(0),toast.warning(n.message),o(!1)})})};return a.useEffect(()=>{P()},[]),e.jsx(e.Fragment,{children:D?e.jsx(ce,{}):e.jsx(H,{border:!1,content:!1,children:e.jsx(m,{sx:{ml:1},children:e.jsxs(t,{container:!0,direction:"column",children:[e.jsx(t,{item:!0,children:e.jsx(t,{container:!0,justifyContent:"space-between",children:e.jsx(t,{item:!0,children:e.jsx(g,{variant:"h3",sx:{mt:1.2,color:"grey.500"},children:"KPI"})})})}),e.jsx(S,{sx:{borderBottom:.4,borderColor:c.palette.grey[300],marginY:3}}),e.jsx(t,{item:!0,sx:{mb:.75,cursor:"pointer"},children:e.jsxs(t,{container:!0,alignItems:"center",children:[e.jsx(t,{item:!0,xs:5,children:e.jsxs(t,{container:!0,alignItems:"center",children:[e.jsx(S,{orientation:"vertical",flexItem:!0,sx:{borderRightWidth:15,borderColor:"rgb(77, 173, 127)",mr:2,height:"9vh"}}),e.jsxs(t,{item:!0,sx:{mt:1},children:[e.jsx(g,{sx:{fontSize:"1rem",fontWeight:500,color:"grey.800"},children:"Total KPI"}),e.jsxs(g,{sx:{fontSize:"2.125rem",fontWeight:500,mr:1,mt:0,mb:.75},children:[i,e.jsx(g,{component:"span",sx:{fontSize:"0.75rem",verticalAlign:"sub"},children:"Number of KPI"})]})]})]})}),e.jsx(t,{item:!0,xs:0,children:e.jsx(S,{orientation:"vertical",flexItem:!0,sx:{borderRightWidth:.4,borderColor:c.palette.grey[300],height:"15vh",mr:5}})}),e.jsx(t,{item:!0,xs:5,children:e.jsxs(t,{container:!0,alignItems:"center",children:[e.jsx(S,{orientation:"vertical",flexItem:!0,sx:{borderRightWidth:15,borderColor:"rgb(234,170,103)",mr:2,height:"9vh"}}),e.jsxs(t,{item:!0,sx:{mt:1},children:[e.jsx(g,{sx:{fontSize:"1rem",fontWeight:500,color:"grey.800"},children:"Assigned KPI"}),e.jsxs(g,{sx:{fontSize:"2.125rem",fontWeight:500,mr:1,mt:0,mb:.75},children:[k,e.jsx(g,{component:"span",sx:{fontSize:"0.75rem",verticalAlign:"sub",color:"grey.500"},children:"Number of KPI"})]})]})]})})]})})]})})})})};le.propTypes={isLoading:M.bool};const be=()=>{var I;const[c,i]=a.useState([]),[p,k]=a.useState(!1),[l,D]=a.useState("quarter1"),o=Q(s=>s.customization.selectedFiscalYear),b=(I=G().state)==null?void 0:I.unitId,x=B(),n=async()=>{if(o&&b){k(!0);const s=await A(),j=y.api+y.unitEmployeeEndpoint+`${b}?fiscal_year_id=${o==null?void 0:o.id}`,E={Authorization:`Bearer ${s}`,accept:"application/json","Content-Type":"application/json"};try{const T=await(await fetch(j,{method:"GET",headers:E})).json();if(console.log(T),T.success){const K=T.data.map(r=>({id:r.id,name:r.name,performance:r.performance||[]}));i(K)}else i([]),w.warning(T.message)}catch(u){i([]),w.warning(u.message)}finally{k(!1)}}};a.useEffect(()=>{n()},[o,b]);const q=(s,j)=>{const E=s.find(u=>u[j]);return E?E[j].overall:0};return e.jsx(Z,{children:e.jsxs(J,{children:[e.jsx(S,{sx:{borderBottom:.4,borderColor:x.palette.grey[300],marginY:3}}),e.jsx(t,{container:!0,justifyContent:"space-between",children:e.jsx(t,{item:!0,children:e.jsx(g,{variant:"h3",sx:{mt:0,color:"grey.500"},children:"Employee Performance List"})})}),e.jsxs(t,{container:!0,justifyContent:"space-between",children:[e.jsx(t,{item:!0,sx:{mt:2},children:e.jsx(X,{})}),e.jsx(t,{item:!0,children:e.jsx(m,{mt:2,mb:0,textAlign:"right",children:e.jsxs(pe,{variant:"outlined",children:[e.jsx(ue,{id:"unit-select-label",children:"Select"}),e.jsx(ee,{value:l,onChange:s=>D(s.target.value),label:"Select Quarter",children:["quarter1","quarter2","quarter3","quarter4"].map(s=>e.jsx(te,{value:s,children:`Q${s.replace("quarter","")}`},s))})]})})})]}),e.jsx(m,{mt:1,children:e.jsx(re,{component:se,children:e.jsxs(ne,{children:[e.jsx(ae,{children:e.jsx(C,{children:["Employee Name","Overall Performance"].map(s=>e.jsx(h,{sx:{background:x.palette.grey[100],color:"#000",fontWeight:"bold",fontSize:"0.9rem",borderBottom:`2px solid ${x.palette.divider}`,position:"relative",padding:"12px 16px","&:not(:last-of-type)":{borderRight:`1px solid ${x.palette.divider}`}},children:s},s))})}),e.jsx(ie,{children:p?e.jsx(C,{children:e.jsx(h,{colSpan:2,children:e.jsx(m,{sx:{padding:2,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(oe,{size:22})})})}):c.length===0?e.jsx(C,{children:e.jsx(h,{colSpan:2,children:e.jsx(m,{sx:{paddingTop:6,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(N,{severity:"info",title:"No Data",description:"No employee performance records found"})})})}):c.map(s=>e.jsxs(C,{sx:{backgroundColor:x.palette.background.paper,borderRadius:2,"&:nth-of-type(odd)":{backgroundColor:x.palette.grey[50]},"&:hover":{backgroundColor:x.palette.grey[100],cursor:"pointer"}},children:[e.jsx(h,{sx:{border:0,padding:"12px 16px"},children:s.name}),e.jsx(h,{sx:{border:0,padding:"12px 16px"},children:q(s.performance,l)})]},s.id))})]})})})]})})},de=()=>{const c=B();V();const i=Q(v=>v.customization.selectedFiscalYear),p=G();f.useState(null),f.useState(null);const[k,l]=f.useState([]),[D,o]=f.useState([]),[P,b]=a.useState(0),[x,n]=a.useState(0),[q,I]=a.useState(0),[s,j]=a.useState(!0),[E,u]=f.useState(!1),[T,K]=a.useState(!1),{unitName:r,performance:L}=p.state||{},W=async()=>{const v=await A(),$=y.api+y.getEmployees,F={Authorization:`Bearer ${v}`,accept:"application/json","Content-Type":"application/json"};fetch($,{method:"GET",headers:F}).then(d=>d.json()).then(d=>{d.success?(I(d.data.employees),b(d.data.active_employee),n(d.data.inactive_employee),j(!1),u(!1)):(j(!1),u(!0))}).catch(d=>{w(d.message),u(!0),j(!1)})};a.useEffect(()=>{W()},[]);const Y=async()=>{if(i){K(!0);const v=await A(),$=y.api+y.myUnitPerformance+`?fiscal_year_id=${i==null?void 0:i.id}`,F={Authorization:`Bearer ${v}`,accept:"application/json","Content-Type":"application/json"};try{const z=await(await fetch($,{method:"GET",headers:F})).json();if(z.success){l(z.data.my_unit.performance);const xe=z.data.child_units.map(_=>{let O=0;const U=_.performance.length;for(let R=0;R<U;R++)O+=_.performance[R][`quarter${R+1}`].overall;const he=O/U;return{unitName:_.unit.name,performance:he}});o(xe)}else l([]),o([]),w.warning(z.message)}catch(d){l([]),o([]),w.warning(d.message)}finally{K(!1)}}else return e.jsx(me,{})};return a.useEffect(()=>{Y()},[i]),e.jsx(e.Fragment,{children:T?e.jsx(ce,{}):e.jsx(H,{border:!1,content:!1,children:e.jsx(m,{sx:{ml:1},children:e.jsxs(t,{container:!0,direction:"column",children:[e.jsx(t,{item:!0,children:e.jsx(t,{container:!0,justifyContent:"space-between",children:e.jsx(t,{item:!0,children:e.jsxs(g,{variant:"h3",sx:{mt:1.2,color:"grey.500"},children:[r,": Unit Performance"]})})})}),e.jsx(S,{sx:{borderBottom:.4,borderColor:c.palette.grey[300],marginY:3}}),e.jsx(t,{item:!0,sx:{mb:.75,cursor:"pointer"},children:e.jsx(t,{container:!0,alignItems:"center",children:e.jsx(t,{item:!0,xs:12,children:e.jsx(t,{container:!0,justifyContent:"center",alignItems:"center",children:e.jsx(t,{item:!0,children:e.jsx(ye,{value:L,size:250,label:"Ave. Performance"})})})})})})]})})})})};de.propTypes={isLoading:M.bool};const ve=()=>{var K;const[c,i]=a.useState({}),[p,k]=a.useState([]),[l,D]=a.useState("quarter1"),[o,P]=a.useState(!0),[b,x]=a.useState(!1),n=B(),I=(K=G().state)==null?void 0:K.unitId,s=Q(r=>r.customization.selectedFiscalYear),j=async()=>{if(!s||!I){w.error("Please select a unit and fiscal year"),P(!1);return}try{const r=await A(),L=`${y.api}${y.unitPerformance}${I}?fiscal_year_id=${s.id}`,W={Authorization:`Bearer ${r}`,accept:"application/json","Content-Type":"application/json"},v=await(await fetch(L,{method:"GET",headers:W})).json();if(v.success){const $=v.data.performance.reduce((F,d)=>{const z=Object.keys(d)[0];return F[z]=d[z],F},{});i($),k(Object.keys($)),P(!1)}else w.error(v.message||"Failed to fetch KPI data"),P(!1),x(!0)}catch(r){w.error(r.message),x(!0),P(!1)}};a.useEffect(()=>{j()},[I,s]);const E=r=>c[r]||{},u=()=>E(l).per_kpi||[],T=()=>E(l).overall||"N/A";return e.jsx(Z,{children:e.jsxs(J,{children:[e.jsx(S,{sx:{borderBottom:.4,borderColor:n.palette.grey[300],marginY:3}}),e.jsx(t,{container:!0,justifyContent:"space-between",children:e.jsx(t,{item:!0,children:e.jsx(g,{variant:"h3",sx:{mt:0,color:"grey.500"},children:"KPI List"})})}),e.jsxs(t,{container:!0,justifyContent:"space-between",children:[e.jsx(t,{item:!0,sx:{mt:2},children:e.jsx(X,{})}),e.jsx(t,{item:!0,children:e.jsx(m,{mt:1,mb:2,children:e.jsx(ee,{value:l,onChange:r=>D(r.target.value),displayEmpty:!0,fullWidth:!0,label:"Select Quarter",children:["quarter1","quarter2","quarter3","quarter4"].map(r=>e.jsx(te,{value:r,children:`Q${r.replace("quarter","")}`},r))})})})]}),e.jsx(m,{children:e.jsx(re,{component:se,children:e.jsxs(ne,{children:[e.jsx(ae,{children:e.jsx(C,{children:["KPI Name","Weight","KPI Performance","Overall Performance"].map(r=>e.jsx(h,{sx:{background:n.palette.grey[100],color:"#000",fontWeight:"bold",fontSize:"0.9rem",borderBottom:`2px solid ${n.palette.divider}`,position:"relative",padding:"12px 16px","&:not(:last-of-type)":{borderRight:`1px solid ${n.palette.divider}`}},children:r},r))})}),e.jsx(ie,{children:o?e.jsx(C,{children:e.jsx(h,{colSpan:4,children:e.jsx(m,{sx:{padding:2,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(oe,{size:22})})})}):b?e.jsx(C,{children:e.jsx(h,{colSpan:4,children:e.jsx(m,{sx:{padding:2,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(N,{severity:"error",title:"Server error",description:"Failed to fetch KPI data"})})})}):u().length===0?e.jsx(C,{children:e.jsx(h,{colSpan:4,children:e.jsx(m,{sx:{paddingTop:6,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(N,{severity:"info",title:"No Data",description:"No KPI records found for this quarter"})})})}):u().map((r,L)=>e.jsxs(C,{sx:{backgroundColor:n.palette.background.paper,borderRadius:2,"&:nth-of-type(odd)":{backgroundColor:n.palette.grey[50]},"&:hover":{backgroundColor:n.palette.grey[100]}},children:[e.jsx(h,{sx:{border:0,padding:"12px 16px"},children:r.name}),e.jsx(h,{sx:{border:0,padding:"12px 16px"},children:r.weight}),e.jsx(h,{sx:{border:0,padding:"12px 16px"},children:r.kpi_performance}),e.jsx(h,{sx:{border:0,padding:"12px 16px"},children:T()})]},L))})]})})})]})})},Ie=()=>{const[c,i]=a.useState(!0),p=B();return a.useEffect(()=>{i(!1)},[]),e.jsx(je,{maxWidth:"lg",title:"Reports",children:e.jsx(ge,{sx:{marginLeft:"10px",padding:"8px",marginTop:"25px"},children:e.jsx(t,{container:!0,spacing:fe,children:e.jsx(t,{item:!0,xs:12,children:e.jsxs(t,{container:!0,spacing:"0",children:[e.jsx(t,{item:!0,lg:6,md:6,sm:6,xs:12,children:e.jsx(le,{isLoading:c})}),e.jsx(t,{item:!0,xs:0,children:e.jsx(S,{orientation:"vertical",flexItem:!0,sx:{borderRightWidth:.4,borderColor:p.palette.grey[300],height:"36vh",ml:1}})}),e.jsx(t,{item:!0,lg:5.9,md:6,sm:6,xs:12,children:e.jsx(de,{isLoading:c})}),e.jsx(t,{item:!0,lg:6,md:6,sm:6,xs:12,children:e.jsx(ve,{isLoading:c})}),e.jsx(t,{item:!0,xs:0,children:e.jsx(S,{orientation:"vertical",flexItem:!0,sx:{borderRightWidth:.4,borderColor:p.palette.grey[300],height:"56vh",ml:1}})}),e.jsx(t,{item:!0,lg:5.9,md:6,sm:6,xs:12,children:e.jsx(be,{isLoading:c})})]})})})})})};export{Ie as default};
