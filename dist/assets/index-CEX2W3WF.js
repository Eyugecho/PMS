import{Y as fe,a3 as ee,az as ae,r as t,j as a,v as xe,a8 as R,aA as ye,ah as je,C as W,ag as Pe,p as Se,a5 as G,a2 as g,a6 as y,ak as ve,a9 as Ce,aB as _e,a0 as h,a1 as we,at as be,aC as De}from"./index-BrIZ1aRM.js";import{C as V,S as Ae,F as ke,D as Ie,I as Ee,U as Fe}from"./is-employee-YPZ_-uem.js";import{D as Ue}from"./DrogaButton-DGfkej71.js";import{a as Be,c as Te,D as $e}from"./DialogTitle-CTwNxPSd.js";import{A as ze}from"./Alert-CR4F7He2.js";import{A as Re}from"./AddButton-Z1cywGJl.js";import{P as Me}from"./PlanCard-CPi1QG3k.js";import{A as Ne}from"./ActivityIndicator-BsI2VQVz.js";import{E as Xe}from"./ErrorPrompt-BxXhExEH.js";import{F as qe}from"./index-CJagu-9E.js";import{D as Oe}from"./DeletePrompt-Bj6JOZh3.js";import{a as Ye}from"./axios-B2-DI6Hg.js";import{S as Ke}from"./search-f3t_tkff.js";import{S as Z}from"./SelectorMenu-BdKKm-gI.js";import{T as Ve}from"./TablePagination-Cpy0D8zw.js";import"./no_result-CfkzRtwQ.js";import"./TableRow-BXiBQlkf.js";import"./TableCell-BqWHfhA4.js";import"./Autocomplete-CLcyM-1B.js";import"./Close-BzhvbiYv.js";import"./index-C_-DKd_R.js";import"./IconPlus-CfO6zmqS.js";import"./DotMenu-7ewWz4Gi.js";import"./IconDotsVertical-TdrOCuv3.js";import"./IconTrash-7HD_GTTn.js";import"./DrogaDonutChart-BcPDFQqh.js";import"./error-DW4k7GIP.js";import"./Box-DiQAjjjZ.js";import"./KeyboardArrowRight-pfrJvB3H.js";import"./LastPage-C9NjV3u0.js";const Ge=({add:u,onClose:j,onSucceed:I})=>{const P=fe(),S=ee(n=>n.customization.selectedFiscalYear),{selectedKpi:f}=ae(),[E,v]=t.useState(!1),[r,C]=t.useState(0),[p,c]=t.useState({state:!1,message:""}),M=()=>{if(r===0){const n=Ae(f);n.valid?(c({...p,state:!1,message:""}),C(r+1)):c({...p,state:!0,message:n.errors[0]})}else if(r===1){const n=ke(f);n.valid?(c({...p,state:!1,message:""}),C(r+1)):c({...p,state:!0,message:n.errors[0]})}},F=()=>{c({...p,state:!1,message:""}),C(r-1)},U=()=>{const n=Ie(f);n.valid?(c({...p,state:!1,message:""}),N(f)):c({...p,state:!0,message:n.errors[0]})},N=async n=>{v(!0);const X=await G(),q=y.api+y.orgPlan,B={Authorization:`Bearer ${X}`,accept:"application/json","Content-Type":"application/json"},T={fiscal_year_id:S==null?void 0:S.id,data:n};fetch(q,{method:"POST",headers:B,body:JSON.stringify(T)}).then(l=>l.json()).then(l=>{var $;l.success?(g.success(l.message),I(),j()):g.error(($=l.data)==null?void 0:$.message)}).catch(l=>{g.error(l.message)}).finally(()=>{v(!1)})};return a.jsx(t.Fragment,{children:a.jsx(Be,{open:u,onClose:j,children:a.jsxs(xe,{sx:{minWidth:"600px",minHeight:"50dvh",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[a.jsxs("div",{children:[a.jsxs(R,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingRight:1},children:[a.jsx(Te,{variant:"h3",color:P.palette.text.primary,children:V[r].name}),a.jsx(ye.div,{whileHover:{rotate:90},transition:{duration:.3},style:{cursor:"pointer",marginRight:10},onClick:j,children:a.jsx(je,{size:"1.4rem",stroke:2})})]}),a.jsx(R,{sx:{padding:3},children:V[r].component})]}),a.jsxs($e,{sx:{paddingX:3,paddingBottom:2},children:[p.state&&a.jsxs(ze,{severity:"error",children:[" ",p.message]}),r>0&&a.jsx(W,{onClick:()=>F(),sx:{paddingX:4,paddingY:1,marginRight:2},children:"Back"}),r===V.length-1?a.jsx(W,{type:"submit",variant:"contained",sx:{py:1,paddingX:6,boxShadow:0,borderRadius:2},onClick:()=>U(),children:E?a.jsx(Pe,{size:18,sx:{color:"white"}}):a.jsx(Se,{variant:"subtitle1",color:P.palette.background.paper,children:"Submit"})}):a.jsx(Ue,{type:"button",title:"Next",variant:"contained",sx:{paddingX:6,paddingY:1,boxShadow:0},onPress:()=>M()})]})]})})})},_a=()=>{var L;const u=ee(e=>e.customization.selectedFiscalYear),j=ve(),I=Ee(),{handleUpdatePlan:P}=ae(),[S,f]=t.useState(!1),[E,v]=t.useState(!0),[r,C]=t.useState([]),[p,c]=t.useState(!1),[M,F]=t.useState(!1),[U,N]=t.useState(!0),[n,X]=t.useState(),[q,B]=t.useState(!1),[T,l]=t.useState(!1),[$,H]=t.useState(!1),[O,te]=t.useState(""),[Y]=t.useState([{label:"Perspectives Type",value:""}]),[K]=t.useState([{label:"Measuring Unit",value:""}]),[x,ne]=t.useState({m_unit:"",perspective:""}),[o,z]=t.useState({page:0,per_page:10,total:0}),se=e=>{const s=e.target.value;te(s),z({...o,page:0})},J=e=>{const{value:s,name:d}=e.target;ne({...x,[d]:s})},ie=(e,s)=>{z({...o,page:s})},oe=e=>{z({...o,per_page:e.target.value,page:0})},re=()=>{F(!0)},le=()=>{F(!1)},pe=e=>{var i,w,b,D,A,k;const s={id:e==null?void 0:e.kpi_id,f_name:(i=e==null?void 0:e.frequency)==null?void 0:i.name,f_value:(w=e==null?void 0:e.frequency)==null?void 0:w.value,frequency_id:e==null?void 0:e.frequency_id,mu:(D=(b=e==null?void 0:e.kpi)==null?void 0:b.measuring_unit)==null?void 0:D.name,name:(A=e==null?void 0:e.kpi)==null?void 0:A.name,total_target:e==null?void 0:e.total_target,weight:e==null?void 0:e.weight},d=(k=e==null?void 0:e.target)==null?void 0:k.map(m=>({period_id:m==null?void 0:m.period_id,target:m==null?void 0:m.target}));P([{...s,targets:d}]),De.setItem("selectFiscal",JSON.stringify({id:e==null?void 0:e.fiscal_year_id,year:""})),B(!0)},ce=e=>{pe(e)},de=()=>{P([]),B(!1)},me=e=>{X(e),l(!0)},ge=async()=>{H(!0);try{const e=await G(),s=y.api+y.deletePlan+`/${n==null?void 0:n.id}`,d=await Ye.delete(s,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});d.data.success?(l(!1),g.success(d.data.data.message),_()):g.error(d.data.data.message)}catch(e){g.error(e.message)}finally{H(!1)}},ue=e=>{Y.length<2&&e.forEach(s=>Y.push({label:s.name,value:s.id}))},he=e=>{K.length<2&&e.forEach(s=>K.push({label:s.name,value:s.id}))},_=async()=>{if(u){v(!0);const e=await G(),s=y.api+y.getMyPlans+`?fiscal_year_id=${u==null?void 0:u.id}&page=${o.page}&per_page=${o.per_page}&search=${O}&perspective_type_id=${x.perspective}&measuring_unit_id=${x.m_unit}`,d={Authorization:`Bearer ${e}`,accept:"application/json","Content-Type":"application/json"};fetch(s,{method:"GET",headers:d}).then(i=>i.json()).then(i=>{var w,b,D,A,k,m,Q;i.success?(C((b=(w=i.data)==null?void 0:w.plans)==null?void 0:b.data),N((D=i.data)==null?void 0:D.weightSum),ue((A=i.data)==null?void 0:A.perspectiveTypes),he((k=i.data)==null?void 0:k.measuringUnits),z({...o,total:(Q=(m=i.data)==null?void 0:m.plans)==null?void 0:Q.total}),c(!1)):(g.warning(i.data.message),c(!1))}).catch(i=>{g.warning(i.message),c(!0)}).finally(()=>{v(!1)})}};return t.useEffect(()=>{S?_():f(!0)},[u,o.page,o.per_page,x]),t.useEffect(()=>{const e=setTimeout(()=>{_()},600);return()=>{clearTimeout(e)}},[O]),a.jsxs(Ce,{title:"Planning",rightOption:!I&&a.jsx(_e,{title:U?"Already Planned 100%":"",arrow:!0,children:a.jsx(Re,{props:{varaint:"contained"},title:"Create new plan",onPress:()=>re(),disable:U})}),children:[a.jsxs(h,{container:!0,sx:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:3.8,px:2},children:[a.jsx(h,{item:!0,xs:12,sm:12,md:4,lg:2.6,xl:2,children:a.jsx(Ke,{value:O,onChange:e=>se(e)})}),a.jsx(h,{item:!0,xs:12,sm:12,md:6,children:a.jsxs(R,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:[a.jsx(Z,{name:"perspective",options:Y,selected:x.perspective,handleSelection:J}),a.jsx(R,{sx:{marginLeft:2},children:a.jsx(Z,{name:"m_unit",options:K,selected:x.m_unit,handleSelection:J})})]})})]}),E?a.jsx(h,{container:!0,children:a.jsx(h,{item:!0,xs:12,sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",padding:8},children:a.jsx(Ne,{size:20})})}):p?a.jsx(Xe,{title:"Server Error",message:"Unable to retrive fiscal years"}):r.length===0?a.jsx(qe,{severity:"planning",title:"Plan is not found",description:"The list of added plan will be listed here",sx:{paddingTop:6}}):a.jsx(h,{container:!0,sx:{paddingY:1,paddingX:2,marginTop:.2},spacing:we,children:r.map((e,s)=>a.jsx(h,{item:!0,xs:12,sm:12,md:6,lg:4,xl:3,children:a.jsx(Me,{plan:e,onPress:()=>j("/planning/view",{state:e}),onEdit:()=>ce(e),onDelete:()=>me(e),editInitiative:!0,is_employee:I})},s))}),!E&&o.total>o.per_page&&a.jsx(Ve,{component:"div",rowsPerPageOptions:[10,25,50,100],count:o.total,rowsPerPage:o.per_page,page:o.page,onPageChange:ie,onRowsPerPageChange:oe,labelRowsPerPage:"Plans per page"}),a.jsx(Ge,{add:M,onClose:le,onSucceed:()=>_()}),a.jsx(Fe,{add:q,onClose:de,onSucceed:()=>_()}),T&&a.jsx(Oe,{type:"Delete",open:T,title:"Deleting Plan",description:"Are you sure you want to delete "+((L=n==null?void 0:n.kpi)==null?void 0:L.name),onNo:()=>l(!1),onYes:()=>ge(),deleting:$,handleClose:()=>l(!1)}),a.jsx(be,{})]})};export{_a as default};
