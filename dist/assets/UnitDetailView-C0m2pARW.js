import{P as M,Y as B,ak as H,R as f,r as a,j as e,b1 as V,a8 as u,a0 as t,p as g,as as C,a5 as A,a6 as y,a3 as Q,ay as G,aq as J,ar as X,S as me,U as he,ai as Z,aj as ee,v as te,ag as re,a2 as w,a7 as ue,a9 as je,a4 as ge,a1 as fe}from"./index-BrIZ1aRM.js";import{E as se}from"./EarningCard-JiNwFFwY.js";import{S as ne}from"./search-f3t_tkff.js";import{F as N}from"./index-CJagu-9E.js";import{T as ae}from"./TableContainer-CbJxeCPv.js";import{T as oe,a as ie,b as S,c as ce}from"./TableRow-BXiBQlkf.js";import{T as p}from"./TableCell-BqWHfhA4.js";import{D as ye}from"./DonutChart-VpkdtP8-.js";import"./error-DW4k7GIP.js";const le=()=>{const c=B();H(),f.useState(null),f.useState(null);const[o,m]=f.useState(0),[k,l]=f.useState(0),[D,i]=f.useState(!1),P=()=>{i(!0),A().then(b=>{const x=y.api+y.getCount;fetch(x,{method:"GET",headers:{Authorization:`Bearer ${b}`,accept:"application/json","Content-Type":"application/json"}}).then(n=>n.json()).then(n=>{n.success?(m(n.data.used_kpis),l(n.data.my_kpi)):(m(0),l(0),toast.warning(n.message)),i(!1)}).catch(n=>{m(0),l(0),toast.warning(n.message),i(!1)})})};return a.useEffect(()=>{P()},[]),e.jsx(e.Fragment,{children:D?e.jsx(se,{}):e.jsx(V,{border:!1,content:!1,children:e.jsx(u,{sx:{ml:1},children:e.jsxs(t,{container:!0,direction:"column",children:[e.jsx(t,{item:!0,children:e.jsx(t,{container:!0,justifyContent:"space-between",children:e.jsx(t,{item:!0,children:e.jsx(g,{variant:"h3",sx:{mt:1.2,color:"grey.500"},children:"KPI"})})})}),e.jsx(C,{sx:{borderBottom:.4,borderColor:c.palette.grey[300],marginY:3}}),e.jsx(t,{item:!0,sx:{mb:.75,cursor:"pointer"},children:e.jsxs(t,{container:!0,alignItems:"center",children:[e.jsx(t,{item:!0,xs:5,children:e.jsxs(t,{container:!0,alignItems:"center",children:[e.jsx(C,{orientation:"vertical",flexItem:!0,sx:{borderRightWidth:15,borderColor:"rgb(77, 173, 127)",mr:2,height:"9vh"}}),e.jsxs(t,{item:!0,sx:{mt:1},children:[e.jsx(g,{sx:{fontSize:"1rem",fontWeight:500,color:"grey.800"},children:"Total KPI"}),e.jsxs(g,{sx:{fontSize:"2.125rem",fontWeight:500,mr:1,mt:0,mb:.75},children:[o,e.jsx(g,{component:"span",sx:{fontSize:"0.75rem",verticalAlign:"sub"},children:"Number of KPI"})]})]})]})}),e.jsx(t,{item:!0,xs:0,children:e.jsx(C,{orientation:"vertical",flexItem:!0,sx:{borderRightWidth:.4,borderColor:c.palette.grey[300],height:"15vh",mr:5}})}),e.jsx(t,{item:!0,xs:5,children:e.jsxs(t,{container:!0,alignItems:"center",children:[e.jsx(C,{orientation:"vertical",flexItem:!0,sx:{borderRightWidth:15,borderColor:"rgb(234,170,103)",mr:2,height:"9vh"}}),e.jsxs(t,{item:!0,sx:{mt:1},children:[e.jsx(g,{sx:{fontSize:"1rem",fontWeight:500,color:"grey.800"},children:"Assigned KPI"}),e.jsxs(g,{sx:{fontSize:"2.125rem",fontWeight:500,mr:1,mt:0,mb:.75},children:[k,e.jsx(g,{component:"span",sx:{fontSize:"0.75rem",verticalAlign:"sub",color:"grey.500"},children:"Number of KPI"})]})]})]})})]})})]})})})})};le.propTypes={isLoading:M.bool};const be=()=>{var I;const[c,o]=a.useState([]),[m,k]=a.useState(!1),[l,D]=a.useState("quarter1"),i=Q(s=>s.customization.selectedFiscalYear),b=(I=G().state)==null?void 0:I.unitId,x=B(),n=async()=>{if(i&&b){k(!0);const s=await A(),j=y.api+y.unitEmployeeEndpoint+`${b}?fiscal_year_id=${i==null?void 0:i.id}`,T={Authorization:`Bearer ${s}`,accept:"application/json","Content-Type":"application/json"};try{const E=await(await fetch(j,{method:"GET",headers:T})).json();if(console.log(E),E.success){const K=E.data.map(r=>({id:r.id,name:r.name,performance:r.performance||[]}));o(K)}else o([]),w.warning(E.message)}catch(h){o([]),w.warning(h.message)}finally{k(!1)}}};a.useEffect(()=>{n()},[i,b]);const q=(s,j)=>{const T=s.find(h=>h[j]);return T?T[j].overall:0};return e.jsx(J,{children:e.jsxs(X,{children:[e.jsx(C,{sx:{borderBottom:.4,borderColor:x.palette.grey[300],marginY:3}}),e.jsx(t,{container:!0,justifyContent:"space-between",children:e.jsx(t,{item:!0,children:e.jsx(g,{variant:"h3",sx:{mt:0,color:"grey.500"},children:"Employee Performance List"})})}),e.jsxs(t,{container:!0,justifyContent:"space-between",children:[e.jsx(t,{item:!0,sx:{mt:2},children:e.jsx(ne,{})}),e.jsx(t,{item:!0,children:e.jsx(u,{mt:2,mb:0,textAlign:"right",children:e.jsxs(me,{variant:"outlined",children:[e.jsx(he,{id:"unit-select-label",children:"Select"}),e.jsx(Z,{value:l,onChange:s=>D(s.target.value),label:"Select Quarter",children:["quarter1","quarter2","quarter3","quarter4"].map(s=>e.jsx(ee,{value:s,children:`Q${s.replace("quarter","")}`},s))})]})})})]}),e.jsx(u,{mt:1,children:e.jsx(ae,{component:te,children:e.jsxs(oe,{children:[e.jsx(ie,{children:e.jsx(S,{children:["Employee Name","Overall Performance"].map(s=>e.jsx(p,{sx:{background:x.palette.grey[100],color:"#000",fontWeight:"bold",fontSize:"0.9rem",borderBottom:`2px solid ${x.palette.divider}`,position:"relative",padding:"12px 16px","&:not(:last-of-type)":{borderRight:`1px solid ${x.palette.divider}`}},children:s},s))})}),e.jsx(ce,{children:m?e.jsx(S,{children:e.jsx(p,{colSpan:2,children:e.jsx(u,{sx:{padding:2,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(re,{size:22})})})}):c.length===0?e.jsx(S,{children:e.jsx(p,{colSpan:2,children:e.jsx(u,{sx:{paddingTop:6,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(N,{severity:"info",title:"No Data",description:"No employee performance records found"})})})}):c.map(s=>e.jsxs(S,{sx:{backgroundColor:x.palette.background.paper,borderRadius:2,"&:nth-of-type(odd)":{backgroundColor:x.palette.grey[50]},"&:hover":{backgroundColor:x.palette.grey[100],cursor:"pointer"}},children:[e.jsx(p,{sx:{border:0,padding:"12px 16px"},children:s.name}),e.jsx(p,{sx:{border:0,padding:"12px 16px"},children:q(s.performance,l)})]},s.id))})]})})})]})})},de=()=>{const c=B();H();const o=Q(v=>v.customization.selectedFiscalYear),m=G();f.useState(null),f.useState(null);const[k,l]=f.useState([]),[D,i]=f.useState([]),[P,b]=a.useState(0),[x,n]=a.useState(0),[q,I]=a.useState(0),[s,j]=a.useState(!0),[T,h]=f.useState(!1),[E,K]=a.useState(!1),{unitName:r,performance:L}=m.state||{},W=async()=>{const v=await A(),$=y.api+y.getEmployees,F={Authorization:`Bearer ${v}`,accept:"application/json","Content-Type":"application/json"};fetch($,{method:"GET",headers:F}).then(d=>d.json()).then(d=>{d.success?(I(d.data.employees),b(d.data.active_employee),n(d.data.inactive_employee),j(!1),h(!1)):(j(!1),h(!0))}).catch(d=>{w(d.message),h(!0),j(!1)})};a.useEffect(()=>{W()},[]);const Y=async()=>{if(o){K(!0);const v=await A(),$=y.api+y.myUnitPerformance+`?fiscal_year_id=${o==null?void 0:o.id}`,F={Authorization:`Bearer ${v}`,accept:"application/json","Content-Type":"application/json"};try{const z=await(await fetch($,{method:"GET",headers:F})).json();if(z.success){l(z.data.my_unit.performance);const xe=z.data.child_units.map(_=>{let O=0;const U=_.performance.length;for(let R=0;R<U;R++)O+=_.performance[R][`quarter${R+1}`].overall;const pe=O/U;return{unitName:_.unit.name,performance:pe}});i(xe)}else l([]),i([]),w.warning(z.message)}catch(d){l([]),i([]),w.warning(d.message)}finally{K(!1)}}else return e.jsx(ue,{})};return a.useEffect(()=>{Y()},[o]),e.jsx(e.Fragment,{children:E?e.jsx(se,{}):e.jsx(V,{border:!1,content:!1,children:e.jsx(u,{sx:{ml:1},children:e.jsxs(t,{container:!0,direction:"column",children:[e.jsx(t,{item:!0,children:e.jsx(t,{container:!0,justifyContent:"space-between",children:e.jsx(t,{item:!0,children:e.jsxs(g,{variant:"h3",sx:{mt:1.2,color:"grey.500"},children:[r,": Unit Performance"]})})})}),e.jsx(C,{sx:{borderBottom:.4,borderColor:c.palette.grey[300],marginY:3}}),e.jsx(t,{item:!0,sx:{mb:.75,cursor:"pointer"},children:e.jsx(t,{container:!0,alignItems:"center",children:e.jsx(t,{item:!0,xs:12,children:e.jsx(t,{container:!0,justifyContent:"center",alignItems:"center",children:e.jsx(t,{item:!0,children:e.jsx(ye,{value:L,size:250,label:"Ave. Performance"})})})})})})]})})})})};de.propTypes={isLoading:M.bool};const ve=()=>{var K;const[c,o]=a.useState({}),[m,k]=a.useState([]),[l,D]=a.useState("quarter1"),[i,P]=a.useState(!0),[b,x]=a.useState(!1),n=B(),I=(K=G().state)==null?void 0:K.unitId,s=Q(r=>r.customization.selectedFiscalYear),j=async()=>{if(!s||!I){w.error("Please select a unit and fiscal year"),P(!1);return}try{const r=await A(),L=`${y.api}${y.unitPerformance}${I}?fiscal_year_id=${s.id}`,W={Authorization:`Bearer ${r}`,accept:"application/json","Content-Type":"application/json"},v=await(await fetch(L,{method:"GET",headers:W})).json();if(v.success){const $=v.data.performance.reduce((F,d)=>{const z=Object.keys(d)[0];return F[z]=d[z],F},{});o($),k(Object.keys($)),P(!1)}else w.error(v.message||"Failed to fetch KPI data"),P(!1),x(!0)}catch(r){w.error(r.message),x(!0),P(!1)}};a.useEffect(()=>{j()},[I,s]);const T=r=>c[r]||{},h=()=>T(l).per_kpi||[],E=()=>T(l).overall||"N/A";return e.jsx(J,{children:e.jsxs(X,{children:[e.jsx(C,{sx:{borderBottom:.4,borderColor:n.palette.grey[300],marginY:3}}),e.jsx(t,{container:!0,justifyContent:"space-between",children:e.jsx(t,{item:!0,children:e.jsx(g,{variant:"h3",sx:{mt:0,color:"grey.500"},children:"KPI List"})})}),e.jsxs(t,{container:!0,justifyContent:"space-between",children:[e.jsx(t,{item:!0,sx:{mt:2},children:e.jsx(ne,{})}),e.jsx(t,{item:!0,children:e.jsx(u,{mt:1,mb:2,children:e.jsx(Z,{value:l,onChange:r=>D(r.target.value),displayEmpty:!0,fullWidth:!0,label:"Select Quarter",children:["quarter1","quarter2","quarter3","quarter4"].map(r=>e.jsx(ee,{value:r,children:`Q${r.replace("quarter","")}`},r))})})})]}),e.jsx(u,{children:e.jsx(ae,{component:te,children:e.jsxs(oe,{children:[e.jsx(ie,{children:e.jsx(S,{children:["KPI Name","Weight","KPI Performance","Overall Performance"].map(r=>e.jsx(p,{sx:{background:n.palette.grey[100],color:"#000",fontWeight:"bold",fontSize:"0.9rem",borderBottom:`2px solid ${n.palette.divider}`,position:"relative",padding:"12px 16px","&:not(:last-of-type)":{borderRight:`1px solid ${n.palette.divider}`}},children:r},r))})}),e.jsx(ce,{children:i?e.jsx(S,{children:e.jsx(p,{colSpan:4,children:e.jsx(u,{sx:{padding:2,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(re,{size:22})})})}):b?e.jsx(S,{children:e.jsx(p,{colSpan:4,children:e.jsx(u,{sx:{padding:2,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(N,{severity:"error",title:"Server error",description:"Failed to fetch KPI data"})})})}):h().length===0?e.jsx(S,{children:e.jsx(p,{colSpan:4,children:e.jsx(u,{sx:{paddingTop:6,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(N,{severity:"info",title:"No Data",description:"No KPI records found for this quarter"})})})}):h().map((r,L)=>e.jsxs(S,{sx:{backgroundColor:n.palette.background.paper,borderRadius:2,"&:nth-of-type(odd)":{backgroundColor:n.palette.grey[50]},"&:hover":{backgroundColor:n.palette.grey[100]}},children:[e.jsx(p,{sx:{border:0,padding:"12px 16px"},children:r.name}),e.jsx(p,{sx:{border:0,padding:"12px 16px"},children:r.weight}),e.jsx(p,{sx:{border:0,padding:"12px 16px"},children:r.kpi_performance}),e.jsx(p,{sx:{border:0,padding:"12px 16px"},children:E()})]},L))})]})})})]})})},ze=()=>{const[c,o]=a.useState(!0),m=B();return a.useEffect(()=>{o(!1)},[]),e.jsx(je,{maxWidth:"lg",title:"Reports",children:e.jsx(ge,{sx:{marginLeft:"10px",padding:"8px",marginTop:"25px"},children:e.jsx(t,{container:!0,spacing:fe,children:e.jsx(t,{item:!0,xs:12,children:e.jsxs(t,{container:!0,spacing:"0",children:[e.jsx(t,{item:!0,lg:6,md:6,sm:6,xs:12,children:e.jsx(le,{isLoading:c})}),e.jsx(t,{item:!0,xs:0,children:e.jsx(C,{orientation:"vertical",flexItem:!0,sx:{borderRightWidth:.4,borderColor:m.palette.grey[300],height:"36vh",ml:1}})}),e.jsx(t,{item:!0,lg:5.9,md:6,sm:6,xs:12,children:e.jsx(de,{isLoading:c})}),e.jsx(t,{item:!0,lg:6,md:6,sm:6,xs:12,children:e.jsx(ve,{isLoading:c})}),e.jsx(t,{item:!0,xs:0,children:e.jsx(C,{orientation:"vertical",flexItem:!0,sx:{borderRightWidth:.4,borderColor:m.palette.grey[300],height:"56vh",ml:1}})}),e.jsx(t,{item:!0,lg:5.9,md:6,sm:6,xs:12,children:e.jsx(be,{isLoading:c})})]})})})})})};export{ze as default};
