import{P as c,Y as S,j as e,a4 as R,a0 as r,p as h,R as O,a3 as te,r as m,a9 as ae,a8 as D,E as re,a5 as G,a6 as T,a2 as E,a7 as se}from"./index-BrIZ1aRM.js";import{S as ne}from"./search-f3t_tkff.js";import{A as F}from"./ActivityIndicator-BsI2VQVz.js";import{E as ie}from"./ErrorPrompt-BxXhExEH.js";import{F as U}from"./index-CJagu-9E.js";import{D as X}from"./DrogaButton-DGfkej71.js";import{P as q}from"./PerformanceCard-B4CFarf5.js";import{T as oe}from"./TablePagination-Cpy0D8zw.js";import"./error-DW4k7GIP.js";import"./DrogaDonutChart-BcPDFQqh.js";import"./KeyboardArrowRight-pfrJvB3H.js";import"./LastPage-C9NjV3u0.js";import"./TableCell-BqWHfhA4.js";const M=({name:s,unitType:g,manager:n,children:u,onView:o,sx:d})=>{const x=S();return e.jsx(R,{sx:{marginY:1,padding:1.4,paddingX:2,":hover":{transform:"scale(1.02)",transition:"all 0.2s ease-in-out",cursor:"pointer"},...d},onPress:o,children:e.jsxs(r,{container:!0,children:[e.jsx(r,{item:!0,xs:12,children:e.jsxs(r,{container:!0,sx:{display:"flex",alignItems:"flex-start"},children:[e.jsxs(r,{item:!0,xs:12,sm:4,md:4,lg:4,xl:4,children:[e.jsx(h,{variant:"subtitle2",sx:{color:x.palette.text.primary},children:"Unit"}),e.jsx(h,{variant:"h4",sx:{color:x.palette.text.primary,marginY:.6},children:s}),e.jsx(h,{variant:"body1",sx:{color:x.palette.text.primary},children:g&&g})]}),e.jsxs(r,{item:!0,xs:12,sm:4,md:4,lg:4,xl:4,children:[e.jsx(h,{variant:"subtitle2",sx:{color:x.palette.text.primary},children:"Unit Manager"}),e.jsx(h,{variant:"h4",sx:{color:x.palette.text.primary,marginY:1},children:n&&n})]}),e.jsx(r,{item:!0,xs:12,sm:4,md:4,lg:4,xl:4,sx:{display:"flex",alignItems:"center",justifyContent:{xs:"flex-start",sm:"flex-end"},padding:1.6},children:e.jsx(X,{variant:"outlined",color:"primary",title:"View",onPress:o})})]})}),e.jsx(r,{item:!0,xs:12,children:u})]})})};M.propTypes={name:c.string,unitType:c.string,manager:c.string,children:c.node,onView:c.func};const Q=({units:s,onView:g,selected:n,isLoading:u,performance:o})=>{const d=S(),x=t=>{g(t)};return e.jsx(O.Fragment,{children:s==null?void 0:s.map(t=>{var v,p,P;return e.jsx(M,{name:t==null?void 0:t.name,unitType:(v=t==null?void 0:t.unit_type)==null?void 0:v.name,manager:(P=(p=t==null?void 0:t.manager)==null?void 0:p.user)==null?void 0:P.name,onView:()=>x(t),sx:{backgroundColor:n===t.id&&d.palette.grey[50]},children:n===t.id&&(u?e.jsx(r,{container:!0,children:e.jsx(r,{item:!0,xs:12,sx:{display:"flex",alignItems:"center",justifyContent:"center",padding:2},children:e.jsx(F,{size:20})})}):o.length>0?e.jsx(r,{container:!0,sx:{marginTop:2,borderTop:.8,borderColor:d.palette.divider,padding:1},children:e.jsx(r,{item:!0,xs:12,sx:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:o==null?void 0:o.map((f,w)=>{var $;const i=Object.keys(f)[0],[b,y]=i.match(/[a-zA-Z]+|[0-9]+/g),C=`${b} ${y}`;return e.jsx(q,{isEvaluated:f[i].is_evaluated,performance:($=f[i])==null?void 0:$.overall,frequency:C},w)})})}):e.jsx(U,{severity:"performance",title:"No performance report",description:"The list of performances will be listed here",sx:{paddingTop:2}}))},t.id)})})};Q.propTypes={units:c.array,isLoading:c.bool,performance:c.array};const W=({name:s,gender:g,unit:n,position:u,children:o,onView:d,sx:x})=>{const t=S();return e.jsx(R,{sx:{marginY:1,padding:1.4,paddingX:2,":hover":{transform:"scale(1.02)",transition:"all 0.2s ease-in-out",cursor:"pointer"},...x},onPress:d,children:e.jsxs(r,{container:!0,children:[e.jsx(r,{item:!0,xs:12,children:e.jsxs(r,{container:!0,sx:{display:"flex",alignItems:"flex-start"},children:[e.jsxs(r,{item:!0,xs:12,sm:n?3:6,md:n?3:6,lg:n?3:6,xl:n?3:6,children:[e.jsx(h,{variant:"subtitle2",sx:{color:t.palette.text.primary},children:"Employee"}),e.jsx(h,{variant:"h4",sx:{color:t.palette.text.primary,marginY:.6},children:s}),e.jsx(h,{variant:"body1",sx:{color:t.palette.text.primary},children:g&&g})]}),n&&e.jsxs(r,{item:!0,xs:12,sm:3,md:3,lg:3,xl:3,children:[e.jsx(h,{variant:"subtitle2",sx:{color:t.palette.text.primary},children:"Unit"}),e.jsx(h,{variant:"h4",sx:{color:t.palette.text.primary,marginY:1},children:n&&n})]}),e.jsxs(r,{item:!0,xs:12,sm:3,md:3,lg:3,xl:3,children:[e.jsx(h,{variant:"subtitle2",sx:{color:t.palette.text.primary},children:"Position"}),e.jsx(h,{variant:"h4",sx:{color:t.palette.text.primary,marginY:1},children:u&&u})]}),e.jsx(r,{item:!0,xs:12,sm:3,md:3,lg:3,xl:3,sx:{display:"flex",alignItems:"center",justifyContent:{xs:"flex-start",sm:"flex-end"},padding:1.6},children:e.jsx(X,{variant:"outlined",color:"primary",title:"View",onPress:d})})]})}),e.jsx(r,{item:!0,xs:12,children:o})]})})};W.propTypes={name:c.string,gender:c.string,position:c.string,children:c.node,onView:c.func};const Z=({employees:s,onView:g,selected:n,isLoading:u,performance:o})=>{const d=S(),x=t=>{g(t)};return e.jsx(O.Fragment,{children:s==null?void 0:s.map(t=>{var v,p;return e.jsx(W,{name:(v=t==null?void 0:t.user)==null?void 0:v.name,gender:t.gender,unit:(p=t==null?void 0:t.unit)==null?void 0:p.name,position:t==null?void 0:t.position,onView:()=>x(t),sx:{backgroundColor:n===t.id&&d.palette.grey[50]},children:n===t.id&&(u?e.jsx(r,{container:!0,children:e.jsx(r,{item:!0,xs:12,sx:{display:"flex",alignItems:"center",justifyContent:"center",padding:2},children:e.jsx(F,{size:20})})}):o.length>0?e.jsx(r,{container:!0,sx:{marginTop:2,borderTop:.8,borderColor:d.palette.divider,padding:1},children:e.jsx(r,{item:!0,xs:12,sx:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:o==null?void 0:o.map((P,f)=>{var C;const w=Object.keys(P)[0],[i,b]=w.match(/[a-zA-Z]+|[0-9]+/g),y=`${i} ${b}`;return e.jsx(q,{isEvaluated:P[w].is_evaluated,performance:(C=P[w])==null?void 0:C.overall,frequency:y},f)})})}):e.jsx(U,{severity:"performance",title:"No performance report",description:"The list of performances will be listed here",sx:{paddingTop:2}}))},t.id)})})};Z.propTypes={employees:c.array,isLoading:c.bool,performance:c.array};const Pe=()=>{const s=te(a=>a.customization.selectedFiscalYear),[g,n]=m.useState(!1),[u,o]=m.useState(!0),[d,x]=m.useState([]),[t,v]=m.useState(!1),[p,P]=m.useState("units"),[f,w]=m.useState(""),[i,b]=m.useState({page:0,per_page:10,total:0}),[y,C]=m.useState(null),[$,V]=m.useState(!1),[L,_]=m.useState([]),H=a=>{P(a),a!==p&&I(a)},J=a=>{const j=a.target.value;w(j),b({...i,page:0})},K=(a,j)=>{b({...i,page:j})},ee=a=>{b({...i,per_page:a.target.value,page:0})},I=async a=>{o(!0);const j=await G(),k=T.api+T.getActiveDepartments+`?page=${i.page}&per_page=${i.per_page}&search=${f}`,A=T.api+T.getActiveEmployees+`?page=${i.page}&per_page=${i.per_page}&search=${f}`,Y=a=="employees"?A:k,z={Authorization:`Bearer ${j}`,accept:"application/json","Content-Type":"application/json"};fetch(Y,{method:"GET",headers:z}).then(l=>l.json()).then(l=>{l.success?(x(l.data.data),b({...i,total:l.data.total}),v(!1)):E.warning(l.data.message)}).catch(l=>{E.warning(l.message),v(!0)}).finally(()=>{o(!1)})},B=a=>{(a==null?void 0:a.id)===y?C(null):(C(a==null?void 0:a.id),N(a==null?void 0:a.id))},N=async a=>{if(s){V(!0);const j=await G(),k=T.api+T.unitPerformance+`${a}?fiscal_year_id=${s==null?void 0:s.id}`,A=T.api+T.employeePerformance+`${a}?fiscal_year_id=${s==null?void 0:s.id}`,Y=p=="employees"?A:k,z={Authorization:`Bearer ${j}`,accept:"application/json","Content-Type":"application/json"};fetch(Y,{method:"GET",headers:z}).then(l=>l.json()).then(l=>{l.success?(_(l.data.performance),console.log(l.data.performance)):(_([]),E.warning(l.data.message))}).catch(l=>{_([]),E.warning(l.message)}).finally(()=>{V(!1)})}else return e.jsx(se,{})};return m.useEffect(()=>{g?y&&N(y):n(!0)},[s]),m.useEffect(()=>{const a=setTimeout(()=>{I(p)},800);return()=>{clearTimeout(a)}},[f]),m.useEffect(()=>{g?I(p):n(!0)},[i.page,i.per_page]),e.jsxs(ae,{title:"Performances",rightOption:e.jsx(D,{sx:{display:"flex",alignItems:"center",marginY:1},children:["units","employees"].map((a,j)=>e.jsx(re,{label:a,sx:{marginLeft:j>0&&2,cursor:"pointer",textTransform:"capitalize",paddingX:2,paddingY:.4},color:"primary",variant:p===a?"filled":"outlined",onClick:()=>H(a)},j))}),children:[e.jsx(r,{container:!0,children:e.jsxs(r,{item:!0,xs:12,sx:{padding:2},children:[e.jsx(D,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingX:1,marginY:2},children:e.jsx(ne,{value:f,onChange:a=>J(a)})}),u?e.jsx(r,{container:!0,children:e.jsx(r,{item:!0,xs:12,sx:{display:"flex",alignItems:"center",justifyContent:"center",padding:4},children:e.jsx(F,{size:20})})}):t?e.jsx(ie,{title:"Server Error",message:`Unable to retrive ${p} performance `}):d.length===0?e.jsx(U,{severity:"units",title:`${p} are not found`,description:`The list of ${p} performance will be listed here`,sx:{paddingTop:6}}):p==="employees"?e.jsx(Z,{employees:d,onView:a=>B(a),selected:y,isLoading:$,performance:L}):e.jsx(Q,{units:d,onView:a=>B(a),selected:y,isLoading:$,performance:L})]})}),!u&&d.length>0&&e.jsx(oe,{component:"div",rowsPerPageOptions:[10,25,50,100],count:i.total,rowsPerPage:i.per_page,page:i.page,onPageChange:K,onRowsPerPageChange:ee})]})};export{Pe as default};
