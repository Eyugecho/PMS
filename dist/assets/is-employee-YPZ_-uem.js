import{o as se,au as ne,av as re,j as e,s as ie,am as oe,Z as le,r as p,C as $,aj as ce,Y as z,az as D,a3 as R,a8 as y,a0 as w,at as M,a5 as W,a6 as _,a2 as F,E as de,W as L,aw as O,v as Y,p as E,J as ue,aV as he,ag as U,aA as ge,ah as me,aC as xe}from"./index-BrIZ1aRM.js";import{A as V}from"./ActivityIndicator-BsI2VQVz.js";import{E as X}from"./ErrorPrompt-BxXhExEH.js";import{n as G}from"./no_result-CfkzRtwQ.js";import{T as H,a as J,b as q,c as Q}from"./TableRow-BXiBQlkf.js";import{T as I}from"./TableCell-BqWHfhA4.js";import{A as fe}from"./Autocomplete-CLcyM-1B.js";import{M as pe,P as je}from"./index-C_-DKd_R.js";import{D as Z}from"./DrogaButton-DGfkej71.js";import{a as be,c as ve,D as ye}from"./DialogTitle-CTwNxPSd.js";import{A as Ie}from"./Alert-CR4F7He2.js";var Pe=se("chevron-right","IconChevronRight",[["path",{d:"M9 6l6 6l-6 6",key:"svg-0"}]]),B={},Se=re;Object.defineProperty(B,"__esModule",{value:!0});var k=B.default=void 0,Ce=Se(ne()),Te=e;k=B.default=(0,Ce.default)((0,Te.jsx)("path",{d:"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"}),"KeyboardArrowDown");const we=ie(n=>e.jsx(oe,{elevation:0,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},...n}))(({theme:n})=>({"& .MuiPaper-root":{borderRadius:6,marginTop:n.spacing(1),minWidth:180,color:n.palette.mode==="light"?"rgb(55, 65, 81)":n.palette.grey[300],boxShadow:"rgb(255, 255, 255) 0px 0px 0px 0px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgba(0, 0, 0, 0.1) 0px 10px 15px -3px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px","& .MuiMenu-list":{padding:"4px 0"},"& .MuiMenuItem-root":{"& .MuiSvgIcon-root":{fontSize:18,color:n.palette.text.secondary,marginRight:n.spacing(1.5)},"&:active":{backgroundColor:le(n.palette.primary.main,n.palette.action.selectedOpacity)}}}}));function Ee({menu:n,selected:a,onSelect:r}){const[o,s]=p.useState(null),d=!!o,P=l=>{s(l.currentTarget)},x=()=>{s(null)},b=l=>{r(l),x()};return e.jsxs("div",{children:[e.jsx($,{id:"demo-customized-button","aria-controls":d?"demo-customized-menu":void 0,"aria-haspopup":"true","aria-expanded":d?"true":void 0,variant:"contained",disableElevation:!0,onClick:P,endIcon:e.jsx(k,{}),children:a||"Select frequency"}),e.jsx(we,{id:"demo-customized-menu",MenuListProps:{"aria-labelledby":"demo-customized-button"},anchorEl:o,open:d,onClose:x,children:n==null?void 0:n.map((l,j)=>e.jsx(ce,{disableRipple:!0,onClick:()=>b(l),children:l.name},l.id))})]})}const ee=()=>{const n=z(),{selectedKpi:a,updateKPI:r}=D(),[o,s]=p.useState(!0),[d,P]=p.useState([]),[x,b]=p.useState(!1),l=R(h=>h.customization.selectedFiscalYear),j=(h,i)=>{r(i,{frequency_id:h.id,f_name:h.name,f_value:h.value})},T=h=>{const i=h.find(u=>u.value==4);i&&a.forEach(u=>j(i,u.id))};return p.useEffect(()=>((async()=>{const i=await W(),u=_.api+_.planningFrequiencies+`?fiscal_year_id=${l==null?void 0:l.id}`,c={Authorization:`Bearer ${i}`,accept:"application/json","Content-Type":"application/json"};fetch(u,{method:"GET",headers:c}).then(f=>f.json()).then(f=>{f.success?(P(f.data),T(f.data),s(!1),b(!1)):(s(!1),b(!1))}).catch(f=>{F.error(f.message),b(!0),s(!1)})})(),()=>{}),[l.id]),e.jsxs(y,{children:[o?e.jsx(w,{container:!0,children:e.jsx(w,{item:!0,xs:12,sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",padding:8},children:e.jsx(V,{size:20})})}):x?e.jsx(X,{image:G,title:"Server Error",message:"Unable to retrive frequency"}):e.jsxs(H,{sx:{borderRadius:n.shape.borderRadius},children:[e.jsx(J,{children:e.jsxs(q,{children:[e.jsx(I,{sx:{minWidth:170},children:"KPI Name"}),e.jsx(I,{sx:{minWidth:60},children:"Frequency"})]})}),e.jsx(Q,{children:a==null?void 0:a.map((h,i)=>e.jsxs(q,{children:[e.jsx(I,{children:h.name}),e.jsx(I,{children:e.jsx(Ee,{menu:d,selected:h==null?void 0:h.f_name,onSelect:u=>j(u,h.id)})})]},i))})]}),e.jsx(M,{})]})},te=()=>{const n=z(),{selectedKpi:a,addOrRemoveKPI:r,updateKPI:o}=D(),[s,d]=p.useState(!0),[P,x]=p.useState([]),[b,l]=p.useState(!1),j=(i,u)=>{const c=u,f=a,t=c.filter(m=>!f.some(S=>S.id===m.id)),g=f.filter(m=>!c.some(S=>S.id===m.id));t.forEach(m=>r(m)),g.forEach(m=>r(m))},T=(i,u)=>{const c=i.target.value;o(u,{weight:c})},h=(i,u)=>{const c=i.target.value;o(u,{total_target:c})};return p.useEffect(()=>((()=>{const u=localStorage.getItem("token"),c=_.api+_.kpi,f={Authorization:`Bearer ${u}`,accept:"application/json","Content-Type":"application/json"};fetch(c,{method:"GET",headers:f}).then(t=>t.json()).then(t=>{t.success?(x(t.data.data),d(!1),l(!1)):(d(!1),l(!1))}).catch(t=>{F.error(t.message),l(!0),d(!1)})})(),()=>{}),[]),e.jsxs(y,{children:[s?e.jsx(w,{container:!0,children:e.jsx(w,{item:!0,xs:12,sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",padding:8},children:e.jsx(V,{size:20})})}):b?e.jsx(X,{image:G,title:"Server Error",message:"Unable to retrive kpi"}):e.jsxs(e.Fragment,{children:[e.jsx(y,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:e.jsx(fe,{id:"kpi-list",multiple:!0,options:P,getOptionLabel:i=>i.name,value:a,onChange:j,isOptionEqualToValue:(i,u)=>i.id===u.id,renderTags:(i,u)=>i.map((c,f)=>e.jsx(de,{label:c.name,...u({index:f})})),fullWidth:!0,renderInput:i=>e.jsx(L,{...i,label:"Select a KPI",variant:"outlined"}),disableClearable:!0})}),e.jsx(y,{sx:{padding:2},children:e.jsxs(H,{children:[e.jsx(J,{children:e.jsxs(q,{children:[e.jsx(I,{sx:{minWidth:130},children:"KPI Name"}),e.jsx(I,{sx:{minWidth:60},children:"Weight(%)"}),e.jsx(I,{sx:{minWidth:100},children:"Measured by"}),e.jsx(I,{sx:{minWidth:120},children:"Target"})]})}),e.jsx(Q,{children:a==null?void 0:a.map((i,u)=>e.jsxs(q,{children:[e.jsx(I,{children:i.name}),e.jsx(I,{children:e.jsx(O,{sx:{p:.5,border:1,borderRadius:2,borderColor:n.palette.primary.main},value:i.weight,onChange:c=>T(c,i.id),inputProps:{"aria-label":"weight"},type:"number"})}),e.jsx(I,{sx:{textTransform:"capitalize"},children:i.mu}),e.jsx(I,{children:e.jsx(O,{sx:{p:.5,border:1,borderRadius:2,borderColor:n.palette.primary.main},value:i.total_target,onChange:c=>h(c,i.id),inputProps:{"aria-label":"target"},type:"number"})})]},u))})]})})]}),e.jsx(M,{})]})},ae=()=>{const n=z(),{selectedKpi:a,distributeTarget:r}=D(),[o,s]=p.useState(!0),[d,P]=p.useState([]),[x,b]=p.useState(!1),[l,j]=p.useState(),T=R(t=>t.customization.selectedFiscalYear),h=(t,g,m)=>{const S=t.target.value;r(S,g,m)},i=(t,g)=>{l===t?j(null):(j(t),f(g))},u=(t,g)=>g>1?t+1:"",c=t=>{const g=(t==null?void 0:t.total_target)/t.f_value;d&&d.forEach(m=>r(g,t.id,m.id))},f=async t=>{s(!0),P([]);const g=await W(),m=_.api+_.planningPeriods+`?fiscal_year=${T==null?void 0:T.id}&frequency_id=${t}&type=planning`,S={Authorization:`Bearer ${g}`,accept:"application/json","Content-Type":"application/json"};fetch(m,{method:"GET",headers:S}).then(C=>C.json()).then(C=>{C.success?(P(C.data.periods),s(!1),b(!1)):(s(!1),b(!1))}).catch(C=>{F.error(C.message),b(!0),s(!1)})};return e.jsxs(y,{children:[a==null?void 0:a.map((t,g)=>e.jsxs(y,{sx:{marginY:2},children:[e.jsxs(Y,{sx:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",padding:1.6,border:.6,borderColor:n.palette.divider,backgroundColor:n.palette.primary.light,cursor:"pointer",marginY:.4},onClick:()=>i(g,t.frequency_id),children:[e.jsx(E,{variant:"h4",children:t==null?void 0:t.name}),e.jsxs(y,{children:[e.jsx(E,{variant:"caption",children:" Total target"}),e.jsxs(E,{variant:"subtitle1",children:[" ",t==null?void 0:t.total_target,pe(t==null?void 0:t.mu)]})]}),e.jsxs(ue,{children:[" ",l===g?e.jsx(he,{size:18}):e.jsx(Pe,{size:18})," "]})]}),l===g&&e.jsxs(y,{sx:{padding:1.6,marginY:.4},children:[e.jsxs(w,{container:!0,children:[e.jsx(w,{item:!0,xs:12,sm:12,md:6,children:e.jsxs(y,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(E,{variant:"subtitle1",color:n.palette.text.primary,children:"Evaluated"}),e.jsx(E,{variant:"subtitle1",sx:{backgroundColor:n.palette.grey[100],color:n.palette.text.primary,paddingY:.4,paddingX:2,borderRadius:20,marginLeft:1},children:t.f_name})]})}),e.jsx(w,{item:!0,xs:12,sm:12,md:6,sx:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx(Z,{title:"Evenly Distribute",variant:"outlined",onPress:()=>c(t),disabled:d.length===0})})]}),e.jsx(y,{sx:{marginTop:2,minHeight:"10dvh"},children:o?e.jsx(y,{sx:{display:"flex",alignItems:"center",justifyContent:"center",padding:2},children:e.jsx(U,{size:20})}):x?e.jsx(E,{variant:"subtitle1",children:"Error fetching periods"}):d.length===0?e.jsx(E,{variant:"subtitle1",children:"Please set period first"}):e.jsx(w,{container:!0,spacing:2,children:d==null?void 0:d.map((m,S)=>{var v;const C=(v=t.targets)==null?void 0:v.find(K=>K.period_id===m.id);return e.jsx(w,{item:!0,xs:12,sm:6,md:4,children:e.jsx(L,{type:"number",label:`${je(t==null?void 0:t.f_name)} ${u(S,t.f_value)}`,variant:"outlined",fullWidth:!0,margin:"normal",value:C?C.target:"",onChange:K=>h(K,t==null?void 0:t.id,m.id)})},m.id)})})})]})]},g)),e.jsx(M,{})]})},Le=[{id:2,name:"Select KPI",component:e.jsx(te,{})},{id:3,name:"Select Frequency",component:e.jsx(ee,{})},{id:4,name:"Target Distribution",component:e.jsx(ae,{})}],A=[{id:2,name:"Selected KPI",component:e.jsx(te,{})},{id:3,name:"Selected Frequency",component:e.jsx(ee,{})},{id:4,name:"Target Distribution",component:e.jsx(ae,{})}],_e=n=>{const a=[];let r=!0,o=0;return n.length===0&&(r=!1,a.push("Please select KPI before proceeding")),n.forEach(s=>{s.weight===""?(r=!1,a.push(`The ${s.name} KPI Weight is required.`)):isNaN(s.weight)?(r=!1,a.push(`The ${s.name} KPI weight must be a number.`)):s.weight<0?(r=!1,a.push(`The ${s.name} KPI weight cannot be negative.`)):s.weight>100?(r=!1,a.push(`The ${s.name} KPI Weight exceeded 100%`)):o+=parseFloat(s.weight),s.total_target===""?(r=!1,a.push(`The ${s.name} KPI target is not set.`)):isNaN(s.total_target)?(r=!1,a.push(`The ${s.name} KPI target should be a number.`)):s.total_target<0&&(r=!1,a.push(`The ${s.name} KPI target cannot be negative.`))}),o>100&&(r=!1,a.push("The sum of KPI weights exceeded 100%.")),{valid:r,errors:a}},Ke=n=>{const a=[];let r=!0;return n.forEach(o=>{o.frequency_id||(r=!1,a.push(`Please select the ${o.name} KPI evaluation frequency`))}),{valid:r,errors:a}},Fe=n=>{const a=[];let r=!0;return n.forEach(o=>{if(!o.targets)r=!1,a.push(`The ${o.name} KPI is not distributed`);else{let s=0;o==null||o.targets.forEach(d=>{!d.target||d.target===""?(r=!1,a.push(`Please check ${o.name} KPI input fields, there is a period with missing value`)):isNaN(d.target)&&(r=!1,a.push(`The ${o.name} KPI distributed target should be a number.`)),s+=parseFloat(d==null?void 0:d.target)}),s<(o==null?void 0:o.total_target)&&(r=!1,a.push(`The ${o.name} KPI total target is not fully distributed | distributed: ${s} `))}}),{valid:r,errors:a}},Ye=({add:n,onClose:a,onSucceed:r})=>{const o=z(),{selectedKpi:s}=D(),[d,P]=p.useState(!1),[x,b]=p.useState(0),[l,j]=p.useState({state:!1,message:""}),T=()=>{if(x===0){const c=_e(s);c.valid?(j({...l,state:!1,message:""}),b(x+1)):j({...l,state:!0,message:c.errors[0]})}else if(x===1){const c=Ke(s);c.valid?(j({...l,state:!1,message:""}),b(x+1)):j({...l,state:!0,message:c.errors[0]})}},h=()=>{j({...l,state:!1,message:""}),b(x-1)},i=()=>{const c=Fe(s);c.valid?(j({...l,state:!1,message:""}),u(s)):j({...l,state:!0,message:c.errors[0]})},u=async c=>{P(!0);const f=await W(),t=xe.getItem("selectFiscal"),g=JSON.parse(t),m=_.api+_.orgPlan,S={Authorization:`Bearer ${f}`,accept:"application/json","Content-Type":"application/json"},C={fiscal_year_id:g==null?void 0:g.id,data:c};fetch(m,{method:"POST",headers:S,body:JSON.stringify(C)}).then(v=>v.json()).then(v=>{var K,N;v.success?(F.success((K=v==null?void 0:v.data)==null?void 0:K.message),r(),a()):F.error((N=v==null?void 0:v.data)==null?void 0:N.message)}).catch(v=>{F.error(v.message)}).finally(()=>{P(!1)})};return e.jsx(p.Fragment,{children:e.jsx(be,{open:n,onClose:a,children:s&&e.jsxs(Y,{sx:{minWidth:"600px",minHeight:"50dvh",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingRight:1},children:[e.jsx(ve,{variant:"h3",color:o.palette.text.primary,fontSize:o.typography.h3,children:A[x].name}),e.jsx(ge.div,{whileHover:{rotate:90},transition:{duration:.3},style:{cursor:"pointer",marginRight:10},onClick:a,children:e.jsx(me,{size:"1.4rem",stroke:2})})]}),e.jsx(y,{sx:{padding:3},children:A[x].component})]}),e.jsxs(ye,{sx:{paddingX:3,paddingBottom:2},children:[l.state&&e.jsxs(Ie,{severity:"error",children:[" ",l.message]}),x>0&&e.jsx($,{onClick:()=>h(),sx:{paddingX:4,paddingY:1,marginRight:2},children:"Back"}),x===A.length-1?e.jsx($,{type:"submit",variant:"contained",sx:{paddingX:6,paddingY:1,boxShadow:0},onClick:()=>i(),children:d?e.jsx(U,{size:18,sx:{color:"white"}}):e.jsx(E,{variant:"subtitle1",color:o.palette.background.default,children:"Submit"})}):e.jsx(Z,{type:"button",title:"Next",variant:"contained",sx:{paddingX:6,paddingY:1,boxShadow:0},onPress:()=>T()})]})]})})})},Ue=()=>{const n=R(a=>a.user.user);if(n!=null&&n.roles){const a=n.roles.map(r=>r.name.trim().toLowerCase());return a.length===1&&a.includes("employee")}return!1};export{Le as C,Fe as D,Ke as F,Ue as I,_e as S,Ye as U};
