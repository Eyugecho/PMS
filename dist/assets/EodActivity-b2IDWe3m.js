import{K as je,j as e,r as n,a8 as P,a0 as u,W as j,C as R,v as J,Y as fe,a9 as ve,J as be,am as ye,aj as I,an as O,at as Ce,a2 as g}from"./index-BrIZ1aRM.js";import{a as w}from"./axios-B2-DI6Hg.js";import{c as _}from"./config-By_uygwP.js";import{d as Se}from"./MoreVert-TQNYNIEM.js";import{a as Q,c as V,b as Y,D as q}from"./DialogTitle-CTwNxPSd.js";import{T as _e,a as K}from"./Tabs-D9N9hXvN.js";import{T as X}from"./TableContainer-CbJxeCPv.js";import{T as Z,c as ee,b as v,a as Pe}from"./TableRow-BXiBQlkf.js";import{T as d}from"./TableCell-BqWHfhA4.js";import{F as G}from"./index-CJagu-9E.js";import{d as Te,a as De}from"./Delete-CJ0mWhfC.js";import{D as ke}from"./DrogaButton-DGfkej71.js";import{A as Ae}from"./ActivityIndicator-BsI2VQVz.js";import{p as Ie}from"./index-DQCQNdLr.js";import{I as Oe}from"./IconPlus-CfO6zmqS.js";import{T as we}from"./TablePagination-Cpy0D8zw.js";import"./KeyboardArrowRight-pfrJvB3H.js";import"./error-DW4k7GIP.js";import"./LastPage-C9NjV3u0.js";const Re=je(e.jsx("path",{d:"M3 14h4v-4H3zm0 5h4v-4H3zM3 9h4V5H3zm5 5h13v-4H8zm0 5h13v-4H8zM8 5v4h13V5z"}),"ViewList"),ze=({open:x,handleClose:m,handleSave:p,formValues:r,handleChange:o,handleTabChange:T,tabIndex:f,editIndex:c,formErrors:s,isLoading:b})=>{const[y,C]=n.useState(!1);return n.useEffect(()=>{C(c!==null)},[c]),e.jsxs(Q,{open:x,onClose:m,sx:{backdropFilter:"blur(10px)",backgroundColor:"rgba(255, 255, 255, 0.1)"},children:[e.jsx(V,{children:c!==null?"Edit EOD Activity":"Add EOD Activity"}),e.jsxs(Y,{children:[e.jsxs(_e,{value:f,onChange:T,children:[e.jsx(K,{label:"EOD Activity"}),c!==null&&e.jsx(K,{label:"EOD Revenue"})]}),e.jsxs(P,{mt:2,children:[f===0&&e.jsxs(u,{container:!0,spacing:2,children:[c===null&&e.jsx(u,{item:!0,xs:12,children:e.jsx(j,{fullWidth:!0,label:"Date",name:"date",type:"date",value:r.date||"",onChange:o,InputLabelProps:{shrink:!0},error:!!s.date,helperText:s.date?s.date[0]:""})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(j,{fullWidth:!0,label:"Plan",name:"plan",value:r.plan||"",onChange:o,error:!!s.plan,helperText:s.plan?s.plan[0]:"",InputProps:{readOnly:y},multiline:!0,rows:5,variant:"outlined"})}),c!==null&&e.jsxs(e.Fragment,{children:[e.jsx(u,{item:!0,xs:12,children:e.jsx(j,{fullWidth:!0,label:"Completed",name:"completed",value:r.completed||"",onChange:o,error:!!s.completed,helperText:s.completed?s.completed[0]:"",multiline:!0,rows:5,variant:"outlined"})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(j,{fullWidth:!0,label:"Challenge Faced",name:"challenge_faced",value:r.challenge_faced||"",onChange:o,error:!!s.challenge_faced,helperText:s.challenge_faced?s.challenge_faced[0]:"",multiline:!0,rows:5,variant:"outlined"})})]})]}),f===1&&c!==null&&e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{item:!0,xs:12,children:e.jsx(j,{fullWidth:!0,label:"Revenue",name:"revenue",value:r.revenue||"",onChange:o,error:!!s.revenue,helperText:s.revenue?s.revenue[0]:""})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(j,{fullWidth:!0,label:"Expenses",name:"expenses",value:r.expenses||"",onChange:o,error:!!s.expenses,helperText:s.expenses?s.expenses[0]:""})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(j,{fullWidth:!0,label:"Customer Satisfaction",name:"customer_satisfaction",value:r.customer_satisfaction||"",onChange:o,error:!!s.customer_satisfaction,helperText:s.customer_satisfaction?s.customer_satisfaction[0]:""})})]})]})]}),e.jsxs(q,{children:[e.jsx(R,{onClick:m,color:"primary",children:"Cancel"}),e.jsx(R,{onClick:p,color:"primary",disabled:b,children:b?"Saving...":"Save"})]})]})},Me=({detailOpen:x,handleCloseDetails:m,selectedRecord:p})=>{const r=p?[{id:1,field:"Revenue",value:p.revenue?`${p.revenue} Birr`:"N/A"},{id:2,field:"Expenses",value:p.expenses?`${p.expenses} Birr`:"N/A"},{id:4,field:"Customer Satisfaction",value:p.customer_satisfaction||"N/A"},{id:5,field:"Plan",value:p.Plan||"N/A"}]:[];return e.jsxs(Q,{open:x,onClose:m,sx:{backdropFilter:"blur(10px)",backgroundColor:"rgba(255, 255, 255, 0.1)"},children:[e.jsx(V,{children:"Record Details"}),e.jsx(Y,{children:p?e.jsx(X,{component:J,children:e.jsx(Z,{children:e.jsx(ee,{children:r.map(o=>e.jsxs(v,{children:[e.jsx(d,{children:o.field}),e.jsx(d,{children:o.value})]},o.id))})})}):e.jsx("p",{children:"No details available."})}),e.jsx(q,{children:e.jsx(R,{onClick:m,color:"primary",children:"Close"})})]})};function st(){const x=fe(),[m,p]=n.useState(0);n.useState(5);const[r,o]=n.useState([]),[T,f]=n.useState(!1),[c,s]=n.useState(null),[b,y]=n.useState(!1),[C,z]=n.useState(null),[M,$]=n.useState(null),[B,te]=n.useState(null),[ae,E]=n.useState(!0),[se,$e]=n.useState(!1),[ne,F]=n.useState(0),[le,Be]=n.useState({}),[re,L]=n.useState(!1),[W,S]=n.useState({date:new Date().toISOString().split("T")[0],revenue:"",expenses:"",profit:"",customer_satisfaction:"",plan:"",completed:"",challenge_faced:""}),[h,D]=n.useState({currentPage:0,lastPage:0,per_page:10,total:0});n.useEffect(()=>{k(h.currentPage,h.per_page)},[h.currentPage,h.per_page]);const k=async(t,a)=>{E(!0);try{const i=localStorage.getItem("token"),l=await w.get(`${_.API_URL_Units}/end-of-day-activities`,{params:{page:t,per_page:a},headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}});l.data.success?(o(l.data.data.data.map(N=>({...N,formattedDate:Ie(new Date(N.date),"MM/dd/yyyy")}))),D({currentPage:l.data.data.current_page-1,lastPage:l.data.data.last_page,per_page:l.data.data.per_page,total:l.data.data.total})):console.error(l.data.message)}catch(i){console.error("Error fetching data:",i)}finally{E(!1)}},U=t=>{if(t!==null){const a=r[t];S({date:a.date||new Date().toISOString().split("T")[0],revenue:a.revenue||"",expenses:a.expenses||"",profit:a.profit||"",customer_satisfaction:a.customer_satisfaction||"",plan:a.plan||"",completed:a.completed||"",challenge_faced:a.challenge_faced||""})}else S({date:new Date().toISOString().split("T")[0],revenue:"",expenses:"",profit:"",customer_satisfaction:"",plan:"",completed:"",challenge_faced:""});s(t),f(!0)},H=()=>{f(!1),S({date:new Date().toISOString().split("T")[0],revenue:"",expenses:"",profit:"",customer_satisfaction:"",plan:"",completed:"",challenge_faced:""}),s(null),F(0)},ie=async()=>{try{const t=localStorage.getItem("token"),a=c!==null?"PATCH":"POST",i=c!==null?`${_.API_URL_Units}/end-of-day-activities/${r[c].id}`:`${_.API_URL_Units}/end-of-day-activities`;L(!0);const l=await w({method:a,url:i,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},data:W});l.data.success?(k(h.currentPage,h.per_page),H(),g.success("Record saved successfully!")):g.error(l.data.message||"Error occurred")}catch(t){if(t.response)if(t.response.status===422){const{message:a,errors:i}=t.response.data.data;if(a)g.error(a);else{const l=Object.values(i).flat().join(", ");g.error(l||"Validation error occurred.")}}else t.response.data&&t.response.data.message?g.error(t.response.data.message):g.error("Error saving record: "+t.message);else g.error("Error saving record: "+t.message)}finally{L(!1)}},oe=t=>{const{name:a,value:i}=t.target;S(l=>({...l,[a]:i}))},ce=(t,a)=>{F(a)},de=t=>{z(t),y(!0)},pe=()=>{y(!1),z(null)},ue=(t,a)=>{$(t.currentTarget),te(a)},A=()=>{$(null)},xe=async()=>{try{const t=localStorage.getItem("token");await w.delete(`${_.API_URL_Units}/end-of-day-activities/${B.id}`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),g.success("Record deleted successfully!"),k(m+1)}catch{g.error("Error deleting record.")}finally{A()}},he=()=>{U(B.index),A()},ge=(t,a)=>{D(i=>({...i,currentPage:a}))},me=t=>{D(a=>({...a,per_page:parseInt(t.target.value,10),currentPage:0}))};return e.jsxs(ve,{maxWidth:"lg",title:"EOD Reporting",rightOption:e.jsx(ke,{title:"Create Activity",variant:"contained",icon:e.jsx(Oe,{size:"1.2rem",stroke:"1.2",style:{marginRight:4}}),sx:{boxShadow:0},onPress:()=>U(null)}),children:[e.jsx(u,{container:!0,sx:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:3.8,px:2},children:e.jsxs(u,{item:!0,xs:12,children:[e.jsx(X,{component:J,children:e.jsxs(Z,{children:[e.jsx(Pe,{children:e.jsx(v,{children:["KPI","Plan","Completed","Challenges Faced","Date","Actions"].map(t=>e.jsx(d,{sx:{backgroundColor:x.palette.grey[100],fontWeight:"bold",fontSize:"0.9rem",variant:"h3",position:"relative",padding:"12px 16px"},children:t},t))})}),e.jsx(ee,{children:ae?e.jsx(v,{children:e.jsx(d,{colSpan:5,children:e.jsx(P,{sx:{padding:2,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ae,{size:22})})})}):se?e.jsx(v,{children:e.jsx(d,{colSpan:5,children:e.jsx(P,{sx:{padding:2,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(G,{severity:"error",title:"Server error",description:"There is an error fetching EOD"})})})}):r.length===0?e.jsx(v,{children:e.jsx(d,{colSpan:5,children:e.jsx(P,{sx:{paddingTop:6,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(G,{severity:"EOD",title:"EOD Activity is not found",description:"The list of added EOD activities will be listed here"})})})}):r.map((t,a)=>{var i;return e.jsxs(v,{sx:{backgroundColor:x.palette.background.paper,borderRadius:2,"&:nth-of-type(odd)":{backgroundColor:x.palette.grey[50]},"&:hover":{backgroundColor:x.palette.grey[100]}},children:[e.jsx(d,{sx:{border:0,padding:"12px 16px"},children:((i=t.kpi)==null?void 0:i.name)||"N/A"}),e.jsx(d,{sx:{border:0,padding:"12px 16px"},children:t.plan}),e.jsx(d,{sx:{border:0,padding:"12px 16px"},children:t.completed}),e.jsx(d,{sx:{border:0,padding:"12px 16px"},children:t.challenge_faced}),e.jsx(d,{sx:{border:0,padding:"12px 16px"},children:t.formattedDate}),e.jsxs(d,{sx:{border:0,padding:"12px 16px"},children:[e.jsx(be,{onClick:l=>ue(l,{...t,index:a}),children:e.jsx(Se,{})}),e.jsxs(ye,{anchorEl:M,open:!!M,onClose:A,sx:{"& .MuiPaper-root":{backdropFilter:"blur(10px)",backgroundColor:"rgba(255, 255, 255, 0.3)",borderRadius:2,boxShadow:x.shadows[1]}},children:[e.jsxs(I,{onClick:he,children:[" ",e.jsx(O,{children:e.jsx(Te,{fontSize:"small",style:{paddingRight:"2px",color:"#11365A"}})}),"Update"]}),e.jsxs(I,{onClick:()=>de(t),children:[" ",e.jsx(O,{children:e.jsx(Re,{fontSize:"small",style:{paddingRight:"2px",color:"#11365A"}})}),"Details"]}),e.jsxs(I,{onClick:xe,children:[" ",e.jsx(O,{children:e.jsx(De,{fontSize:"small",style:{paddingRight:"2px",color:"red"}})}),"Delete"]})]})]})]},t.id)})})]})}),e.jsx(we,{rowsPerPageOptions:[10,25,50,100],rowsPerPage:h.per_page,component:"div",count:h.total,page:h.currentPage,onPageChange:ge,onRowsPerPageChange:me})]})}),e.jsx(ze,{open:T,handleClose:H,handleSave:ie,formValues:W,handleChange:oe,handleTabChange:ce,tabIndex:ne,editIndex:c,formErrors:le,isLoading:re}),e.jsx(Me,{detailOpen:b,handleCloseDetails:pe,selectedRecord:C}),e.jsx(Ce,{})]})}export{st as default};
