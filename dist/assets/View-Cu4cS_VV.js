import{r as d,aN as we,aO as De,aP as Ae,j as e,aQ as Ue,aR as ze,aS as Fe,P as K,l as re,R as G,_ as Ne,m as D,as as ye,a0 as We,G as M,$ as Be,b as O,C as te,T as be,v as se,w as ne,x as L,y as b,z as ae,an as Z,a4 as Me,Y as _e,Z as Te,at as ve,f as V,B as $,h as A,q as Le,t as Oe,I as Ke,aF as qe,aL as Ge,aM as Pe,aw as Se,ax as Ie,u as ke,a as Ve,d as Xe,F as Ye,k as He,a5 as Qe,ao as Je,ar as Ze,n as et,g as tt,ag as st,aj as nt,ay as at}from"./index-DL-CLDEe.js";import{I as rt,U as it}from"./is-employee-B1SWexxr.js";import{A as Ce}from"./Autocomplete-D8TvuXv2.js";import{A as ot}from"./Alert-B6r8ITbi.js";import{K as lt,a as dt}from"./KeyboardArrowUp-C1VMsA8Z.js";import{P as ct}from"./PlanCard-CFMUCEtq.js";import{P as ut}from"./PerformanceCard-BGBIJSie.js";import{I as ht}from"./IconTargetArrow-D7GkijEa.js";import"./no_result-CfkzRtwQ.js";import"./Close-B1KvSMQT.js";import"./DrogaDonutChart-gWJPFz3l.js";function Ee(){const g=d.useRef(!1);return we(()=>(g.current=!0,()=>{g.current=!1}),[]),g}function ft(){const g=Ee(),[h,n]=d.useState(0),t=d.useCallback(()=>{g.current&&n(h+1)},[h]);return[d.useCallback(()=>De.postRender(t),[t]),h]}class gt extends d.Component{getSnapshotBeforeUpdate(h){const n=this.props.childRef.current;if(n&&h.isPresent&&!this.props.isPresent){const t=this.props.sizeRef.current;t.height=n.offsetHeight||0,t.width=n.offsetWidth||0,t.top=n.offsetTop,t.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function mt({children:g,isPresent:h}){const n=d.useId(),t=d.useRef(null),o=d.useRef({width:0,height:0,top:0,left:0}),{nonce:j}=d.useContext(Ae);return d.useInsertionEffect(()=>{const{width:r,height:y,top:S,left:C}=o.current;if(h||!t.current||!r||!y)return;t.current.dataset.motionPopId=n;const c=document.createElement("style");return j&&(c.nonce=j),document.head.appendChild(c),c.sheet&&c.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${r}px !important;
            height: ${y}px !important;
            top: ${S}px !important;
            left: ${C}px !important;
          }
        `),()=>{document.head.removeChild(c)}},[h]),e.jsx(gt,{isPresent:h,childRef:t,sizeRef:o,children:d.cloneElement(g,{ref:t})})}const pe=({children:g,initial:h,isPresent:n,onExitComplete:t,custom:o,presenceAffectsLayout:j,mode:r})=>{const y=Ue(pt),S=d.useId(),C=d.useMemo(()=>({id:S,initial:h,isPresent:n,custom:o,onExitComplete:c=>{y.set(c,!0);for(const m of y.values())if(!m)return;t&&t()},register:c=>(y.set(c,!1),()=>y.delete(c))}),j?[Math.random()]:[n]);return d.useMemo(()=>{y.forEach((c,m)=>y.set(m,!1))},[n]),d.useEffect(()=>{!n&&!y.size&&t&&t()},[n]),r==="popLayout"&&(g=e.jsx(mt,{isPresent:n,children:g})),e.jsx(ze.Provider,{value:C,children:g})};function pt(){return new Map}function xt(g){return d.useEffect(()=>()=>g(),[])}const q=g=>g.key||"";function jt(g,h){g.forEach(n=>{const t=q(n);h.set(t,n)})}function yt(g){const h=[];return d.Children.forEach(g,n=>{d.isValidElement(n)&&h.push(n)}),h}const bt=({children:g,custom:h,initial:n=!0,onExitComplete:t,exitBeforeEnter:o,presenceAffectsLayout:j=!0,mode:r="sync"})=>{const y=d.useContext(Fe).forceRender||ft()[0],S=Ee(),C=yt(g);let c=C;const m=d.useRef(new Map).current,U=d.useRef(c),k=d.useRef(new Map).current,N=d.useRef(!0);if(we(()=>{N.current=!1,jt(C,k),U.current=c}),xt(()=>{N.current=!0,k.clear(),m.clear()}),N.current)return e.jsx(e.Fragment,{children:c.map(i=>e.jsx(pe,{isPresent:!0,initial:n?void 0:!1,presenceAffectsLayout:j,mode:r,children:i},q(i)))});c=[...c];const T=U.current.map(q),z=C.map(q),v=T.length;for(let i=0;i<v;i++){const _=T[i];z.indexOf(_)===-1&&!m.has(_)&&m.set(_,void 0)}return r==="wait"&&m.size&&(c=[]),m.forEach((i,_)=>{if(z.indexOf(_)!==-1)return;const E=k.get(_);if(!E)return;const P=T.indexOf(_);let I=i;if(!I){const F=()=>{m.delete(_);const W=Array.from(k.keys()).filter(w=>!z.includes(w));if(W.forEach(w=>k.delete(w)),U.current=C.filter(w=>{const R=q(w);return R===_||W.includes(R)}),!m.size){if(S.current===!1)return;y(),t&&t()}};I=e.jsx(pe,{isPresent:!1,onExitComplete:F,custom:h,presenceAffectsLayout:j,mode:r,children:E},q(E)),m.set(_,I)}c.splice(P,0,I)}),c=c.map(i=>{const _=i.key;return m.has(_)?i:e.jsx(pe,{isPresent:!0,presenceAffectsLayout:j,mode:r,children:i},q(i))}),e.jsx(e.Fragment,{children:m.size?c:c.map(i=>d.cloneElement(i))})},_t=(g,h)=>{const n=[];let t=!0;return g.length===0&&(t=!1,n.push("Please select the unit first")),g.forEach(o=>{o.child_weight==0?(t=!1,n.push(`The ${o.unit_name} Unit weight is required.`)):isNaN(o.child_weight)?(t=!1,n.push(`The ${o.unit_name} Unit weight must be a number.`)):o.child_weight<0?(t=!1,n.push(`The ${o.unit_name} Unit weight cannot be negative.`)):o.child_weight>100&&(t=!1,n.push(`The ${o.unit_name} Unit weight exceeded 100%`)),o.unit_targets.length===0?(t=!1,n.push("Enter the units target")):o.unit_targets.length>0&&o.unit_targets.forEach(j=>{j.parent_id===h&&j.target==0?(t=!1,n.push(`Please enter ${o.unit_name} unit target`)):isNaN(j.target)?(t=!1,n.push(`The ${o.unit_name} target must be a number.`)):j.target<0&&(t=!1,n.push(`The ${o.unit_name} target cannot be negative.`))})}),{valid:t,errors:n}},ee=(g,h)=>{const n=[];let t=!0;return g.forEach(o=>{(o==null?void 0:o.unit_targets.find(r=>r.parent_id===h))||(t=!1,n.push(`Please enter ${o.unit_name} target`)),o.unit_targets.forEach(r=>{r.parent_id===h&&r.target==0?(t=!1,n.push(`Please enter ${o.unit_name} target`)):isNaN(r.target)?(t=!1,n.push(`The ${o.unit_name} target must be a number.`)):r.target<0&&(t=!1,n.push(`The ${o.unit_name} target cannot be negative.`))})}),{valid:t,errors:n}},Ct=(g,h)=>{const n=[];let t=!0;return g.length===0&&(t=!1,n.push("Please select the employee first")),g.forEach(o=>{o.child_weight==0?(t=!1,n.push(`The ${o.unit_name}  weight is required.`)):isNaN(o.child_weight)?(t=!1,n.push(`The ${o.unit_name} weight must be a number.`)):o.child_weight<0?(t=!1,n.push(`The ${o.unit_name} employee weight is cannot be negative.`)):o.child_weight>100&&(t=!1,n.push(`The ${o.unit_name} employee weight exceeded 100%`)),o.unit_targets.length===0?(t=!1,n.push("Enter the employees target")):o.unit_targets.length>0&&o.unit_targets.forEach(j=>{j.parent_id===h&&j.target===0?(t=!1,n.push(`Please enter ${o.unit_name} employee target`)):isNaN(j.target)?(t=!1,n.push(`The ${o.unit_name} target must be a number.`)):j.target<0&&(t=!1,n.push(`The ${o.unit_name} target cannot be negative.`))})}),{valid:t,errors:n}},Re=({add:g,onClose:h,plan_id:n,targets:t,naming:o})=>{const j=re(),[r,y]=G.useState(0),S=d.useRef(r),[C,c]=d.useState("next"),[m,U]=G.useState("units"),[k,N]=G.useState(!1),[T,z]=d.useState([]),[v,i]=G.useState({state:!1,message:""}),[_,E]=d.useState([]),[P,I]=d.useState([]),[F,W]=d.useState([]),[w,R]=d.useState([]),ie=a=>{U(a)},oe=(a,f)=>{E(f);const p=f.find(u=>!_.some(l=>l.id===u.id)),s=_.find(u=>!f.some(l=>l.id===u.id));if(p){const u={unit_id:p.id,unit_name:p.name,total_target:t[r].target,child_weight:0,unit_targets:[]};I(l=>[...l,u])}if(s){const u=P.filter(l=>l.unit_id!==s.id);I(u)}},le=(a,f,p)=>{const s=a.target.value;I(u=>u.map(l=>{if(l.unit_id===p){const x=l.unit_targets.findIndex(B=>B.parent_id===f),X=x!==-1?l.unit_targets.map((B,Y)=>Y===x?{...B,target:s}:B):[...l.unit_targets,{parent_id:f,target:s,weight:""}];return{...l,unit_targets:X}}return l}))},de=(a,f)=>{const p=a.target.value;I(s=>s.map(u=>u.unit_id===f?{...u,child_weight:p}:u))},ce=(a,f)=>{var u;W(f);const p=f.find(l=>!F.some(x=>x.id===l.id)),s=F.find(l=>!f.some(x=>x.id===l.id));if(p){const l={unit_id:p.id,unit_name:(u=p.user)==null?void 0:u.name,total_target:t[r].target,child_weight:0,unit_targets:[]};R(x=>[...x,l])}if(s){const l=w.filter(x=>x.unit_id!==s.id);R(l)}},ue=(a,f,p)=>{const s=a.target.value;R(u=>u.map(l=>{if(l.unit_id===p){const x=l.unit_targets.findIndex(B=>B.parent_id===f),X=x!==-1?l.unit_targets.map((B,Y)=>Y===x?{...B,target:s}:B):[...l.unit_targets,{parent_id:f,target:s}];return{...l,unit_targets:X}}return l}))},he=(a,f)=>{const p=a.target.value;R(s=>s.map(u=>u.unit_id===f?{...u,child_weight:p}:u))},fe=async()=>{z([]);const a=await V(),f=A.api+A.childUnits,p={Authorization:`Bearer ${a}`,accept:"application/json","Content-Type":"application/json"};fetch(f,{method:"GET",headers:p}).then(s=>s.json()).then(s=>{s.success?z(s.data):$.error(s.data.message)}).catch(s=>{$.error(s.message)})},ge=()=>{if(r===0&&m==="units"){const a=_t(P,t[r].id);a.valid?(c("next"),y(f=>(f+1)%t.length),i({...v,state:!1,message:""})):i({...v,state:!0,message:a.errors[0]})}if(r>0&&m==="units"){const a=ee(P,t[r].id);a.valid?(c("next"),y(f=>(f+1)%t.length),i({...v,state:!1,message:""})):i({...v,state:!0,message:a.errors[0]})}if(r===0&&m==="employees"){const a=Ct(w,t[r].id);a.valid?(c("next"),y(f=>(f+1)%t.length),i({...v,state:!1,message:""})):i({...v,state:!0,message:a.errors[0]})}if(r>0&&m==="employees"){const a=ee(w,t[r].id);a.valid?(c("next"),y(f=>(f+1)%t.length),i({...v,state:!1,message:""})):i({...v,state:!0,message:a.errors[0]})}},me=()=>{r>0&&(c("prev"),y(a=>(a-1+t.length)%t.length))},Q=()=>{const a=ee(P,t[r].id),f=ee(w,t[r].id);if(!a.valid)return i({...v,state:!0,message:a.errors[0]}),!1;if(!f.valid)return i({...v,state:!0,message:f.errors[0]}),!1;if(a.valid&&f.valid)return!0},J=async()=>{if(Q()){i({...v,state:!1,message:""}),N(!0);const a=await V(),f=A.api+A.distributeTarget,p={Authorization:`Bearer ${a}`,accept:"application/json","Content-Type":"application/json"};fetch(f,{method:"POST",headers:p,body:JSON.stringify({plan_id:n,unit_target:P,employee_target:w})}).then(u=>u.json()).then(u=>{var l,x;u.success?(N(!1),$.success((l=u.data)==null?void 0:l.message),h(),E([]),I([]),W([]),R([])):(N(!1),$.error((x=u.data)==null?void 0:x.message))}).catch(u=>{$.error(u.message),N(!1)})}};return d.useEffect(()=>(fe(),()=>{}),[]),d.useEffect(()=>{S.current=r},[r]),e.jsx(G.Fragment,{children:e.jsxs(Ne,{open:g,onClose:h,children:[e.jsx(D,{sx:{position:"absolute",right:6,top:14},children:e.jsx(ye.div,{whileHover:{rotate:90},transition:{duration:.3},style:{cursor:"pointer",marginRight:12},onClick:h,children:e.jsx(We,{size:"1.2rem",stroke:2})})}),t.length>0&&e.jsxs(M,{container:!0,sx:{display:"flex",flexDirection:"column",minWidth:"600px",padding:1.2},children:[e.jsx(M,{item:!0,xs:12,sx:{display:"flex",flexDirection:"row"},children:e.jsx(bt,{mode:"wait",children:e.jsxs(ye.div,{initial:{opacity:0,x:C==="next"?100:-100},animate:{opacity:1,x:0},exit:{opacity:0,x:C==="next"?-100:100},transition:{duration:.3},style:{width:"100%"},children:[e.jsx(D,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingRight:2},children:e.jsxs(D,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(Be,{variant:"h4",children:[o," ",r+1]}),e.jsxs(D,{sx:{display:"flex",alignItems:"center",paddingX:2,borderLeft:1},children:[e.jsx(O,{variant:"body2",children:" Total target is"}),e.jsx(O,{variant:"subtitle1",sx:{backgroundColor:j.palette.grey[100],paddingX:2,borderRadius:10,marginLeft:1},children:t[r].target})]})]})}),e.jsxs(D,{sx:{paddingX:2,marginTop:1.4},children:[e.jsx(D,{sx:{display:"flex",alignItems:"center",marginY:1},children:["units","employees"].map((a,f)=>e.jsx(te,{label:a,sx:{marginLeft:1,cursor:"pointer",textTransform:"capitalize"},color:"primary",variant:m===a?"filled":"outlined",onClick:()=>ie(a)},f))}),r===0&&e.jsx(e.Fragment,{children:m==="employees"?e.jsx(Ce,{id:"employee_list",multiple:!0,options:(T==null?void 0:T.employees)||[],getOptionLabel:a=>{var f;return((f=a.user)==null?void 0:f.name)||""},value:F,onChange:ce,renderTags:(a,f)=>a.map((p,s)=>{var u;return e.jsx(te,{className:"employee-chips",label:((u=p.user)==null?void 0:u.name)||"",...f({index:s})})}),fullWidth:!0,renderInput:a=>e.jsx(be,{...a,label:"Select an employee",variant:"outlined"}),sx:{marginTop:4},disableClearable:!0}):e.jsx(Ce,{id:"unit_list",multiple:!0,options:(T==null?void 0:T.child_unit)||[],getOptionLabel:a=>a.name||"",value:_,onChange:oe,renderTags:(a,f)=>a.map((p,s)=>e.jsx(te,{className:"unit-chips",label:p.name||"",...f({index:s})})),fullWidth:!0,renderInput:a=>e.jsx(be,{...a,label:"Select a unit",variant:"outlined"}),sx:{marginTop:4},disableClearable:!0})}),m==="employees"?e.jsxs(se,{children:[e.jsx(ne,{children:e.jsxs(L,{children:[e.jsx(b,{sx:{minWidth:120},children:"Employee name"}),r===0&&e.jsx(b,{sx:{minWidth:80},children:"Annum weight(%)"}),e.jsx(b,{sx:{minWidth:80},children:"Employee target"})]})}),e.jsx(ae,{children:w.length===0?e.jsx(L,{children:e.jsx(b,{sx:{display:"flex",alignItems:"center",padding:2,border:0},colSpan:3,children:"Please select employee"})}):w==null?void 0:w.map((a,f)=>{var u;const p=(u=a.unit_targets)==null?void 0:u.findIndex(l=>l.parent_id===t[r].id),s=p!==-1&&p!==void 0?a.unit_targets[p].target:"";return e.jsxs(L,{children:[e.jsx(b,{children:a.unit_name}),r===0&&e.jsx(b,{children:e.jsx(Z,{sx:{p:.5,border:.4,borderRadius:2,borderColor:"primary.main"},value:a.child_weight,onChange:l=>he(l,a.unit_id),inputProps:{"aria-label":"target"},type:"number"})}),e.jsx(b,{children:e.jsx(Z,{sx:{p:.5,border:.4,borderRadius:2,borderColor:"primary.main"},value:s,onChange:l=>ue(l,t[r].id,a.unit_id),inputProps:{"aria-label":"target"},type:"number"})})]},f)})})]}):e.jsxs(se,{children:[e.jsx(ne,{children:e.jsxs(L,{children:[e.jsx(b,{sx:{minWidth:120},children:"Unit name"}),r===0&&e.jsx(b,{sx:{minWidth:80},children:"Annum Weight(%)"}),e.jsx(b,{sx:{minWidth:80},children:"Unit target"})]})}),e.jsx(ae,{children:P.length===0?e.jsx(L,{children:e.jsx(b,{sx:{display:"flex",alignItems:"center",padding:2,border:0},colSpan:3,children:"Please select unit"})}):P==null?void 0:P.map((a,f)=>{var u;const p=(u=a.unit_targets)==null?void 0:u.findIndex(l=>l.parent_id===t[r].id),s=p!==-1&&p!==void 0?a.unit_targets[p].target:"";return e.jsxs(L,{children:[e.jsx(b,{children:a.unit_name}),r===0&&e.jsx(b,{children:e.jsx(Z,{sx:{p:.5,border:1,borderRadius:2,borderColor:"primary.main"},value:a.child_weight,onChange:l=>de(l,a.unit_id),inputProps:{"aria-label":"target"}})}),e.jsx(b,{children:e.jsx(Z,{sx:{p:.5,border:1,borderRadius:2,borderColor:"primary.main"},value:s,onChange:l=>le(l,t[r].id,a.unit_id),inputProps:{"aria-label":"target"},type:"number"})})]},f)})})]})]})]},r)})}),e.jsxs(Me,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(D,{children:[" ",v.state&&e.jsxs(ot,{severity:"error",children:[" ",v.message]})]}),e.jsxs(D,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingX:2},children:[r>0&&e.jsx(_e,{sx:{marginRight:3},onClick:()=>me(),children:"Back"}),r===t.length-1?e.jsx(_e,{type:"button",variant:"contained",sx:{py:1,paddingX:6,boxShadow:0,borderRadius:2},onClick:()=>J(),disabled:k,children:k?e.jsx(Te,{size:18,sx:{color:"white"}}):e.jsx(O,{variant:"subtitle1",color:j.palette.background.paper,children:"Submit"})}):e.jsx(ve,{title:"Next",type:"button",variant:"contained",sx:{paddingX:6,boxShadow:0},onPress:()=>ge()})]})]})]})]})})};Re.propTypes={add:K.bool,onClose:K.func,plan:K.array,plan_id:K.string,targets:K.array,naming:K.string};const wt=({plans:g})=>{var T,z,v;const h=re(),[n,t]=d.useState(null),[o,j]=d.useState(null),[r,y]=d.useState(),[S,C]=d.useState(!1),[c,m]=d.useState(!1),U=i=>{n===i?(t(null),j(null)):(t(i),j(null))},k=i=>{y(i),C(!0)},N=async()=>{m(!0);try{const i=await V(),_=A.api+A.deletePlan+`/${r==null?void 0:r.id}`,E=await Ie.delete(_,{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}});E.data.success?(C(!1),$.success(E.data.data.message)):$.error(E.data.data.message)}catch(i){$.error(i.message)}finally{m(!1)}};return e.jsxs(G.Fragment,{children:[e.jsx(Le,{component:Oe,sx:{minHeight:"44dvh",marginTop:2,backgroundColor:h.palette.background.paper,borderRadius:2},children:e.jsxs(se,{sx:{minWidth:650},"aria-label":"Distributed target table",children:[e.jsx(ne,{children:e.jsxs(L,{children:[e.jsx(b,{children:"Unit name"}),e.jsx(b,{children:"Inherited Weights(%)"}),e.jsx(b,{children:"KPI Weights(%)"}),e.jsx(b,{children:"Target"}),e.jsx(b,{children:"Action"})]})}),e.jsx(ae,{children:g==null?void 0:g.map((i,_)=>{var E,P,I,F;return e.jsxs(e.Fragment,{children:[e.jsxs(L,{sx:{backgroundColor:n==_&&h.palette.grey[50],":hover":{backgroundColor:h.palette.primary.light,color:h.palette.background.default,cursor:"pointer",borderRadius:2}},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",border:0},children:[e.jsx(Ke,{"aria-label":"expand row",size:"small",onClick:()=>U(_),children:n===_?e.jsx(lt,{}):e.jsx(dt,{})}),e.jsxs(O,{variant:"subtitle1",color:h.palette.text.primary,sx:{marginLeft:2},children:[" ",i!=null&&i.unit?(E=i==null?void 0:i.unit)==null?void 0:E.name:(I=(P=i==null?void 0:i.employee)==null?void 0:P.user)==null?void 0:I.name]})]}),e.jsxs(b,{sx:{border:0},children:[parseFloat(i==null?void 0:i.inherit_weight).toFixed(1),"%"]}),e.jsxs(b,{sx:{border:0},children:[parseFloat(i==null?void 0:i.weight).toFixed(1),"%"]}),e.jsx(b,{sx:{border:0},children:parseFloat(i==null?void 0:i.total_target).toFixed(1)}),e.jsx(b,{sx:{border:0},children:e.jsx(qe,{onView:()=>U(_),onDelete:()=>k(i)})})]},_),n==_&&e.jsx(L,{children:e.jsx(b,{colSpan:7,children:e.jsx(Ge,{in:n!==null,timeout:"auto",unmountOnExit:!0,sx:{backgroundColor:h.palette.background.default,borderRadius:2},children:e.jsxs(se,{sx:{minWidth:650},"aria-label":"Organization plan table",children:[e.jsx(ne,{children:e.jsxs(L,{children:[e.jsx(b,{children:"Period"}),e.jsx(b,{children:"Target"})]})}),e.jsx(ae,{children:(F=i==null?void 0:i.target)==null?void 0:F.map((W,w)=>{var R;return e.jsxs(L,{sx:o==W.id?{backgroundColor:h.palette.background.default,":hover":{backgroundColor:h.palette.grey[100],color:h.palette.background.default,cursor:"pointer",borderRadius:2}}:{backgroundColor:h.palette.primary.light,":hover":{backgroundColor:h.palette.grey[100],color:h.palette.background.default,cursor:"pointer",borderRadius:2}},children:[e.jsx(b,{sx:{border:0},children:Pe((R=i==null?void 0:i.frequency)==null?void 0:R.name)+" "+(w+1)}),e.jsx(b,{sx:{border:0,fontWeight:"bold"},children:W==null?void 0:W.target})]},w)})})]})})})})]})})})]})}),S&&e.jsx(Se,{type:"Delete",open:S,title:"Deleting child plan",description:`Are you sure you want to delete ${r!=null&&r.unit?((T=r==null?void 0:r.unit)==null?void 0:T.name)+" unit":(v=(z=r==null?void 0:r.employee)==null?void 0:z.user)==null?void 0:v.name}`,onNo:()=>C(!1),onYes:()=>N(),deleting:c,handleClose:()=>C(!1)})]})},$e=({plan:g})=>{const h=ke(y=>y.customization.selectedFiscalYear),n=re(),[t,o]=d.useState(!1),[j,r]=d.useState([]);return d.useEffect(()=>{(async()=>{if(h){o(!0);const S=await V(),C=A.api+A.KPIPerformance+`${g==null?void 0:g.employee_id}/kpi/${g==null?void 0:g.kpi_id}?fiscal_year_id=${h==null?void 0:h.id}`,c={Authorization:`Bearer ${S}`,accept:"application/json","Content-Type":"application/json"};fetch(C,{method:"GET",headers:c}).then(m=>m.json()).then(m=>{m.success?r(m.data):$.warning(m.message)}).catch(m=>{$.warning(m.message)}).finally(()=>{o(!1)})}else return e.jsx(He,{})})()},[h]),e.jsxs(Ve,{children:[e.jsx(O,{variant:"h4",children:"Performance"}),e.jsx(M,{container:!0,children:e.jsx(M,{item:!0,xs:12,children:t?e.jsx(D,{sx:{display:"flex",alignItems:"center",justifyContent:"center",padding:2},children:e.jsx(Xe,{size:20})}):j.length>0?e.jsx(M,{container:!0,sx:{marginTop:2,borderTop:.8,borderColor:n.palette.divider,padding:1},children:e.jsx(M,{item:!0,xs:12,sx:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:j==null?void 0:j.map((y,S)=>{var k;const C=Object.keys(y)[0],[c,m]=C.match(/[a-zA-Z]+|[0-9]+/g),U=`${c} ${m}`;return e.jsx(ut,{isEvaluated:y[C].is_evaluated,performance:(k=y[C])==null?void 0:k.kpi_performance,frequency:U},S)})})}):e.jsx(Ye,{severity:"performance",title:"No performance report",description:"The performance will be listed here",sx:{paddingTop:2}})})})]})};$e.propTypes={plan:K.string};const Ut=()=>{var a,f,p;const g=re(),h=Qe(),n=rt(),{state:t}=Je(),{handleUpdatePlan:o}=Ze(),j=ke(s=>s.customization),[r,y]=d.useState(!1),[S,C]=d.useState(!0),[c,m]=d.useState(t),[U,k]=d.useState([]),[N,T]=d.useState(!1),[z,v]=d.useState("units"),[i,_]=d.useState(!1),[E,P]=d.useState(!1),[I,F]=d.useState(!1),[W,w]=d.useState(!1),[R,ie]=d.useState(""),oe=()=>{o([]),P(!1)},le=s=>{var x,X,B,Y,xe,je;const u={id:s==null?void 0:s.kpi_id,f_name:(x=s==null?void 0:s.frequency)==null?void 0:x.name,f_value:(X=s==null?void 0:s.frequency)==null?void 0:X.value,frequency_id:s==null?void 0:s.frequency_id,mu:(Y=(B=s==null?void 0:s.kpi)==null?void 0:B.measuring_unit)==null?void 0:Y.name,name:(xe=s==null?void 0:s.kpi)==null?void 0:xe.name,total_target:s==null?void 0:s.total_target,weight:s==null?void 0:s.weight},l=(je=s==null?void 0:s.target)==null?void 0:je.map(H=>({period_id:H==null?void 0:H.period_id,target:H==null?void 0:H.target}));o([{...u,targets:l}]),at.setItem("selectFiscal",JSON.stringify({id:s==null?void 0:s.fiscal_year_id,year:""})),P(!0)},de=s=>{le(s)},ce=()=>{F(!0)},ue=async()=>{w(!0);try{const s=await V(),u=A.api+A.deletePlan+`/${t==null?void 0:t.id}`,l=await Ie.delete(u,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});l.data.success?(F(!1),$.success(l.data.data.message),h(-1)):$.error(l.data.data.message)}catch(s){$.error(s.message)}finally{w(!1)}},he=()=>{_(!0)},fe=()=>{_(!1)},ge=s=>{const u=s.target.value;ie(u)},me=s=>{v(s)},Q=async()=>{const s=await V(),u=A.api+A.showPlan+"/"+(t==null?void 0:t.id),l={Authorization:`Bearer ${s}`,accept:"application/json","Content-Type":"application/json"};fetch(u,{method:"GET",headers:l}).then(x=>x.json()).then(x=>{x.success&&m(x.data),T(!1)}).catch(x=>{$(x.message),T(!0)})},J=async()=>{C(!0);const s=await V(),u=A.api+A.childTarget+(t==null?void 0:t.id)+`?unit_type=${z}&search=${R}`,l={Authorization:`Bearer ${s}`,accept:"application/json","Content-Type":"application/json"};fetch(u,{method:"GET",headers:l}).then(x=>x.json()).then(x=>{x.success?(k(x.data),T(!1)):T(!0)}).catch(x=>{$(x.message),T(!0)}).finally(()=>{C(!1)})};return d.useEffect(()=>{const s=setTimeout(()=>{J()},800);return()=>{clearTimeout(s)}},[R]),d.useEffect(()=>{Q(),r?J():y(!0)},[t==null?void 0:t.id,z]),e.jsxs(G.Fragment,{children:[e.jsx(et,{back:!0,title:`${t?(a=c==null?void 0:c.kpi)==null?void 0:a.name:"Plan Details"}`,children:e.jsxs(M,{container:!0,spacing:tt,sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",marginTop:1,padding:2},children:[e.jsxs(M,{item:!0,xs:12,sm:12,md:12,lg:4,xl:3,children:[e.jsx(ct,{plan:c,onEdit:()=>de(c),onDelete:()=>ce()}),!n&&e.jsx(ve,{fullWidth:!0,title:"Cascade Targets",onPress:()=>he(),sx:{marginY:2,padding:1.6,boxShadow:0}})]}),n?e.jsx(M,{item:!0,xs:12,sm:12,md:12,lg:8,xl:9,children:e.jsx($e,{plan:t})}):e.jsxs(M,{item:!0,xs:12,sm:12,md:12,lg:8,xl:9,sx:{border:1,borderColor:g.palette.divider,backgroundColor:g.palette.background.default,borderRadius:`${j.borderRadius}px`,padding:2,marginTop:3},children:[e.jsxs(D,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",marginBottom:2.4},children:[e.jsx(O,{variant:"h4",children:"Target Distributed"}),e.jsx(D,{sx:{display:"flex",alignItems:"center"},children:["units","employees"].map((s,u)=>e.jsx(te,{label:s,sx:{marginLeft:u>0&&2,cursor:"pointer",textTransform:"capitalize",paddingX:2,paddingY:.4},color:"primary",variant:z===s?"filled":"outlined",onClick:()=>me(s),children:s},u))})]}),e.jsx(M,{container:!0,children:e.jsx(M,{item:!0,xs:12,md:11,sm:8,lg:4,xl:4,children:e.jsx(st,{title:"Search",value:R,onChange:s=>ge(s)})})}),S?e.jsx(D,{sx:{padding:4,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Te,{size:20})}):N?e.jsx(D,{sx:{padding:4,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(O,{variant:"body2",children:"There is error fetching the targets"})}):U.length===0?e.jsxs(D,{sx:{padding:4,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx(ht,{size:80,color:g.palette.grey[400]}),e.jsx(O,{variant:"h4",sx:{marginTop:1.6},children:"Target is not found"}),e.jsx(O,{variant:"caption",children:"The list of distributed target will be listed here"})]}):e.jsx(wt,{plans:U})]})]})}),e.jsx(it,{add:E,onClose:oe,onSucceed:()=>Q()}),I&&e.jsx(Se,{type:"Delete",open:I,title:"Deleting Plan",description:"Are you sure you want to delete "+((f=c==null?void 0:c.kpi)==null?void 0:f.name),onNo:()=>F(!1),onYes:()=>ue(),deleting:W,handleClose:()=>F(!1)}),e.jsx(Re,{add:i,onClose:fe,plan_id:c==null?void 0:c.id,targets:c==null?void 0:c.target,naming:Pe((p=c==null?void 0:c.frequency)==null?void 0:p.name)}),e.jsx(nt,{})]})};export{Ut as default};
