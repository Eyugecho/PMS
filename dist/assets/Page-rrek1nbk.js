import{K as le,j as e,ab as fe,ac as Z,bm as be,r as t,Y as _,ap as ye,a8 as l,p as f,bn as Ce,a2 as b,bo as ve,W as ce,a0 as R,ag as Q,bp as Se,aq as W,aI as ke,bq as Te,C as O,au as Re,av as Pe,v as J,J as Ae,am as we,aj as ee,an as se,as as L,E as te,br as Ee,ar as H,a6 as v,al as Me,aB as Ie,a9 as ze,a4 as Be}from"./index-BrIZ1aRM.js";import{F as N}from"./index-CJagu-9E.js";import{C as de}from"./Checkbox-BxN2x0gG.js";import{d as De,a as Oe}from"./Delete-CJ0mWhfC.js";import"./DeletePrompt-Bj6JOZh3.js";import{a as ne,c as re,b as ae,D as oe}from"./DialogTitle-CTwNxPSd.js";import{T as Ne}from"./TableContainer-CbJxeCPv.js";import{S as $e}from"./search-f3t_tkff.js";import{T as Fe,a as ie}from"./Tabs-D9N9hXvN.js";import"./error-DW4k7GIP.js";import"./IconTrash-7HD_GTTn.js";import"./Box-DiQAjjjZ.js";import"./KeyboardArrowRight-pfrJvB3H.js";const Le=le(e.jsx("path",{d:"M16.59 7.58 10 14.17l-3.59-3.58L5 12l5 5 8-8zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"}),"CheckCircleOutline"),We=le(e.jsx("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreHoriz"),qe=fe().shape({roleName:Z().required("Role name is required"),permissions:be().of(Z()).min(1,"At least one permission is required")}),He=({open:M,handleClose:u,permissions:d={},onSave:A})=>{const[w,k]=t.useState(!0),[z,B]=t.useState(!1);t.useEffect(()=>{Object.keys(d).length,k(!1)},[d]);const P=_();return e.jsx(ye,{open:M,onClose:u,sx:{backdropFilter:"blur(10px)",backgroundColor:"rgba(255, 255, 255, 0.1)"},children:e.jsxs(l,{sx:{position:"absolute",top:"50%",left:"50%",maxHeight:"80vh",overflowY:"auto",transform:"translate(-50%, -50%)",width:"50%",bgcolor:"background.paper",boxShadow:24,borderRadius:2,p:4},children:[e.jsx(f,{variant:"subtitle1",children:"Role and Permission"}),e.jsx(Ce,{initialValues:{roleName:"",permissions:[]},validationSchema:qe,onSubmit:(y,{resetForm:S,setSubmitting:C,setFieldError:m})=>{if(y.permissions.length===0){m("permissions","Please select at least one permission."),C(!1);return}A(y).then(()=>{S(),u(),b.success("Role saved successfully!")}).catch(()=>{b.error("Failed to save role. Please try again.")}).finally(()=>{C(!1)})},children:({values:y,setFieldValue:S,errors:C,touched:m})=>e.jsxs(ve,{children:[e.jsx(ce,{name:"roleName",label:"New Role",value:y.roleName,onChange:T=>S("roleName",T.target.value),error:m.roleName&&!!C.roleName,helperText:m.roleName&&C.roleName,margin:"normal",fullWidth:!0}),e.jsx(R,{container:!0,spacing:2,mt:.5,children:w?e.jsx(l,{sx:{padding:2,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Q,{size:20})}):z?e.jsx(N,{severity:"error",title:"Server error",description:"There is an error fetching Permissions"}):Object.keys(d).length===0?e.jsx(N,{severity:"info",title:"No Permissions Found",description:"The list of added Permissions will be listed here",sx:{paddingTop:6}}):e.jsx(Se,{name:"permissions",render:({push:T,remove:D})=>Object.keys(d).map(x=>e.jsx(R,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(W,{sx:{p:.5,mb:1,backgroundColor:P.palette.grey[100]},children:[e.jsx(f,{variant:"h6",children:x.charAt(0).toUpperCase()+x.slice(1)}),Array.isArray(d[x])&&d[x].map(r=>e.jsx(ke,{control:e.jsx(Te,{type:"checkbox",name:"permissions",value:r.name,as:de,checked:y.permissions.includes(r.name),onChange:()=>{y.permissions.includes(r.name)?S("permissions",y.permissions.filter(a=>a!==r.name)):S("permissions",[...y.permissions,r.name])}}),label:r.name},r.id))]})},x))})}),e.jsx(O,{type:"submit",variant:"contained",color:"primary",sx:{mt:2},children:"Save"}),e.jsx(O,{onClick:u,variant:"",sx:{mt:2,ml:2},children:"Close"}),C.permissions&&m.permissions&&e.jsx(f,{variant:"body2",color:"error",sx:{mt:2,backgroundColor:"rgba(255, 0, 0, 0.1)",padding:"8px",borderRadius:"4px",border:"1px solid red",textAlign:"center"},children:C.permissions})]})})]})})};var V={},_e=Pe;Object.defineProperty(V,"__esModule",{value:!0});var he=V.default=void 0,Ge=_e(Re()),Ue=e;he=V.default=(0,Ge.default)((0,Ue.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-6h2zm0-8h-2V7h2z"}),"Info");const Je=({searchQuery:M})=>{const u=_(),[d,A]=t.useState(!0),[w,k]=t.useState([]),[z,B]=t.useState(!1),[P,y]=t.useState(null),[S,C]=t.useState(null),[m,T]=t.useState(!1),[D,x]=t.useState(!1),[r,a]=t.useState(null),[j,p]=t.useState({name:""});t.useState(!1);const[h,g]=t.useState([]),[E,I]=t.useState([]),$=w.filter(s=>s.name.toLowerCase().includes(M.toLowerCase())),F=()=>{A(!0);const s=localStorage.getItem("token"),n=`${v.auth}${v.roles}`,o={Authorization:`Bearer ${s}`,accept:"application/json","Content-Type":"application/json"};fetch(n,{method:"GET",headers:o}).then(c=>c.json()).then(c=>{c.success&&k(c.data),A(!1)}).catch(c=>{A(!1),B(!0),b(c.message)})},me=(s,n)=>{y(s.currentTarget),C(n)},Y=()=>{y(null),C(null)},K=()=>{T(!1),a(null)},pe=s=>{p({name:s.name}),a(s),I(s.permissions.map(i=>i.uuid)),x(!0),Y();const n=localStorage.getItem("token"),o=v.auth+v.permissi,c={Authorization:`Bearer ${n}`,accept:"application/json","Content-Type":"application/json"};fetch(o,{method:"GET",headers:c}).then(i=>i.json()).then(i=>{i.success?g(i.data):b("Error fetching permissions")}).catch(i=>{b(i.message)})},G=()=>{x(!1),a(null)},ue=s=>{const{name:n,value:o}=s.target;p(c=>({...c,[n]:o}))},xe=s=>{I(n=>n.includes(s)?n.filter(o=>o!==s):[...n,s])},je=()=>{const s=localStorage.getItem("token"),n=v.auth+v.roles+`/${r.uuid}`,o={Authorization:`Bearer ${s}`,accept:"application/json","Content-Type":"application/json"},c={name:j.name,permissions:E};fetch(n,{method:"PATCH",headers:o,body:JSON.stringify(c)}).then(i=>i.json()).then(i=>{i.success?(b("Role updated successfully"),F(),G()):b("Error updating role")}).catch(i=>{b(i.message)})},ge=s=>{const n=localStorage.getItem("token"),o=v.auth+v.roles+`/${s}`,c={Authorization:`Bearer ${n}`,accept:"application/json","Content-Type":"application/json"};fetch(o,{method:"DELETE",headers:c}).then(i=>i.json()).then(i=>{i.success?(k(q=>q.filter(U=>U.uuid!==s)),b("Role deleted successfully"),F()):b("Error deleting role")}).catch(i=>{b(i.message)})},X=s=>s.reduce((n,o)=>{const{type:c}=o;return n[c]||(n[c]=[]),n[c].push(o),n},{});return t.useEffect(()=>{F()},[]),e.jsxs(l,{component:J,sx:{minHeight:"40dvh",width:"100%",border:.4,borderColor:u.palette.grey[300],borderRadius:2,p:2},children:[d?e.jsx(l,{sx:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"40dvh"},children:e.jsx(Q,{size:20})}):z?e.jsx(N,{severity:"error",title:"Server error",description:"There is an error fetching Roles"}):$.length===0?e.jsx(N,{severity:"info",title:"No Roles Found",description:"The list of added Roles will be listed here"}):$.map((s,n)=>e.jsxs(l,{sx:{mb:2},children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(f,{variant:"h3",sx:{mt:1,fontWeight:"bold"},children:s.name}),e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ae,{color:"primary",onClick:o=>me(o,n),children:e.jsx(We,{})}),e.jsxs(we,{anchorEl:P,open:!!P&&S===n,onClose:Y,sx:{"& .MuiPaper-root":{backdropFilter:"blur(10px)",backgroundColor:"rgba(255, 255, 255, 0.3)",borderRadius:2,boxShadow:u.shadows[1]}},children:[e.jsx(ee,{onClick:()=>pe(s),children:e.jsxs(se,{children:[e.jsx(De,{fontSize:"small",style:{paddingRight:"4px",color:"gray"}})," Edit"]})}),e.jsx(ee,{onClick:()=>ge(s.uuid),children:e.jsxs(se,{children:[e.jsx(Oe,{fontSize:"small",style:{paddingRight:"4px",color:"red"}})," Delete"]})})]})]})]}),e.jsx(L,{sx:{borderBottom:.4,borderColor:u.palette.grey[300],my:2}}),e.jsx(l,{sx:{mb:2},children:Object.entries(X(s.permissions)).map(([o,c],i)=>e.jsxs(l,{sx:{mb:3},children:[e.jsxs(f,{variant:"h5",sx:{textTransform:"capitalize",mb:2,color:u.palette.primary.main,display:"flex",alignItems:"center"},children:[e.jsx(he,{sx:{mr:1}}),"Assigned Permissions"]}),e.jsx(l,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:2},children:c.map((q,U)=>e.jsxs(J,{elevation:1,sx:{padding:2,borderRadius:2,backgroundColor:u.palette.background.paper,transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out","&:hover":{transform:"scale(1.02)",boxShadow:u.shadows[8]}},children:[e.jsx(f,{variant:"body1",sx:{fontWeight:"bold",mb:1},children:q.name}),e.jsx(f,{variant:"body2",color:"textSecondary",children:q.description||"No description available"}),e.jsx(te,{label:"Assigned",color:"success",size:"small",sx:{mt:1,fontWeight:"bold",fontSize:"0.75rem"}})]},U))})]},i))}),e.jsx(L,{sx:{borderBottom:.4,borderColor:u.palette.grey[300],my:3}})]},s.uuid)),e.jsxs(ne,{open:D,onClose:G,fullWidth:!0,maxWidth:"lg",children:[e.jsx(re,{children:"Edit Role"}),e.jsx(ae,{children:e.jsxs(l,{children:[e.jsx(ce,{label:"Role Name",name:"name",value:j.name,onChange:ue,fullWidth:!0,margin:"dense"}),e.jsx(L,{sx:{mb:2}}),e.jsx(R,{container:!0,spacing:3,children:h.length===0?e.jsx(f,{children:"No permissions available"}):Object.entries(X(h)).map(([s,n])=>e.jsx(R,{item:!0,xs:12,children:e.jsxs(W,{variant:"outlined",sx:{boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",transition:"transform 0.2s","&:hover":{transform:"scale(1.01)"}},children:[e.jsx(Ee,{title:"Permissions",sx:{backgroundColor:"#f5f5f5",color:"#333",fontWeight:"bold",textTransform:"uppercase"}}),e.jsx(H,{children:e.jsx(R,{container:!0,spacing:0,children:n.map(o=>e.jsx(R,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",p:1,borderRadius:"2px",transition:"background-color 0.3s","&:hover":{backgroundColor:"#f0f0f0"}},children:[e.jsx(de,{checked:E.includes(o.uuid),onChange:()=>xe(o.uuid)}),e.jsx(f,{sx:{ml:1},children:o.name})]})},o.uuid))})})]})},s))})]})}),e.jsxs(oe,{children:[e.jsx(O,{onClick:G,children:"Cancel"}),e.jsx(O,{onClick:je,color:"primary",children:"Save"})]})]}),e.jsxs(ne,{open:m,onClose:K,children:[e.jsx(re,{children:"Role Details"}),e.jsxs(ae,{children:[e.jsx(f,{variant:"h6",children:"Role Name:"}),e.jsx(f,{children:r==null?void 0:r.name}),e.jsx(f,{variant:"h6",sx:{mt:2},children:"Permissions:"}),e.jsx(L,{sx:{mb:2}}),e.jsx(l,{sx:{display:"flex",flexWrap:"wrap"},children:(r==null?void 0:r.permissions.length)===0?e.jsx(f,{children:"No permissions assigned"}):r==null?void 0:r.permissions.map(s=>e.jsx(te,{label:s.name,sx:{mr:1,mb:1}},s.uuid))})]}),e.jsx(oe,{children:e.jsx(O,{onClick:K,children:"Close"})})]})]})},Qe=({onPermissionsFetch:M,onDelete:u})=>{const d=_(),[A,w]=t.useState(!0),[k,z]=t.useState({}),[B,P]=t.useState(!1),[y,S]=t.useState({}),C=()=>{w(!0);const m=localStorage.getItem("token"),T=v.auth+v.permissi,D={Authorization:`Bearer ${m}`,accept:"application/json","Content-Type":"application/json"};fetch(T,{method:"GET",headers:D}).then(x=>x.json()).then(x=>{if(w(!1),x.success){const r=x.data,a=r.reduce((p,h)=>{const g=h.name.split(":")[1];return p[g]||(p[g]=[]),p[g].push({name:h.name,id:h.uuid}),p},{}),j=r.reduce((p,h)=>(p[h.name]=h.uuid,p),{});z(a),S(j),M(r)}else P(!0)}).catch(x=>{w(!1),P(!0)})};return t.useEffect(()=>{C()},[]),e.jsx(Ne,{component:J,sx:{minHeight:"5dvh",border:.4,borderColor:d.palette.grey[300],borderRadius:1.6,margin:0,marginTop:0,padding:2,backgroundColor:d.palette.background.default},children:A?e.jsx(l,{sx:{padding:2,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Q,{size:20})}):B?e.jsx(N,{severity:"error",title:"Server error",description:"There is an error fetching Permissions"}):Object.keys(k).length===0?e.jsx(N,{severity:"info",title:"Permission not found",description:"The list of added Permissions will be listed here",sx:{paddingTop:6}}):e.jsx(R,{container:!0,spacing:2,children:Object.keys(k).map(m=>e.jsx(R,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(W,{sx:{boxShadow:d.shadows[3],transition:"transform 0.3s","&:hover":{transform:"scale(1.05)"},backgroundColor:d.palette.grey[100]},children:e.jsxs(H,{children:[e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(f,{variant:"h4",fontWeight:"bold",color:"primary",children:m.charAt(0).toUpperCase()+m.slice(1)}),e.jsx(Me,{sx:{backgroundColor:d.palette.primary.light,color:d.palette.primary.main,width:30,height:30},children:e.jsx(Le,{})})]}),e.jsx(L,{sx:{my:1.5}}),e.jsx(l,{children:k[m].map(T=>e.jsx(l,{display:"flex",alignItems:"center",justifyContent:"space-between",sx:{marginBottom:1,padding:1,backgroundColor:d.palette.grey[50],borderRadius:1},children:e.jsx(Ie,{title:T.name,placement:"top",children:e.jsx(f,{variant:"body5",noWrap:!0,sx:{maxWidth:"180px",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:T.name})})},T.id))})]})})},m))})})},ls=()=>{const[M,u]=t.useState([]),[d,A]=t.useState([]),[w,k]=t.useState(!1),[z,B]=t.useState({}),[P,y]=t.useState(""),[S,C]=t.useState("permissions");_(),t.useEffect(()=>{m()},[]);const m=async()=>{try{const a=localStorage.getItem("token"),j=await fetch(`${v.auth+v.roles}`,{headers:{Authorization:`Bearer ${a}`,accept:"application/json","Content-Type":"application/json"}}),p=await j.json();j.ok?u(p.data):b.error(p.message||"Failed to fetch roles")}catch{b.error("An error occurred while fetching roles")}},T=async a=>{try{const j=localStorage.getItem("token"),p=Object.values(d).flat(),h=a.permissions.map(I=>{const $=p.find(F=>F.name===I);return $?$.id:null}).filter(I=>I!==null),g=await fetch(`${v.auth+v.roles}`,{method:"POST",headers:{Authorization:`Bearer ${j}`,accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({name:a.roleName,permissions:h})}),E=await g.json();g.ok?(u(I=>[...I,E.data]),m()):b.error(E.message||"Failed to add role")}catch{b.error("An error occurred while adding the role")}},D=a=>{u(M.filter(j=>j.name!==a))},x=a=>{if(Array.isArray(a)){const j=a.reduce((h,g)=>{const E=g.name.split(":")[1];return h[E]||(h[E]=[]),h[E].push({name:g.name,id:g.uuid}),h},{}),p=a.reduce((h,g)=>(h[g.name]=g.uuid,h),{});A(j),B(p)}},r=(a,j)=>{C(j)};return e.jsx(ze,{maxWidth:"lg",title:"Role and Permission",children:e.jsx(Be,{sx:{marginLeft:"10px",marginTop:"20px"},children:e.jsxs(l,{p:3,children:[e.jsxs(Fe,{value:S,onChange:r,color:"#003B73",backgroundColor:"#003B73","aria-label":"Role and Permissions Tabs",children:[e.jsx(ie,{value:"permissions",label:"Menus List",sx:{fontSize:"17px"}}),e.jsx(ie,{value:"roles",label:"Roles",sx:{fontSize:"17px"}})]}),S==="permissions"&&e.jsx(l,{children:e.jsx(R,{container:!0,spacing:3,children:e.jsx(R,{item:!0,xs:12,children:e.jsx(W,{children:e.jsx(H,{children:e.jsx(Qe,{onPermissionsFetch:x})})})})})}),S==="roles"&&e.jsxs(l,{mt:2,children:[e.jsx(R,{container:!0,spacing:3,children:e.jsx(R,{item:!0,xs:12,children:e.jsx(W,{children:e.jsxs(H,{children:[e.jsxs(l,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx($e,{value:P,onChange:a=>y(a.target.value)}),e.jsx(O,{variant:"contained",color:"primary",onClick:()=>k(!0),children:"Add Role"})]}),e.jsx(Je,{roles:M,onDelete:D,searchQuery:P})]})})})}),e.jsx(He,{open:w,handleClose:()=>k(!1),permissions:d,onSave:T})]})]})})})};export{ls as default};
