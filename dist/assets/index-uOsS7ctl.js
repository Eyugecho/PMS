import{l as J,r as i,j as e,aK as ce,T as $,U as N,V as O,a2 as he,a3 as ue,bn as me,B as j,M as pe,N as q,R as H,O as ge,_ as xe,m as D,$ as je,I as fe,a0 as Ce,a1 as be,W as L,C as ee,a4 as we,Y as Q,Z as ye,h as w,ad as Se,n as Te,G as F,ae as ve,af as Ue,ag as Ae,au as Re,d as Pe,av as Fe,F as Ee,q as ke,v as Ie,w as qe,x as Z,y as m,z as $e,i as We,aF as _e,ah as Be,aj as ze,f as M}from"./index-DL-CLDEe.js";import{A as Me}from"./Autocomplete-D8TvuXv2.js";import"./Close-B1KvSMQT.js";const Ne=({add:S,isAdding:l,roles:T,onClose:W,onSubmit:U})=>{J();const[d,v]=i.useState({name:"",email:"",phone:"",password:"",password_confirmation:"",roles:[]}),y=n=>{const{name:p,value:R}=n.target;v({...d,[p]:R})},A=n=>{const p=n.target.value;v({...d,roles:p})},E=n=>{if(n.preventDefault(),!d.email||!d.password||!d.name){j.error("Please fill all required fields.");return}U(d)};return e.jsxs(ce,{open:S,title:"Add User",handleClose:W,onCancel:W,onSubmit:n=>E(n),submitting:l,children:[e.jsx($,{fullWidth:!0,label:"Name",name:"name",value:d.name,onChange:y,margin:"normal",required:!0}),e.jsx($,{fullWidth:!0,label:"Email",name:"email",value:d.email,onChange:y,margin:"normal",required:!0}),e.jsx($,{fullWidth:!0,label:"Phone",name:"phone",value:d.phone,onChange:y,margin:"normal"}),e.jsx($,{fullWidth:!0,label:"Password",name:"password",type:"password",value:d.password,onChange:y,margin:"normal",required:!0}),e.jsx($,{fullWidth:!0,label:"Confirm Password",name:"password_confirmation",type:"password",value:d.password_confirmation,onChange:y,margin:"normal",required:!0}),e.jsxs(N,{fullWidth:!0,margin:"normal",children:[e.jsx(O,{children:"Roles"}),e.jsx(he,{multiple:!0,value:d.roles,onChange:A,renderValue:n=>T.filter(p=>n.includes(p.uuid)).map(p=>p.name).join(", "),children:T.map(n=>e.jsx(ue,{value:n.uuid,children:e.jsx(me,{primary:n.name})},n.uuid))})]})]})},Oe=pe().shape({name:q().required("Full name is required"),email:q().email().required("Email is required"),username:q().required("Username is required"),phone:q().required("Phone number is required"),created_at:q().required("Start date is required"),role:q().required("Role is required")}),Ve=({open:S,userData:l,onClose:T,onSave:W,isUpdating:U,handleSubmission:d})=>{i.useState({name:"",email:"",phone:"",roles:[]});const[v,y]=i.useState([]),[A,E]=H.useState([]),[n,p]=H.useState([]),R=J(),_=(r,c)=>{p(c),console.log(c);const f=c.find(C=>!n.some(x=>x.uuid===C.uuid)),h=n.find(C=>!c.some(x=>x.uuid===C.uuid));f&&E(C=>[...C,f.uuid]),h&&E(C=>C.filter(x=>x!==h.uuid))},V=()=>n.map(r=>r.uuid),a=ge({initialValues:{name:"",email:"",username:"",phone:"",role:"",created_at:""},validationSchema:Oe,onSubmit:r=>{d(r,V())}}),B=async()=>{const r=localStorage.getItem("token"),c=w.auth+w.roles,f={Authorization:`Bearer ${r}`,accept:"application/json","Content-Type":"application/json"};fetch(c,{method:"GET",headers:f}).then(h=>h.json()).then(h=>{h.success?y(h.data):toast.error(h.data.message)}).catch(h=>{toast(h.message)})},g=()=>{a.setValues({...a.values,name:l==null?void 0:l.name,email:l==null?void 0:l.email,username:l==null?void 0:l.username,phone:l==null?void 0:l.phone}),p((l==null?void 0:l.roles)||[])};return H.useEffect(()=>(B(),g(),()=>{}),[S]),e.jsxs(xe,{open:S,onClose:T,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(D,{sx:{position:"sticky",top:0,zIndex:2,width:"100%",backgroundColor:R.palette.background.default,display:"flex",alignItems:"center",justifyContent:"space-between",paddingRight:2,paddingY:.6},children:[e.jsx(je,{variant:"h5",color:R.palette.text.primary,children:"Update User"}),e.jsx(fe,{onClick:T,children:e.jsx(Ce,{size:20,color:R.palette.text.primary})})]}),e.jsxs("form",{noValidate:!0,onSubmit:a.handleSubmit,children:[e.jsxs(be,{children:[e.jsxs(N,{fullWidth:!0,error:a.touched.name&&!!a.errors.name,sx:{marginTop:1},children:[e.jsx(O,{htmlFor:"name",children:"Full name"}),e.jsx(L,{id:"name",name:"name",label:"Full name",value:a.values.name,onChange:a.handleChange,fullWidth:!0}),a.touched.name&&a.errors.name&&e.jsx(FormHelperText,{error:!0,id:"standard-weight-helper-text-name",children:a.errors.name})]}),e.jsxs(N,{fullWidth:!0,error:a.touched.email&&!!a.errors.email,sx:{marginTop:2},children:[e.jsx(O,{htmlFor:"email",children:"Email"}),e.jsx(L,{id:"email",name:"email",label:"Email",value:a.values.email,onChange:a.handleChange,fullWidth:!0}),a.touched.email&&a.errors.email&&e.jsx(FormHelperText,{error:!0,id:"standard-weight-helper-text-email",children:a.errors.email})]}),e.jsxs(N,{fullWidth:!0,error:a.touched.phone&&!!a.errors.phone,sx:{marginTop:2},children:[e.jsx(O,{htmlFor:"phone",children:"Phone"}),e.jsx(L,{id:"phone",name:"phone",label:"Phone",value:a.values.phone,onChange:a.handleChange,fullWidth:!0}),a.touched.phone&&a.errors.phone&&e.jsx(FormHelperText,{error:!0,id:"standard-weight-helper-text-phone",children:a.errors.phone})]}),e.jsx(Me,{id:"roles",multiple:!0,options:v||[],getOptionLabel:r=>(r==null?void 0:r.name)||"",value:n,onChange:_,isOptionEqualToValue:(r,c)=>r.uuid===c.uuid,renderTags:(r,c)=>r.map((f,h)=>e.jsx(ee,{className:"roles-chip",label:(f==null?void 0:f.name)||"",...c({index:h})})),fullWidth:!0,renderInput:r=>e.jsx($,{...r,label:"Select Roles",variant:"outlined"}),sx:{marginTop:4}})]}),e.jsxs(we,{children:[e.jsx(Q,{type:"submit",variant:"contained",sx:{paddingX:6,boxShadow:0},disabled:U,children:U?e.jsx(ye,{size:18,sx:{color:"white"}}):"Done"}),e.jsx(Q,{onClick:T,variant:"outlined",color:"inherit",children:"Cancel"})]})]})]})},Je=()=>{const S=J(),[l,T]=i.useState(!1),[W,U]=i.useState(!1),[d,v]=i.useState(!1),[y,A]=i.useState(!1),[E,n]=i.useState(!1),[p,R]=i.useState([]),[_,V]=i.useState([]),[a,B]=i.useState(!1),[g,r]=i.useState({page:0,per_page:10,last_page:0,total:0}),[c,f]=i.useState(""),[h,C]=i.useState(!1),[x,X]=i.useState(null),G=Se();G.some(s=>s.permissions.some(o=>o.name==="create:users"));const se=G.some(s=>s.permissions.some(o=>o.name==="update:users"));G.some(s=>s.permissions.some(o=>o.name==="delete:users"));const ae=(s,o)=>{r({...g,page:o})},te=s=>{r({...g,per_page:s.target.value,page:0})},ne=s=>{const o=s.target.value;f(o),r({...g,page:0})},z=async()=>{U(!0);const s=await M(),o=`${w.auth}${w.users}?page=${g.page}&per_page=${g.per_page}&search=${c}`,b={Authorization:`Bearer ${s}`,accept:"application/json","Content-Type":"application/json"};fetch(o,{method:"GET",headers:b}).then(t=>t.json()).then(t=>{t.success?(V(t.data.data),r({...g,last_page:t.data.last_page,total:t.data.total}),B(!1)):j.warning(t.data.message)}).catch(t=>{j.warning(t.message),B(!0)}).finally(()=>{U(!1)})},re=async s=>{v(!0);const o=await M(),b=`${w.auth}${w.users}`,t={Authorization:`Bearer ${o}`,accept:"application/json","Content-Type":"application/json"},k={email:s.email,password:s.password,password_confirmation:s.password_confirmation,name:s.name,phone:s.phone,roles:s.roles};if(!s.email||!s.password||!s.name){j.error("Please fill all required fields."),v(!1);return}try{const u=await fetch(b,{method:"POST",headers:t,body:JSON.stringify(k)});if(!u.ok){const I=await u.json();throw new Error(I.data.message||"Error adding user")}const P=await u.json();P.success?(j.success(P.data.message),z(),Y()):j.error(P.data.message||"Failed to add user.")}catch(u){j.error(u.message||"An unexpected error occurred.")}finally{v(!1)}},oe=async()=>{const s=await M(),o=`${w.auth}${w.roles}`,b={Authorization:`Bearer ${s}`,accept:"application/json","Content-Type":"application/json"};fetch(o,{method:"GET",headers:b}).then(t=>t.json()).then(t=>{t.success&&R(t.data)}).catch(t=>{j(t.message)})},le=async s=>{A(!0);const o=await M(),b=`${w.auth}${w.users}/${x==null?void 0:x.id}`,t={Authorization:`Bearer ${o}`,accept:"application/json","Content-Type":"application/json"},k={name:s.name,email:s.email,phone:s.phone,roles:s.roles};try{const u=await fetch(b,{method:"PATCH",headers:t,body:JSON.stringify(k)});if(!u.ok){const I=await u.json();throw new Error(I.message||"Error updating user")}(await u.json()).success?(j.success("User updated successfully"),A(!1),z(),K()):(A(!1),j.error("Failed to update user."))}catch(u){j.error(u.message||"An unexpected error occurred.")}finally{A(!1)}},ie=()=>{n(!0),oe()},Y=()=>{n(!1)},de=s=>{X(s),C(!0)},K=()=>{C(!1),X(null)};return i.useEffect(()=>{const s=setTimeout(()=>{z()},800);return()=>clearTimeout(s)},[c]),i.useEffect(()=>{l?z():T(!0)},[g.page,g.per_page]),e.jsxs(Te,{title:"Users",children:[e.jsx(F,{container:!0,children:e.jsxs(F,{item:!0,xs:12,padding:3,children:[e.jsx(F,{item:!0,xs:10,md:12,children:e.jsx(ve,{children:e.jsx(Ue,{children:e.jsxs(D,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(Ae,{title:"Search Employees",value:c,onChange:ne,filter:!1}),e.jsx(Re,{title:"Add User",onPress:ie})]})})})}),e.jsx(F,{container:!0,children:e.jsx(F,{item:!0,xs:12,children:W?e.jsx(F,{container:!0,children:e.jsx(F,{item:!0,xs:12,sx:{display:"flex",alignItems:"center",justifyContent:"center",padding:4},children:e.jsx(Pe,{size:20})})}):a?e.jsx(Fe,{title:"Server Error",message:"Unable to retrieve users."}):_.length===0?e.jsx(Ee,{severity:"evaluation",title:"User Not Found",description:"The list of users will be listed here.",sx:{paddingTop:6}}):e.jsxs(ke,{sx:{minHeight:"66dvh",border:.4,borderColor:S.palette.divider,borderRadius:2},children:[e.jsxs(Ie,{"aria-label":"users table",sx:{minWidth:650},children:[e.jsx(qe,{children:e.jsxs(Z,{children:[e.jsx(m,{children:"Name"}),e.jsx(m,{children:"User Id"}),e.jsx(m,{children:"Email"}),e.jsx(m,{children:"Phone"}),e.jsx(m,{children:"Roles"}),e.jsx(m,{children:"Created At"}),e.jsx(m,{children:"Actions"})]})}),e.jsx($e,{children:_.map(({id:s,name:o,email:b,phone:t,username:k,roles:u,created_at:P})=>e.jsxs(Z,{sx:{":hover":{backgroundColor:S.palette.grey[50]}},children:[e.jsx(m,{children:o}),e.jsx(m,{children:k}),e.jsx(m,{children:b}),e.jsx(m,{children:t}),e.jsx(m,{children:u.map(I=>e.jsx(ee,{label:I.name,color:"primary",variant:"outlined",size:"small",sx:{margin:.5}},I.id))}),e.jsx(m,{children:We(new Date(P),"yyyy-MM-dd")}),e.jsx(m,{sx:{":hover":{backgroundColor:S.palette.grey[50]}},children:e.jsx(_e,{onEdit:se?()=>de({id:s,name:o,email:b,phone:t,username:k,roles:u,created_at:P}):null})})]},s))})]}),e.jsx(Be,{component:"div",count:g.total,page:g.page,onPageChange:ae,rowsPerPage:g.per_page,onRowsPerPageChange:te})]})})})]})}),e.jsx(ze,{}),e.jsx(Ne,{add:E,roles:p,onClose:Y,onSubmit:re,loading:d}),x&&e.jsx(Ve,{open:h,isUpdating:y,userData:x,onClose:K,handleSubmission:(s,o)=>le(s),roles:p})]})};export{Je as default};
