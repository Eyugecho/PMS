import{P as c,l as S,j as e,a as D,G as r,b as h,at as O,R as X,d as U,F as V,u as te,r as g,n as ae,m as N,C as re,ag as se,av as ne,ah as ie,f as R,h as T,B as E,k as oe}from"./index-DL-CLDEe.js";import{P as q}from"./PerformanceCard-BGBIJSie.js";import"./DrogaDonutChart-gWJPFz3l.js";const M=({name:s,unitType:m,manager:n,children:u,onView:o,sx:d})=>{const p=S();return e.jsx(D,{sx:{marginY:1,padding:1.4,paddingX:2,":hover":{transform:"scale(1.02)",transition:"all 0.2s ease-in-out",cursor:"pointer"},...d},onPress:o,children:e.jsxs(r,{container:!0,children:[e.jsx(r,{item:!0,xs:12,children:e.jsxs(r,{container:!0,sx:{display:"flex",alignItems:"flex-start"},children:[e.jsxs(r,{item:!0,xs:12,sm:4,md:4,lg:4,xl:4,children:[e.jsx(h,{variant:"subtitle2",sx:{color:p.palette.text.primary},children:"Unit"}),e.jsx(h,{variant:"h4",sx:{color:p.palette.text.primary,marginY:.6},children:s}),e.jsx(h,{variant:"body1",sx:{color:p.palette.text.primary},children:m&&m})]}),e.jsxs(r,{item:!0,xs:12,sm:4,md:4,lg:4,xl:4,children:[e.jsx(h,{variant:"subtitle2",sx:{color:p.palette.text.primary},children:"Unit Manager"}),e.jsx(h,{variant:"h4",sx:{color:p.palette.text.primary,marginY:1},children:n&&n})]}),e.jsx(r,{item:!0,xs:12,sm:4,md:4,lg:4,xl:4,sx:{display:"flex",alignItems:"center",justifyContent:{xs:"flex-start",sm:"flex-end"},padding:1.6},children:e.jsx(O,{variant:"outlined",color:"primary",title:"View",onPress:o})})]})}),e.jsx(r,{item:!0,xs:12,children:u})]})})};M.propTypes={name:c.string,unitType:c.string,manager:c.string,children:c.node,onView:c.func};const Q=({units:s,onView:m,selected:n,isLoading:u,performance:o})=>{const d=S(),p=t=>{m(t)};return e.jsx(X.Fragment,{children:s==null?void 0:s.map(t=>{var v,x,b;return e.jsx(M,{name:t==null?void 0:t.name,unitType:(v=t==null?void 0:t.unit_type)==null?void 0:v.name,manager:(b=(x=t==null?void 0:t.manager)==null?void 0:x.user)==null?void 0:b.name,onView:()=>p(t),sx:{backgroundColor:n===t.id&&d.palette.grey[50]},children:n===t.id&&(u?e.jsx(r,{container:!0,children:e.jsx(r,{item:!0,xs:12,sx:{display:"flex",alignItems:"center",justifyContent:"center",padding:2},children:e.jsx(U,{size:20})})}):o.length>0?e.jsx(r,{container:!0,sx:{marginTop:2,borderTop:.8,borderColor:d.palette.divider,padding:1},children:e.jsx(r,{item:!0,xs:12,sx:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:o==null?void 0:o.map((f,w)=>{var $;const i=Object.keys(f)[0],[P,y]=i.match(/[a-zA-Z]+|[0-9]+/g),C=`${P} ${y}`;return e.jsx(q,{isEvaluated:f[i].is_evaluated,performance:($=f[i])==null?void 0:$.overall,frequency:C},w)})})}):e.jsx(V,{severity:"performance",title:"No performance report",description:"The list of performances will be listed here",sx:{paddingTop:2}}))},t.id)})})};Q.propTypes={units:c.array,isLoading:c.bool,performance:c.array};const W=({name:s,gender:m,unit:n,position:u,children:o,onView:d,sx:p})=>{const t=S();return e.jsx(D,{sx:{marginY:1,padding:1.4,paddingX:2,":hover":{transform:"scale(1.02)",transition:"all 0.2s ease-in-out",cursor:"pointer"},...p},onPress:d,children:e.jsxs(r,{container:!0,children:[e.jsx(r,{item:!0,xs:12,children:e.jsxs(r,{container:!0,sx:{display:"flex",alignItems:"flex-start"},children:[e.jsxs(r,{item:!0,xs:12,sm:n?3:6,md:n?3:6,lg:n?3:6,xl:n?3:6,children:[e.jsx(h,{variant:"subtitle2",sx:{color:t.palette.text.primary},children:"Employee"}),e.jsx(h,{variant:"h4",sx:{color:t.palette.text.primary,marginY:.6},children:s}),e.jsx(h,{variant:"body1",sx:{color:t.palette.text.primary},children:m&&m})]}),n&&e.jsxs(r,{item:!0,xs:12,sm:3,md:3,lg:3,xl:3,children:[e.jsx(h,{variant:"subtitle2",sx:{color:t.palette.text.primary},children:"Unit"}),e.jsx(h,{variant:"h4",sx:{color:t.palette.text.primary,marginY:1},children:n&&n})]}),e.jsxs(r,{item:!0,xs:12,sm:3,md:3,lg:3,xl:3,children:[e.jsx(h,{variant:"subtitle2",sx:{color:t.palette.text.primary},children:"Position"}),e.jsx(h,{variant:"h4",sx:{color:t.palette.text.primary,marginY:1},children:u&&u})]}),e.jsx(r,{item:!0,xs:12,sm:3,md:3,lg:3,xl:3,sx:{display:"flex",alignItems:"center",justifyContent:{xs:"flex-start",sm:"flex-end"},padding:1.6},children:e.jsx(O,{variant:"outlined",color:"primary",title:"View",onPress:d})})]})}),e.jsx(r,{item:!0,xs:12,children:o})]})})};W.propTypes={name:c.string,gender:c.string,position:c.string,children:c.node,onView:c.func};const Z=({employees:s,onView:m,selected:n,isLoading:u,performance:o})=>{const d=S(),p=t=>{m(t)};return e.jsx(X.Fragment,{children:s==null?void 0:s.map(t=>{var v,x;return e.jsx(W,{name:(v=t==null?void 0:t.user)==null?void 0:v.name,gender:t.gender,unit:(x=t==null?void 0:t.unit)==null?void 0:x.name,position:t==null?void 0:t.position,onView:()=>p(t),sx:{backgroundColor:n===t.id&&d.palette.grey[50]},children:n===t.id&&(u?e.jsx(r,{container:!0,children:e.jsx(r,{item:!0,xs:12,sx:{display:"flex",alignItems:"center",justifyContent:"center",padding:2},children:e.jsx(U,{size:20})})}):o.length>0?e.jsx(r,{container:!0,sx:{marginTop:2,borderTop:.8,borderColor:d.palette.divider,padding:1},children:e.jsx(r,{item:!0,xs:12,sx:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:o==null?void 0:o.map((b,f)=>{var C;const w=Object.keys(b)[0],[i,P]=w.match(/[a-zA-Z]+|[0-9]+/g),y=`${i} ${P}`;return e.jsx(q,{isEvaluated:b[w].is_evaluated,performance:(C=b[w])==null?void 0:C.overall,frequency:y},f)})})}):e.jsx(V,{severity:"performance",title:"No performance report",description:"The list of performances will be listed here",sx:{paddingTop:2}}))},t.id)})})};Z.propTypes={employees:c.array,isLoading:c.bool,performance:c.array};const xe=()=>{const s=te(a=>a.customization.selectedFiscalYear),[m,n]=g.useState(!1),[u,o]=g.useState(!0),[d,p]=g.useState([]),[t,v]=g.useState(!1),[x,b]=g.useState("units"),[f,w]=g.useState(""),[i,P]=g.useState({page:0,per_page:10,total:0}),[y,C]=g.useState(null),[$,Y]=g.useState(!1),[L,_]=g.useState([]),H=a=>{b(a),a!==x&&I(a)},J=a=>{const j=a.target.value;w(j),P({...i,page:0})},K=(a,j)=>{P({...i,page:j})},ee=a=>{P({...i,per_page:a.target.value,page:0})},I=async a=>{o(!0);const j=await R(),k=T.api+T.getActiveDepartments+`?page=${i.page}&per_page=${i.per_page}&search=${f}`,z=T.api+T.getActiveEmployees+`?page=${i.page}&per_page=${i.per_page}&search=${f}`,A=a=="employees"?z:k,F={Authorization:`Bearer ${j}`,accept:"application/json","Content-Type":"application/json"};fetch(A,{method:"GET",headers:F}).then(l=>l.json()).then(l=>{l.success?(p(l.data.data),P({...i,total:l.data.total}),v(!1)):E.warning(l.data.message)}).catch(l=>{E.warning(l.message),v(!0)}).finally(()=>{o(!1)})},B=a=>{(a==null?void 0:a.id)===y?C(null):(C(a==null?void 0:a.id),G(a==null?void 0:a.id))},G=async a=>{if(s){Y(!0);const j=await R(),k=T.api+T.unitPerformance+`${a}?fiscal_year_id=${s==null?void 0:s.id}`,z=T.api+T.employeePerformance+`${a}?fiscal_year_id=${s==null?void 0:s.id}`,A=x=="employees"?z:k,F={Authorization:`Bearer ${j}`,accept:"application/json","Content-Type":"application/json"};fetch(A,{method:"GET",headers:F}).then(l=>l.json()).then(l=>{l.success?(_(l.data.performance),console.log(l.data.performance)):(_([]),E.warning(l.data.message))}).catch(l=>{_([]),E.warning(l.message)}).finally(()=>{Y(!1)})}else return e.jsx(oe,{})};return g.useEffect(()=>{m?y&&G(y):n(!0)},[s]),g.useEffect(()=>{const a=setTimeout(()=>{I(x)},800);return()=>{clearTimeout(a)}},[f]),g.useEffect(()=>{m?I(x):n(!0)},[i.page,i.per_page]),e.jsxs(ae,{title:"Performances",rightOption:e.jsx(N,{sx:{display:"flex",alignItems:"center",marginY:1},children:["units","employees"].map((a,j)=>e.jsx(re,{label:a,sx:{marginLeft:j>0&&2,cursor:"pointer",textTransform:"capitalize",paddingX:2,paddingY:.4},color:"primary",variant:x===a?"filled":"outlined",onClick:()=>H(a)},j))}),children:[e.jsx(r,{container:!0,children:e.jsxs(r,{item:!0,xs:12,sx:{padding:2},children:[e.jsx(N,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingX:1,marginY:2},children:e.jsx(se,{value:f,onChange:a=>J(a)})}),u?e.jsx(r,{container:!0,children:e.jsx(r,{item:!0,xs:12,sx:{display:"flex",alignItems:"center",justifyContent:"center",padding:4},children:e.jsx(U,{size:20})})}):t?e.jsx(ne,{title:"Server Error",message:`Unable to retrive ${x} performance `}):d.length===0?e.jsx(V,{severity:"units",title:`${x} are not found`,description:`The list of ${x} performance will be listed here`,sx:{paddingTop:6}}):x==="employees"?e.jsx(Z,{employees:d,onView:a=>B(a),selected:y,isLoading:$,performance:L}):e.jsx(Q,{units:d,onView:a=>B(a),selected:y,isLoading:$,performance:L})]})}),!u&&d.length>0&&e.jsx(ie,{component:"div",rowsPerPageOptions:[10,25,50,100],count:i.total,rowsPerPage:i.per_page,page:i.page,onPageChange:K,onRowsPerPageChange:ee})]})};export{xe as default};
