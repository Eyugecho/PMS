import{P as D,j as e,M as q,B as x,i as R,r as g,bj as W,bk as _,bl as $,l as H,G as t,bm as U,a as G,b as f,F as w,e as b,O as y,f as j,al as O,I as V,bn as N,bo as Q,a8 as I,bp as J,ar as K,h as X,bq as Y,br as Z,n as ee,bs as C,ap as se,bt as te,bu as ne,T as k}from"./index-CsFgNO3o.js";import{a as ie}from"./axios-BRiE0AY8.js";import{c as ae}from"./config-By_uygwP.js";import{S as v}from"./storage-Cxal_ji7.js";import{A as re}from"./AuthFooter-BaaCzGKb.js";import"./Link-D1zGLmNm.js";const A=({children:a,...r})=>e.jsx(q,{sx:{maxWidth:{xs:400,lg:475},margin:{xs:2.5,md:3},"& > *":{flexGrow:1,flexBasis:"50%"}},content:!1,...r,children:e.jsx(x,{sx:{p:{xs:2,sm:3,xl:2}},children:a})});A.propTypes={children:D.node};const oe=({...a})=>{const r=R(),{signin:B}=g.useContext(W),P=_(s=>s.customization),S=$(),u=H(),[p,E]=g.useState(!1),T=()=>{E(!p)},F=s=>{s.preventDefault()},L=async(s,{setErrors:o,setStatus:l,setSubmitting:c})=>{try{const i=await ie.post(`${ae.API_URL}/login-with-email`,{email:s.email,password:s.password});if(i.data.success){const{access_token:n,expires_in:m}=i.data.data;if(typeof n!="string")throw new Error("Invalid token format");const d=Y(n),h={id:d.sub,name:d.name,email:d.email,roles:d.roles,permissions:d.roles.flatMap(z=>z.permissions)},M=new Date(m*1e3).getTime();v.setItem("token",n),v.setItem("tokenExpiration",M),S(Z(h)),B(),ee.success("Login successful!"),C(h.roles,"CEO")?u("/kpi/kpi-managment"):C(h.roles,"Admin")?u("/Eod/Eod-act"):u("/")}else l({success:!1}),o({submit:i.data.data.message}),c(!1)}catch(i){l({success:!1}),o({submit:i.message}),c(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(t,{container:!0,direction:"column",justifyContent:"center",spacing:2,children:e.jsx(t,{item:!0,xs:12,container:!0,alignItems:"center",justifyContent:"center",children:e.jsx(x,{sx:{mb:3}})})}),e.jsx(U,{initialValues:{email:"",password:"",submit:null},validationSchema:G().shape({email:f().email("Must be a valid email").max(255).required("Email is required"),password:f().max(255).required("Password is required")}),onSubmit:L,children:({errors:s,handleBlur:o,handleChange:l,handleSubmit:c,isSubmitting:i,touched:n,values:m})=>e.jsxs("form",{noValidate:!0,onSubmit:c,...a,children:[e.jsxs(w,{style:{display:"flex"},error:!!(n.email&&s.email),children:[e.jsx(b,{htmlFor:"outlined-adornment-email-login",style:{fontSize:"12px"},children:"Email Address / Username"}),e.jsx(y,{id:"outlined-adornment-email-login",type:"email",value:m.email,sx:{marginBottom:"16px"},name:"email",onBlur:o,onChange:l,label:"Email Address / Username",inputProps:{}}),n.email&&s.email&&e.jsx(j,{error:!0,id:"standard-weight-helper-text-email-login",children:s.email})]}),e.jsxs(w,{style:{display:"flex",marginTop:2},error:!!(n.password&&s.password),children:[e.jsx(b,{htmlFor:"outlined-adornment-password-login",style:{fontSize:"12px"},children:"Password"}),e.jsx(y,{id:"outlined-adornment-password-login",type:p?"text":"password",value:m.password,name:"password",sx:{marginBottom:"16px"},onBlur:o,onChange:l,endAdornment:e.jsx(O,{position:"end",children:e.jsx(V,{"aria-label":"toggle password visibility",onClick:T,onMouseDown:F,edge:"end",size:"large",children:p?e.jsx(N,{}):e.jsx(Q,{})})}),label:"Password",color:"primary"}),n.password&&s.password&&e.jsx(j,{error:!0,id:"standard-weight-helper-text-password-login",children:s.password})]}),e.jsx(I,{direction:"row",alignItems:"center",justifyContent:"flex-end",spacing:1,children:e.jsx(J,{to:"/forgot-password",variant:"subtitle1",sx:{textDecoration:"none",cursor:"pointer"},children:"Forgot Password?"})}),s.submit&&e.jsx(x,{sx:{mt:3},children:e.jsx(j,{error:!0,children:s.submit})}),e.jsx(x,{sx:{mt:4},children:e.jsx(K,{children:e.jsx(X,{disableElevation:!0,disabled:i,fullWidth:!0,size:"large",type:"submit",variant:"contained",sx:{padding:1.6,transition:"all .2s ease-in-out",'&[aria-controls="menu-list-grow"],&:hover':{background:r.palette.primary[800]},borderRadius:`${P.borderRadius}px`},children:"Sign in"})})})]})})]})},he=()=>{const a=se(r=>r.breakpoints.down("md"));return e.jsx(te,{children:e.jsxs(t,{container:!0,direction:"column",justifyContent:"flex-end",sx:{minHeight:"100vh"},children:[e.jsx(t,{item:!0,xs:12,children:e.jsx(t,{container:!0,justifyContent:"center",alignItems:"center",sx:{minHeight:"calc(100vh - 68px)"},children:e.jsx(t,{item:!0,sx:{m:{xs:1,sm:3},mb:0},children:e.jsx(A,{children:e.jsxs(t,{container:!0,spacing:2,alignItems:"center",justifyContent:"center",children:[e.jsx(t,{item:!0,children:e.jsx(ne,{})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(t,{container:!0,direction:{xs:"column-reverse",md:"row"},alignItems:"center",justifyContent:"center",children:e.jsx(t,{item:!0,children:e.jsxs(I,{alignItems:"center",justifyContent:"center",spacing:1,children:[e.jsx(k,{color:"primary.main",gutterBottom:!0,variant:a?"h3":"h2",children:"Hi, Welcome"}),e.jsx(k,{variant:"caption",fontSize:"16px",textAlign:{xs:"center",md:"inherit"},children:"Enter your credentials to continue"})]})})})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(oe,{})})]})})})})}),e.jsx(t,{item:!0,xs:12,sx:{m:3,mt:1},children:e.jsx(re,{})})]})})};export{he as default};
