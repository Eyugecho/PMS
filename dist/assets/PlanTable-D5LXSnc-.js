import{ab as Y,ac as I,P as x,Y as U,ad as Z,r as n,j as e,a8 as ee,J as H,ah as se,S as B,U as W,af as D,V as O,C as g,ag as re,R as V,v as ae,p as te,aO as ie,at as oe,a5 as le,a2 as k,a6 as q}from"./index-CB3M8AEN.js";import{P as ne}from"./index-C_-DKd_R.js";import{a as ce,c as de,b as ue,D as he}from"./DialogTitle-By-U4odQ.js";import{T as xe}from"./TableContainer-BePYmVWY.js";import{T as z,a as K,b,c as N}from"./TableRow-C8yWtStn.js";import{T as r}from"./TableCell-HbngNqTB.js";import{K as je,a as me}from"./KeyboardArrowUp-yTYEmYwF.js";const be=Y().shape({actual_value:I().required("Evaluation value is required"),description:I()}),M=({add:j,isAdding:f,unitName:p,currentValue:d,onClose:i,handleSubmission:c})=>{const m=U(),t=Z({initialValues:{actual_value:"",description:""},validationSchema:be,onSubmit:u=>{c(u)}});return n.useEffect(()=>{d&&t.setValues({actual_value:d>0?d:""})},[d]),e.jsx(n.Fragment,{children:e.jsxs(ce,{open:j,onClose:i,children:[e.jsxs(ee,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingRight:2,backgroundColor:m.palette.grey[50]},children:[e.jsx(de,{variant:"h4",color:m.palette.text.primary,children:p&&p+" Evaluation"}),e.jsx(H,{onClick:i,children:e.jsx(se,{size:20})})]}),e.jsxs("form",{noValidate:!0,onSubmit:t.handleSubmit,children:[e.jsxs(ue,{children:[e.jsxs(B,{fullWidth:!0,error:t.touched.actual_value&&!!t.errors.actual_value,sx:{marginTop:1},children:[e.jsx(W,{htmlFor:"actual_value",children:"Actual Value"}),e.jsx(D,{id:"actual_value",name:"actual_value",label:"Actual Value",value:t.values.actual_value,onChange:t.handleChange,fullWidth:!0}),t.touched.actual_value&&t.errors.actual_value&&e.jsx(O,{error:!0,id:"standard-weight-helper-text-actual_value",children:t.errors.actual_value})]}),e.jsxs(B,{fullWidth:!0,error:t.touched.description&&!!t.errors.description,sx:{marginTop:3},children:[e.jsx(W,{htmlFor:"description",children:"Remark (optional)"}),e.jsx(D,{id:"description",name:"description",label:"Remark (optional)",value:t.values.description,onChange:t.handleChange,fullWidth:!0,multiline:!0,rows:4}),t.touched.description&&t.errors.description&&e.jsx(O,{error:!0,id:"standard-weight-helper-text-description",children:t.errors.description})]})]}),e.jsxs(he,{sx:{paddingX:2},children:[e.jsx(g,{onClick:i,sx:{marginLeft:10},children:"Cancel"}),e.jsx(g,{type:"submit",variant:"contained",sx:{paddingX:6,boxShadow:0,borderRadius:2},disabled:f,children:f?e.jsx(re,{size:18,sx:{color:"white"}}):"Submit"})]})]})]})})};M.propTypes={add:x.bool,isAdding:x.bool,unitName:x.string,currentValue:x.number,onClose:x.func,handleSubmission:x.func};const _e=({plans:j,unitName:f,unitType:p,onRefresh:d})=>{const i=U(),[c,m]=n.useState(null),[t,u]=n.useState(null),[_,X]=n.useState(null),[$,y]=n.useState(!1),[J,v]=n.useState(!1),[L,S]=n.useState("0"),w=s=>{c===s?(m(null),u(null)):(m(s),u(null))},G=s=>{u(t===s?null:s)},A=(s,o,h)=>{G(s),X(s),S(h==="update"?o:"0"),y(!0)},Q=async s=>{v(!0);const o=await le(),h=q.api+q.evaluate,C={Authorization:`Bearer ${o}`,accept:"application/json","Content-Type":"application/json"},T={target_setting_id:_,actual_value:s==null?void 0:s.actual_value,description:s==null?void 0:s.description};fetch(h,{method:"POST",headers:C,body:JSON.stringify(T)}).then(l=>l.json()).then(l=>{l.success?(v(!1),R(),k.success(l.data.message),d()):(v(!1),k.error(l.data.message))}).catch(l=>{k.error(l.message),v(!1)})},R=()=>{y(!1)};return e.jsxs(V.Fragment,{children:[e.jsx(xe,{component:ae,sx:{minHeight:"22dvh"},children:e.jsxs(z,{sx:{minWidth:450},"aria-label":"unit plan table",children:[e.jsx(K,{children:e.jsxs(b,{children:[e.jsx(r,{children:"KPI Name"}),e.jsx(r,{children:"Inherited Weights(%)"}),e.jsx(r,{children:"KPI Weights(%)"}),e.jsx(r,{children:"Total Targets"}),e.jsx(r,{children:"Measuring Unit"}),e.jsx(r,{children:"Frequency"}),e.jsx(r,{children:"Action"})]})}),e.jsx(N,{children:j==null?void 0:j.map((s,o)=>{var h,C,T,l,F;return e.jsxs(V.Fragment,{children:[e.jsxs(b,{sx:{backgroundColor:c==o?i.palette.grey[50]:i.palette.background.default,":hover":{backgroundColor:i.palette.grey[50],color:i.palette.background.default,cursor:"pointer",borderRadius:2}},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",border:0},children:[e.jsx(H,{"aria-label":"expand row",size:"small",onClick:()=>w(o),children:c===o?e.jsx(je,{}):e.jsx(me,{})}),e.jsx(te,{variant:"subtitle1",color:i.palette.text.primary,children:(h=s==null?void 0:s.kpi)==null?void 0:h.name})]}),e.jsxs(r,{sx:{border:0},children:[s!=null&&s.inherit_weight?parseFloat(s==null?void 0:s.inherit_weight).toFixed(1)+"%":"N/A"," "]}),e.jsxs(r,{sx:{border:0},children:[parseFloat(s==null?void 0:s.weight).toFixed(1),"%"]}),e.jsx(r,{sx:{border:0},children:s==null?void 0:s.total_target}),e.jsx(r,{sx:{border:0},children:(T=(C=s==null?void 0:s.kpi)==null?void 0:C.measuring_unit)==null?void 0:T.name}),e.jsx(r,{sx:{border:0},children:(l=s==null?void 0:s.frequency)==null?void 0:l.name}),e.jsx(r,{sx:{border:0},children:e.jsx(g,{variant:"outlined",onClick:()=>w(o),children:"Targets"})})]}),c==o&&e.jsx(b,{children:e.jsx(r,{colSpan:7,children:e.jsx(ie,{in:c!==null,timeout:"auto",unmountOnExit:!0,children:e.jsxs(z,{sx:{minWidth:650},"aria-label":"Organization plan table",children:[e.jsx(K,{children:e.jsxs(b,{children:[e.jsx(r,{children:"Periods"}),e.jsx(r,{children:"Targets"}),e.jsx(r,{children:"Actuals"}),(s==null?void 0:s.target.some(a=>a.can_be_evaluate===!0))&&e.jsx(r,{children:"Action"})]})}),e.jsx(N,{children:(F=s==null?void 0:s.target)==null?void 0:F.map((a,E)=>{var P;return e.jsxs(b,{sx:t==a.id?{backgroundColor:i.palette.grey[100],":hover":{backgroundColor:i.palette.grey[100],color:i.palette.background.default,cursor:"pointer",borderRadius:2}}:{backgroundColor:i.palette.primary.light,":hover":{backgroundColor:i.palette.grey[100],color:i.palette.background.default,cursor:"pointer",borderRadius:2}},children:[e.jsx(r,{sx:{border:0},children:ne((P=s==null?void 0:s.frequency)==null?void 0:P.name)+" "+(E+1)}),e.jsx(r,{sx:{border:0},children:a==null?void 0:a.target}),e.jsx(r,{sx:{border:0},children:a==null?void 0:a.actual_value}),(a==null?void 0:a.can_be_evaluate)&&((a==null?void 0:a.actual_value)==0?e.jsx(r,{sx:{border:0},children:e.jsx(g,{variant:"contained",sx:{boxShadow:0},onClick:()=>A(a.id,0,"evaluate"),children:"Evaluate"})}):e.jsx(r,{sx:{border:0},children:e.jsx(g,{variant:"text",sx:{boxShadow:0},onClick:()=>A(a.id,a==null?void 0:a.actual_value,"update"),children:"Update Evaluation"})}))]},E)})})]})})})})]},o)})})]})}),_&&e.jsx(M,{add:$,unitName:f,unitType:p,isAdding:J,currentValue:L,onClose:R,handleSubmission:s=>Q(s)}),e.jsx(oe,{})]})};export{_e as P};
