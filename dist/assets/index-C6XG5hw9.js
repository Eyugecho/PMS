import{o as be,Y as we,r as h,j as e,a9 as ke,a0 as f,a1 as Ce,a4 as k,a8 as x,p,aj as Se,R as W,as as ve,J as C,ah as Ae,t as K,b0 as N,aK as G,b1 as J,E as Ie,W as H,at as Te,a2 as l,a5 as Re,a6 as U}from"./index-BrIZ1aRM.js";import{D as Ee}from"./DotMenu-7ewWz4Gi.js";import{A as T}from"./ActivityIndicator-BsI2VQVz.js";import{E as X}from"./ErrorPrompt-BxXhExEH.js";import{F as q}from"./index-CJagu-9E.js";import{A as c}from"./workflow-CsLwfZqg.js";import{I as Q}from"./IconCheck-FoBfTDry.js";import{A as ze}from"./Autocomplete-CLcyM-1B.js";import{I as V}from"./IconPlus-CfO6zmqS.js";import"./IconDotsVertical-TdrOCuv3.js";import"./IconTrash-7HD_GTTn.js";import"./error-DW4k7GIP.js";import"./Close-BzhvbiYv.js";var _e=be("details","IconDetails",[["path",{d:"M11.999 3l.001 17",key:"svg-0"}],["path",{d:"M10.363 3.591l-8.106 13.534a1.914 1.914 0 0 0 1.636 2.871h16.214a1.914 1.914 0 0 0 1.636 -2.87l-8.106 -13.536a1.914 1.914 0 0 0 -3.274 0z",key:"svg-1"}]]);const Je=()=>{const r=we(),[Z,L]=h.useState(!0),[F,ee]=h.useState([]),[O,R]=h.useState(!1),[a,Y]=h.useState(null),[te,g]=h.useState(!1),[j,se]=h.useState([]),[E,B]=h.useState(!1),[z,ae]=h.useState(""),[_,P]=h.useState(!1),[m,$]=h.useState(null),ne=j.length>0&&j.length-1,D=j.length>0?j[ne].step_number+1:1,S=h.useRef(null),v=h.useRef(null),[u,y]=h.useState({loading:!1,roles:[],selected:[],add:!1,adding:!1}),[M,A]=h.useState(!1),ie=t=>{S.current&&S.current.contains(t.target)||P(!1)},re=()=>{P(t=>!t)},oe=t=>{v.current&&v.current.contains(t.target)||A(!1)},le=()=>{A(t=>!t)},ce=t=>{Y(t),w(t.id)},de=t=>{(m==null?void 0:m.id)===t.id?($(null),y({...u,selected:[]})):($(t),u.roles.length===0&&je()),A(!1)},he=t=>{const o=t.target.value;ae(o)},pe=t=>{if(t.preventDefault(),z.length<3)l.error("Step name minimum length must be combination of three words");else{B(!0);const o=c.api+c.steps,i={Authorization:`${c.API_KEY}`,accept:"application/json","Content-Type":"appliaction/json"},s={name:z,step_number:D,workflow_id:a==null?void 0:a.id};fetch(o,{method:"POST",headers:i,body:JSON.stringify(s)}).then(n=>n.json()).then(n=>{n.success?(l.success(n.message),w(a.id),P(!1)):l.error(n.error)}).catch(n=>{l.error(n.message)}).finally(()=>{B(!1)})}},me=async t=>{g(!0);const o=c.api+c.steps+`/${t==null?void 0:t.id}`,i={Authorization:`${c.API_KEY}`,"Content-Type":"application/json"};fetch(o,{method:"DELETE",headers:i}).then(s=>s.json()).then(s=>{s.success?(l.success(s.message),w(a.id)):l.error(s.message)}).catch(s=>{l.error(s.message)}).finally(()=>{g(!1)})},xe=(t,o)=>{y({...u,selected:o})},ue=t=>{g(!0);const o=c.api+c.unAssignRole,i={Authorization:`${c.API_KEY}`,"Content-Type":"application/json"},s={step_id:m==null?void 0:m.id,role_id:t==null?void 0:t.role_id};fetch(o,{method:"POST",headers:i,body:JSON.stringify(s)}).then(n=>n.json()).then(n=>{n.success?(l.success(n.message),w(a.id)):l.error(n.message)}).catch(n=>{l.error(n.message)}).finally(()=>{g(!1)})},fe=t=>{t.preventDefault(),A(!1),y({...u,adding:!0});const o=c.api+c.assignRole,i={Authorization:`${c.API_KEY}`,accept:"application/json","Content-Type":"appliaction/json"},s=[];u.selected.forEach(d=>s.push({role_id:d.uuid,role_name:d.name}));const n={roles:s,step_id:m==null?void 0:m.id};fetch(o,{method:"POST",headers:i,body:JSON.stringify(n)}).then(d=>d.json()).then(d=>{d.success?(l.success(d.message),y({...u,selected:[]}),w(a==null?void 0:a.id)):l.error(d.message)}).catch(d=>{l.error(d.message)}).finally(()=>{y({...u,adding:!1})})},ge=async()=>{L(!0);const t=c.api+c.id+"/workflows",o={Authorization:`${c.API_KEY}`,accept:"application/json"};fetch(t,{method:"GET",headers:o}).then(i=>i.json()).then(i=>{var s,n,d,b,I;i.success?(ee((n=(s=i==null?void 0:i.data)==null?void 0:s.applicationWorkflows)==null?void 0:n.workflows),a&&Y((I=(b=(d=i==null?void 0:i.data)==null?void 0:d.applicationWorkflows)==null?void 0:b.workflows)==null?void 0:I.filter(ye=>ye.id===a.id)),R(!1)):(l.warning(i.data.message),R(!1))}).catch(i=>{l.error(i.message),R(!0)}).finally(()=>{L(!1)})},w=async t=>{g(!0);const o=c.api+c.steps+`/${t}`,i={Authorization:`${c.API_KEY}`,accept:"application/json","Content-Type":"application/json"};fetch(o,{method:"GET",headers:i}).then(s=>s.json()).then(s=>{if(s.success){const n=s.data&&s.data.steps.sort((d,b)=>d.step_number-b.step_number);se(n)}else l.warning(s.data.message)}).catch(s=>{l.warning(s.message)}).finally(()=>{g(!1)})},je=async()=>{const t=await Re(),o=U.auth+U.roles,i={Authorization:`Bearer ${t}`,accept:"application/json","Content-Type":"application/json"};fetch(o,{method:"GET",headers:i}).then(s=>s.json()).then(s=>{s.success&&y({...u,roles:s.data})}).catch(s=>{l(s.message)})};return h.useEffect(()=>{ge()},[]),e.jsxs(ke,{title:"Approval Workflows",children:[e.jsx(f,{container:!0,padding:2.5,children:e.jsx(f,{item:!0,xs:12,children:e.jsxs(f,{container:!0,spacing:Ce,sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between"},children:[e.jsx(f,{item:!0,xs:12,sm:12,md:4,lg:4,xl:4,children:e.jsxs(k,{children:[e.jsx(x,{children:e.jsx(p,{variant:"h4",children:"Workflows"})}),Z?e.jsx(f,{container:!0,children:e.jsx(f,{item:!0,xs:12,sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",padding:8},children:e.jsx(T,{size:20})})}):O?e.jsx(X,{title:"Server Error",message:"Unable to retrive workflows",size:120}):F.length===0?e.jsx(q,{severity:"workflow",title:"Workflow is not found",description:"The list of added workflow will be listed here",sx:{paddingTop:6},size:40}):e.jsx(x,{sx:{marginTop:2},children:F.map((t,o)=>e.jsx(Se,{value:t.name,sx:{padding:1.4,marginY:1,borderRadius:2,backgroundColor:(a==null?void 0:a.id)===t.id&&r.palette.primary.main,":hover":{backgroundColor:r.palette.primary.main,"& .MuiTypography-root":{color:"white"}}},onClick:()=>ce(t),children:e.jsx(p,{variant:"subtitle1",color:(a==null?void 0:a.id)===t.id?"white":r.palette.text.primary,sx:{transition:"color 0.3s"},children:t.name})},o))})]})}),e.jsx(f,{item:!0,xs:12,sm:12,md:8,lg:8,xl:8,children:e.jsxs(k,{children:[e.jsx(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:2},children:e.jsxs(p,{variant:"h4",children:[" ",a&&(a==null?void 0:a.name)," Workflow Details"]})}),a!=null&&a.id?e.jsxs(W.Fragment,{children:[e.jsx(p,{variant:"subtitle1",color:r.palette.text.primary,children:"Description"}),e.jsx(p,{variant:"body2",color:r.palette.text.primary,sx:{marginTop:.6},children:a==null?void 0:a.description}),te?e.jsx(f,{container:!0,children:e.jsx(f,{item:!0,xs:12,sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",padding:8},children:e.jsx(T,{size:20})})}):O?e.jsx(X,{title:"Server Error",message:"Unable to retrive workflows details",size:160}):j.length===0?e.jsx(q,{severity:"workflow",title:"There is no step in the selected workflow",description:"The list of workflow id will be listed here",sx:{paddingY:6},size:60}):e.jsxs(W.Fragment,{children:[e.jsx(p,{variant:"h4",sx:{margin:2,marginTop:4},children:"Steps"}),a&&j.map((t,o)=>{var i;return e.jsx(W.Fragment,{children:e.jsxs(x,{sx:{marginX:1.4},children:[e.jsx(k,{onPress:()=>de(t),sx:{backgroundColor:r.palette.grey[50]},children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(p,{variant:"subtitle1",color:r.palette.text.primary,children:["Step ",t.step_number]}),e.jsx(p,{variant:"body2",color:r.palette.text.primary,children:t.name}),e.jsx(Ee,{onDelete:()=>me(t)})]})}),e.jsxs(x,{sx:{display:"flex",alignItems:"center",borderLeft:1,borderColor:r.palette.grey[400],marginLeft:3.8},children:[e.jsx(ve,{orientation:"vertical",sx:{width:0,height:20}}),m&&(m==null?void 0:m.id)==t.id&&e.jsxs(x,{sx:{width:"96%",transition:"all 4s ease"},children:[(i=t==null?void 0:t.roles)==null?void 0:i.map((s,n)=>e.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",marginY:2,padding:1,backgroundColor:r.palette.grey[100],width:"100%",borderTopRightRadius:4,borderBottomRightRadius:4},children:[e.jsx(p,{variant:"subtitle1",color:r.palette.text.primary,children:s==null?void 0:s.role_name}),e.jsx(C,{onClick:()=>ue(s),children:e.jsx(Ae,{size:"1rem",stroke:"2",style:{color:r.palette.grey[500]}})})]},n)),e.jsxs(e.Fragment,{children:[e.jsx(K,{placement:"bottom-start",open:M,anchorEl:v.current,transition:!0,disablePortal:!0,popperOptions:{modifiers:[{name:"offset",options:{offset:[0,4]}}]},children:({TransitionProps:s})=>e.jsx(N,{in:M,...s,children:e.jsx(G,{onClickAway:oe,children:e.jsx(J,{elevation:8,border:!0,content:!1,boxShadow:!0,shadow:r.shadows[4],sx:{padding:0},children:e.jsx(k,{sx:{padding:1.6,minWidth:260},children:e.jsxs("form",{onSubmit:fe,children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:2},children:[e.jsxs(p,{variant:"subtitle1",color:r.palette.text.primary,children:[" ","Add role"]}),e.jsx(C,{sx:{backgroundColor:r.palette.grey[50]},type:"submit",disabled:E,children:u.adding?e.jsx(T,{size:16}):e.jsx(Q,{size:"1.2rem",stroke:"1.8"})})]}),e.jsx(ze,{id:"role-list",multiple:!0,options:u.roles,getOptionLabel:n=>n.name||"",value:u.selected,onChange:xe,renderTags:(n,d)=>n.map((b,I)=>e.jsx(Ie,{label:b.name,...d({index:I})})),fullWidth:!0,renderInput:n=>e.jsx(H,{...n,label:"Select Roles",variant:"standard"}),disableClearable:!0})]})})})})})}),e.jsxs(x,{sx:{display:"flex",alignItems:"center",margin:1,my:2.6},children:[e.jsx(C,{title:"Add Role",onClick:le,sx:{backgroundColor:r.palette.grey[50],marginLeft:.6,cursor:"pointer","& .MuiChip-label":{lineHeight:0}},ref:v,"aria-controls":u.add?"role-popup":void 0,"aria-haspopup":"true",children:e.jsx(V,{size:"1rem",stroke:"1.8"})}),e.jsx(p,{variant:"body2",color:r.palette.text.primary,sx:{marginLeft:1},children:"Add role"})]})]})]})]})]})},o)})]})]}):e.jsxs(x,{sx:{minHeight:200,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:2},children:[e.jsx(_e,{size:"3.4rem",stroke:"1.4",color:r.palette.warning.dark}),e.jsx(p,{variant:"subtitle1",color:r.palette.text.disabled,children:"Worflow Details"})]}),(a==null?void 0:a.id)&&e.jsxs(e.Fragment,{children:[e.jsx(K,{placement:"bottom-start",open:_,anchorEl:S.current,transition:!0,disablePortal:!0,popperOptions:{modifiers:[{name:"offset",options:{offset:[0,4]}}]},children:({TransitionProps:t})=>e.jsx(N,{in:_,...t,children:e.jsx(G,{onClickAway:ie,children:e.jsx(J,{elevation:8,border:!0,content:!1,boxShadow:!0,shadow:r.shadows[4],sx:{padding:0},children:e.jsx(k,{sx:{padding:1.6,minWidth:260},children:e.jsxs("form",{onSubmit:pe,children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:2},children:[e.jsxs(p,{variant:"subtitle1",color:r.palette.text.primary,children:[" ","Step ",e.jsx("b",{children:D&&D})]}),e.jsx(C,{sx:{backgroundColor:r.palette.grey[50]},type:"submit",disabled:E,children:E?e.jsx(T,{size:16}):e.jsx(Q,{size:"1.2rem",stroke:"1.8"})})]}),e.jsx(H,{variant:"standard",placeholder:"Step name",value:z,onChange:he,required:!0,fullWidth:!0})]})})})})})}),e.jsxs(x,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(C,{sx:{backgroundColor:r.palette.grey[100],marginLeft:2.6,cursor:"pointer","& .MuiChip-label":{lineHeight:0}},title:"Add step",ref:S,"aria-controls":_?"menu-list-grow":void 0,"aria-haspopup":"true",onClick:re,children:e.jsx(V,{size:"1.4rem",stroke:"1.8"})}),e.jsx(p,{variant:"subtitle1",color:r.palette.text.primary,sx:{marginLeft:1},children:"Add Step"})]})]})]})})]})})}),e.jsx(Te,{})]})};export{Je as default};
