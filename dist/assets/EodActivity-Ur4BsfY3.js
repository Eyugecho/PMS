import{K as fe,j as e,r as n,_ as q,$ as K,a1 as V,m as P,G as p,T as f,a4 as Y,Y as R,q as J,t as X,v as Z,z as ee,x as v,y as u,l as me,ax as O,i as ve,n as ye,at as be,Q as Ce,w as Se,d as _e,F as G,I as Pe,bP as Te,a7 as De,a3 as I,a8 as w,aa as ke,ab as Ae,ah as Oe,aj as Ie,B as g}from"./index-DL-CLDEe.js";import{c as _}from"./config-By_uygwP.js";import{T as we,a as Q}from"./Tabs-DTopmUqS.js";const Re=fe(e.jsx("path",{d:"M3 14h4v-4H3zm0 5h4v-4H3zM3 9h4V5H3zm5 5h13v-4H8zm0 5h13v-4H8zM8 5v4h13V5z"}),"ViewList"),ze=({open:x,handleClose:j,handleSave:d,formValues:l,handleChange:i,handleTabChange:T,tabIndex:m,editIndex:c,formErrors:s,isLoading:y})=>{const[b,C]=n.useState(!1);return n.useEffect(()=>{C(c!==null)},[c]),e.jsxs(q,{open:x,onClose:j,sx:{backdropFilter:"blur(10px)",backgroundColor:"rgba(255, 255, 255, 0.1)"},children:[e.jsx(K,{children:c!==null?"Edit EOD Activity":"Add EOD Activity"}),e.jsxs(V,{children:[e.jsxs(we,{value:m,onChange:T,children:[e.jsx(Q,{label:"EOD Activity"}),c!==null&&e.jsx(Q,{label:"EOD Revenue"})]}),e.jsxs(P,{mt:2,children:[m===0&&e.jsxs(p,{container:!0,spacing:2,children:[c===null&&e.jsx(p,{item:!0,xs:12,children:e.jsx(f,{fullWidth:!0,label:"Date",name:"date",type:"date",value:l.date||"",onChange:i,InputLabelProps:{shrink:!0},error:!!s.date,helperText:s.date?s.date[0]:""})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(f,{fullWidth:!0,label:"Plan",name:"plan",value:l.plan||"",onChange:i,error:!!s.plan,helperText:s.plan?s.plan[0]:"",InputProps:{readOnly:b},multiline:!0,rows:5,variant:"outlined"})}),c!==null&&e.jsxs(e.Fragment,{children:[e.jsx(p,{item:!0,xs:12,children:e.jsx(f,{fullWidth:!0,label:"Completed",name:"completed",value:l.completed||"",onChange:i,error:!!s.completed,helperText:s.completed?s.completed[0]:"",multiline:!0,rows:5,variant:"outlined"})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(f,{fullWidth:!0,label:"Challenge Faced",name:"challenge_faced",value:l.challenge_faced||"",onChange:i,error:!!s.challenge_faced,helperText:s.challenge_faced?s.challenge_faced[0]:"",multiline:!0,rows:5,variant:"outlined"})})]})]}),m===1&&c!==null&&e.jsxs(p,{container:!0,spacing:2,children:[e.jsx(p,{item:!0,xs:12,children:e.jsx(f,{fullWidth:!0,label:"Revenue",name:"revenue",value:l.revenue||"",onChange:i,error:!!s.revenue,helperText:s.revenue?s.revenue[0]:""})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(f,{fullWidth:!0,label:"Expenses",name:"expenses",value:l.expenses||"",onChange:i,error:!!s.expenses,helperText:s.expenses?s.expenses[0]:""})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(f,{fullWidth:!0,label:"Customer Satisfaction",name:"customer_satisfaction",value:l.customer_satisfaction||"",onChange:i,error:!!s.customer_satisfaction,helperText:s.customer_satisfaction?s.customer_satisfaction[0]:""})})]})]})]}),e.jsxs(Y,{children:[e.jsx(R,{onClick:j,color:"primary",children:"Cancel"}),e.jsx(R,{onClick:d,color:"primary",disabled:y,children:y?"Saving...":"Save"})]})]})},$e=({detailOpen:x,handleCloseDetails:j,selectedRecord:d})=>{const l=d?[{id:1,field:"Revenue",value:d.revenue?`${d.revenue} Birr`:"N/A"},{id:2,field:"Expenses",value:d.expenses?`${d.expenses} Birr`:"N/A"},{id:4,field:"Customer Satisfaction",value:d.customer_satisfaction||"N/A"},{id:5,field:"Plan",value:d.Plan||"N/A"}]:[];return e.jsxs(q,{open:x,onClose:j,sx:{backdropFilter:"blur(10px)",backgroundColor:"rgba(255, 255, 255, 0.1)"},children:[e.jsx(K,{children:"Record Details"}),e.jsx(V,{children:d?e.jsx(J,{component:X,children:e.jsx(Z,{children:e.jsx(ee,{children:l.map(i=>e.jsxs(v,{children:[e.jsx(u,{children:i.field}),e.jsx(u,{children:i.value})]},i.id))})})}):e.jsx("p",{children:"No details available."})}),e.jsx(Y,{children:e.jsx(R,{onClick:j,color:"primary",children:"Close"})})]})};function Ue(){const x=me(),[j,d]=n.useState(0);n.useState(5);const[l,i]=n.useState([]),[T,m]=n.useState(!1),[c,s]=n.useState(null),[y,b]=n.useState(!1),[C,z]=n.useState(null),[$,M]=n.useState(null),[B,te]=n.useState(null),[ae,E]=n.useState(!0),[se,Me]=n.useState(!1),[ne,F]=n.useState(0),[le,Be]=n.useState({}),[re,L]=n.useState(!1),[U,S]=n.useState({date:new Date().toISOString().split("T")[0],revenue:"",expenses:"",profit:"",customer_satisfaction:"",plan:"",completed:"",challenge_faced:""}),[h,D]=n.useState({currentPage:0,lastPage:0,per_page:10,total:0});n.useEffect(()=>{k(h.currentPage,h.per_page)},[h.currentPage,h.per_page]);const k=async(t,a)=>{E(!0);try{const o=localStorage.getItem("token"),r=await O.get(`${_.API_URL_Units}/end-of-day-activities`,{params:{page:t,per_page:a},headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}});r.data.success?(i(r.data.data.data.map(N=>({...N,formattedDate:ve(new Date(N.date),"MM/dd/yyyy")}))),D({currentPage:r.data.data.current_page-1,lastPage:r.data.data.last_page,per_page:r.data.data.per_page,total:r.data.data.total})):console.error(r.data.message)}catch(o){console.error("Error fetching data:",o)}finally{E(!1)}},W=t=>{if(t!==null){const a=l[t];S({date:a.date||new Date().toISOString().split("T")[0],revenue:a.revenue||"",expenses:a.expenses||"",profit:a.profit||"",customer_satisfaction:a.customer_satisfaction||"",plan:a.plan||"",completed:a.completed||"",challenge_faced:a.challenge_faced||""})}else S({date:new Date().toISOString().split("T")[0],revenue:"",expenses:"",profit:"",customer_satisfaction:"",plan:"",completed:"",challenge_faced:""});s(t),m(!0)},H=()=>{m(!1),S({date:new Date().toISOString().split("T")[0],revenue:"",expenses:"",profit:"",customer_satisfaction:"",plan:"",completed:"",challenge_faced:""}),s(null),F(0)},ie=async()=>{try{const t=localStorage.getItem("token"),a=c!==null?"PATCH":"POST",o=c!==null?`${_.API_URL_Units}/end-of-day-activities/${l[c].id}`:`${_.API_URL_Units}/end-of-day-activities`;L(!0);const r=await O({method:a,url:o,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},data:U});r.data.success?(k(h.currentPage,h.per_page),H(),g.success("Record saved successfully!")):g.error(r.data.message||"Error occurred")}catch(t){if(t.response)if(t.response.status===422){const{message:a,errors:o}=t.response.data.data;if(a)g.error(a);else{const r=Object.values(o).flat().join(", ");g.error(r||"Validation error occurred.")}}else t.response.data&&t.response.data.message?g.error(t.response.data.message):g.error("Error saving record: "+t.message);else g.error("Error saving record: "+t.message)}finally{L(!1)}},oe=t=>{const{name:a,value:o}=t.target;S(r=>({...r,[a]:o}))},ce=(t,a)=>{F(a)},de=t=>{z(t),b(!0)},pe=()=>{b(!1),z(null)},ue=(t,a)=>{M(t.currentTarget),te(a)},A=()=>{M(null)},xe=async()=>{try{const t=localStorage.getItem("token");await O.delete(`${_.API_URL_Units}/end-of-day-activities/${B.id}`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),g.success("Record deleted successfully!"),k(j+1)}catch{g.error("Error deleting record.")}finally{A()}},he=()=>{W(B.index),A()},ge=(t,a)=>{D(o=>({...o,currentPage:a}))},je=t=>{D(a=>({...a,per_page:parseInt(t.target.value,10),currentPage:0}))};return e.jsxs(ye,{maxWidth:"lg",title:"EOD Reporting",rightOption:e.jsx(be,{title:"Create Activity",variant:"contained",icon:e.jsx(Ce,{size:"1.2rem",stroke:"1.2",style:{marginRight:4}}),sx:{boxShadow:0},onPress:()=>W(null)}),children:[e.jsx(p,{container:!0,sx:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:3.8,px:2},children:e.jsxs(p,{item:!0,xs:12,children:[e.jsx(J,{component:X,children:e.jsxs(Z,{children:[e.jsx(Se,{children:e.jsx(v,{children:["Plan","Completed","Challenges Faced","Date","Actions"].map(t=>e.jsx(u,{sx:{backgroundColor:x.palette.grey[100],fontWeight:"bold",fontSize:"0.9rem",variant:"h3",position:"relative",padding:"12px 16px"},children:t},t))})}),e.jsx(ee,{children:ae?e.jsx(v,{children:e.jsx(u,{colSpan:5,children:e.jsx(P,{sx:{padding:2,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(_e,{size:22})})})}):se?e.jsx(v,{children:e.jsx(u,{colSpan:5,children:e.jsx(P,{sx:{padding:2,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(G,{severity:"error",title:"Server error",description:"There is an error fetching EOD"})})})}):l.length===0?e.jsx(v,{children:e.jsx(u,{colSpan:5,children:e.jsx(P,{sx:{paddingTop:6,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(G,{severity:"EOD",title:"EOD Activity is not found",description:"The list of added EOD activities will be listed here"})})})}):l.map((t,a)=>e.jsxs(v,{sx:{backgroundColor:x.palette.background.paper,borderRadius:2,"&:nth-of-type(odd)":{backgroundColor:x.palette.grey[50]},"&:hover":{backgroundColor:x.palette.grey[100]}},children:[e.jsx(u,{sx:{border:0,padding:"12px 16px"},children:t.plan}),e.jsx(u,{sx:{border:0,padding:"12px 16px"},children:t.completed}),e.jsx(u,{sx:{border:0,padding:"12px 16px"},children:t.challenge_faced}),e.jsx(u,{sx:{border:0,padding:"12px 16px"},children:t.formattedDate}),e.jsxs(u,{sx:{border:0,padding:"12px 16px"},children:[e.jsx(Pe,{onClick:o=>ue(o,{...t,index:a}),children:e.jsx(Te,{})}),e.jsxs(De,{anchorEl:$,open:!!$,onClose:A,sx:{"& .MuiPaper-root":{backdropFilter:"blur(10px)",backgroundColor:"rgba(255, 255, 255, 0.3)",borderRadius:2,boxShadow:x.shadows[1]}},children:[e.jsxs(I,{onClick:he,children:[" ",e.jsx(w,{children:e.jsx(ke,{fontSize:"small",style:{paddingRight:"2px",color:"#11365A"}})}),"Update"]}),e.jsxs(I,{onClick:()=>de(t),children:[" ",e.jsx(w,{children:e.jsx(Re,{fontSize:"small",style:{paddingRight:"2px",color:"#11365A"}})}),"Details"]}),e.jsxs(I,{onClick:xe,children:[" ",e.jsx(w,{children:e.jsx(Ae,{fontSize:"small",style:{paddingRight:"2px",color:"red"}})}),"Delete"]})]})]})]},t.id))})]})}),e.jsx(Oe,{rowsPerPageOptions:[10,25,50,100],rowsPerPage:h.per_page,component:"div",count:h.total,page:h.currentPage,onPageChange:ge,onRowsPerPageChange:je})]})}),e.jsx(ze,{open:T,handleClose:H,handleSave:ie,formValues:U,handleChange:oe,handleTabChange:ce,tabIndex:ne,editIndex:c,formErrors:le,isLoading:re}),e.jsx($e,{detailOpen:y,handleCloseDetails:pe,selectedRecord:C}),e.jsx(Ie,{})]})}export{Ue as default};
