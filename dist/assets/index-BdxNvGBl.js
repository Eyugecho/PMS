import{c as Q,a as X,b as z,u as G,j as e,r as x,B as b,I as U,d as K,F as k,e as I,S as W,T as S,f as B,O as M,h as _,C as D,i as P,k as Z,l as ee,m as ne,G as A,D as te,Q as re,n as y,o as u}from"./index-CsFgNO3o.js";import{D as se,a as ae,b as ie,c as oe}from"./DialogTitle-D1Q0RY_x.js";import{M as E}from"./MenuItem-BvD3M8VG.js";import{F as w}from"./index-D0P4nc-w.js";import{S as de}from"./search-Q2QaBXfU.js";import{I as le}from"./IconPlus-3lROdy1r.js";import{P as ce}from"./MainPage-CJwvk7F6.js";import{I as he,a as pe,b as me}from"./IconPencil-LUwePxj3.js";import{I as xe}from"./IconTrash-D_o8MoK5.js";import{T as ge}from"./TableContainer-qijX9D2r.js";import{T as je,a as ue,b as $,c as fe}from"./TableRow-CVrgL676.js";import{T}from"./TableCell-F9dx6MLR.js";var ye=Q("check","IconCheck",[["path",{d:"M5 12l5 5l10 -10",key:"svg-0"}]]);const be=X().shape({name:z().required("Unit name is required"),parent_id:z().required("Unit is required"),type:z().required("Unit type is required")}),Ce=({add:o,isAdding:c,units:l,types:r,managers:h,onClose:p,handleSubmission:g})=>{const n=G({initialValues:{name:"",parent_id:"",type:"",manager:null,description:""},validationSchema:be,onSubmit:s=>{g(s)}});return e.jsx(x.Fragment,{children:e.jsxs(se,{open:o,onClose:p,children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingRight:2},children:[e.jsx(ae,{variant:"h4",children:"Add Unit"}),e.jsx(U,{onClick:p,children:e.jsx(K,{size:20})})]}),e.jsxs("form",{noValidate:!0,onSubmit:n.handleSubmit,children:[e.jsxs(ie,{children:[e.jsxs(k,{fullWidth:!0,error:n.touched.parent_id&&!!n.errors.parent_id,children:[e.jsx(I,{htmlfor:"unit",children:"Select unit"}),e.jsx(W,{id:"unit",name:"parent_id",label:"Select unit",value:n.values.parent_id,onChange:n.handleChange,children:l.length===0?e.jsx(S,{variant:"body2",sx:{padding:1},children:"Unit is not found"}):l==null?void 0:l.map((s,i)=>e.jsx(E,{value:s.id,children:s.name},i))}),n.touched.parent_id&&n.errors.parent_id&&e.jsx(B,{error:!0,id:"standard-weight-helper-text-parent_id",children:n.errors.parent_id})]}),e.jsxs(k,{fullWidth:!0,error:n.touched.type&&!!n.errors.type,sx:{marginTop:3},children:[e.jsx(I,{htmlfor:"type",children:"Unit type"}),e.jsx(W,{id:"type",name:"type",label:"Unit type",value:n.values.type,onChange:n.handleChange,children:r.length===0?e.jsx(S,{variant:"body2",sx:{padding:1},children:"Unit type is not found"}):r==null?void 0:r.map((s,i)=>e.jsx(E,{value:s.id,children:s.name},i))}),n.touched.type&&n.errors.type&&e.jsx(B,{error:!0,id:"standard-weight-helper-text-type",children:n.errors.type})]}),e.jsxs(k,{fullWidth:!0,error:n.touched.name&&!!n.errors.name,sx:{marginTop:3},children:[e.jsx(I,{htmlfor:"name",children:"Name"}),e.jsx(M,{id:"name",name:"name",label:"name",value:n.values.name,onChange:n.handleChange,fullWidth:!0}),n.touched.name&&n.errors.name&&e.jsx(B,{error:!0,id:"standard-weight-helper-text-name",children:n.errors.name})]}),e.jsxs(k,{fullWidth:!0,error:n.touched.manager&&!!n.errors.manager,sx:{marginTop:3},children:[e.jsx(I,{htmlfor:"manager",children:"Unit manager (optional)"}),e.jsx(W,{id:"manager",name:"manager",label:"Unit manager (optional)",value:n.values.manager,onChange:n.handleChange,children:h.length===0?e.jsx(S,{variant:"body2",sx:{padding:1},children:"Manager not found"}):h==null?void 0:h.map((s,i)=>e.jsx(E,{value:s.id,children:s.name},i))})]}),e.jsxs(k,{fullWidth:!0,error:n.touched.description&&!!n.errors.description,sx:{marginTop:3},children:[e.jsx(I,{htmlfor:"description",children:"Description (optional)"}),e.jsx(M,{id:"description",name:"description",label:"Description (optional)",value:n.values.description,onChange:n.handleChange,fullWidth:!0,multiline:!0,rows:4}),n.touched.description&&n.errors.description&&e.jsx(B,{error:!0,id:"standard-weight-helper-text-description",children:n.errors.description})]})]}),e.jsxs(oe,{sx:{paddingX:2},children:[e.jsx(_,{onClick:p,sx:{marginLeft:10},children:"Cancel"}),e.jsx(_,{type:"submit",variant:"contained",sx:{paddingX:6,boxShadow:0},disabled:c,children:c?e.jsx(D,{size:18,sx:{color:"white"}}):"Done"})]})]})]})})},Te=X().shape({name:z().required("Type name is required")});function Se({isAdding:o,handleSubmission:c}){const l=P(),[r,h]=x.useState(null),p=v=>{h(v.currentTarget)},g=()=>{h(null)},n=!!r,s=n?"popover":void 0,i=G({initialValues:{name:""},validationSchema:Te,onSubmit:v=>{c(v)}});return e.jsxs("div",{children:[e.jsx(U,{"aria-describedby":s,onClick:p,sx:{backgroundColor:l.palette.grey[50]},children:e.jsx(le,{size:18})}),e.jsx(Z,{id:s,open:n,anchorEl:r,onClose:g,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:e.jsxs(b,{sx:{padding:2},children:[e.jsx(S,{variant:"subtitle1",children:"Add Unit Type"}),e.jsxs("form",{noValidate:!0,onSubmit:i.handleSubmit,children:[e.jsxs(k,{fullWidth:!0,error:i.touched.name&&!!i.errors.name,sx:{marginY:3},children:[e.jsx(I,{htmlfor:"name",children:"Type name"}),e.jsx(M,{id:"name",name:"name",label:"Type name",value:i.values.name,onChange:i.handleChange,fullWidth:!0}),i.touched.name&&i.errors.name&&e.jsx(B,{error:!0,id:"standard-weight-helper-text-name",children:i.errors.name})]}),e.jsx(_,{type:"submit",variant:"contained",fullWidth:!0,sx:{padding:1.4,boxShadow:0},disabled:o,children:o?e.jsx(D,{size:18,sx:{color:"white"}}):e.jsx(ye,{size:18})})]})]})})]})}const ke=({onView:o,onEdit:c,onDelete:l})=>e.jsxs(b,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{onClick:o,children:e.jsx(he,{size:18})}),e.jsx(U,{onClick:c,children:e.jsx(pe,{size:18})}),e.jsx(U,{onClick:l,children:e.jsx(xe,{size:18,color:"red"})})]}),Ie=({units:o})=>{const c=P(),l=ee();return e.jsx(ge,{component:ne,sx:{minHeight:"66dvh",border:.4,borderColor:c.palette.grey[300],borderRadius:2},children:e.jsxs(je,{sx:{minWidth:650},"aria-label":"Organization unit table",children:[e.jsx(ue,{children:e.jsxs($,{children:[e.jsx(T,{children:"Unit name"}),e.jsx(T,{children:"Unit type"}),e.jsx(T,{children:"Manager"}),e.jsx(T,{})]})}),e.jsx(fe,{children:o==null?void 0:o.map((r,h)=>{var p,g,n,s;return e.jsx(e.Fragment,{children:e.jsxs($,{sx:{":hover":{backgroundColor:c.palette.grey[100],color:c.palette.background.default,cursor:"pointer",borderRadius:2}},children:[e.jsx(T,{sx:{display:"flex",alignItems:"center",border:0},children:e.jsx(S,{variant:"subtitle1",children:r==null?void 0:r.name})}),e.jsx(T,{sx:{border:0},children:(p=r==null?void 0:r.unit_type)==null?void 0:p.name}),e.jsxs(T,{sx:{border:0},children:[" ",e.jsx(S,{variant:"subtitle1",children:(n=(g=r==null?void 0:r.manager)==null?void 0:g.user)==null?void 0:n.name})," ",(s=r==null?void 0:r.manager)==null?void 0:s.position]}),e.jsx(T,{sx:{border:0},children:e.jsx(ke,{onView:()=>l("/units/view",{state:r})})})]},h)})})})]})})},qe=()=>{const o=P(),[c,l]=x.useState(!0),[r,h]=x.useState([]),[p,g]=x.useState(!1),[n,s]=x.useState(!0),[i,v]=x.useState([]),[Ue,L]=x.useState([]),[V,q]=x.useState(!1),[O,C]=x.useState(!1),F=()=>{s(!0);const t=localStorage.getItem("token"),m=u.api+u.types,f={Authorization:`Bearer ${t}`,accept:"application/json","Content-Type":"application/json"};fetch(m,{method:"GET",headers:f}).then(a=>a.json()).then(a=>{a.success?(s(!1),v(a.data)):s(!1)}).catch(a=>{s(!1),y(a.message)})},H=()=>{const t=localStorage.getItem("token"),m=u.api+u.employees+"?role=manager",f={Authorization:`Bearer ${t}`,accept:"application/json","Content-Type":"application/json"};fetch(m,{method:"GET",headers:f}).then(a=>a.json()).then(a=>{a.success&&L(a.data)}).catch(a=>{y(a.message)})},N=()=>{q(!0),F(),H()},R=()=>{q(!1)},Y=t=>{C(!0);const m=localStorage.getItem("token"),f=u.api+u.units,a={Authorization:`Bearer ${m}`,accept:"application/json","Content-Type":"application/json"},j={parent_id:t==null?void 0:t.parent_id,unit_type_id:t==null?void 0:t.type,name:t==null?void 0:t.name,manager:t==null?void 0:t.manager,description:t==null?void 0:t.description};fetch(f,{method:"POST",headers:a,body:JSON.stringify(j)}).then(d=>d.json()).then(d=>{d.success?(C(!1),R(),y.success(d.message)):(C(!1),y.error(d.message))}).catch(d=>{y.error(d.message),C(!1)})},J=t=>{C(!0);const m=localStorage.getItem("token"),f=u.api+u.types,a={Authorization:`Bearer ${m}`,accept:"application/json","Content-Type":"application/json"},j={name:t==null?void 0:t.name};fetch(f,{method:"POST",headers:a,body:JSON.stringify(j)}).then(d=>d.json()).then(d=>{d.success?(C(!1),F(),y(d.message)):(C(!1),y(d.message))}).catch(d=>{y(d.message),C(!1)})};return x.useEffect(()=>{const t=()=>{const m=localStorage.getItem("token"),f=u.api+u.units,a={Authorization:`Bearer ${m}`,accept:"application/json","Content-Type":"application/json"};fetch(f,{method:"GET",headers:a}).then(j=>j.json()).then(j=>{j.success?(h(j.data.data),l(!1),g(!1)):(l(!1),g(!1))}).catch(j=>{y(j.message),g(!0),l(!1)})};return F(),t(),()=>{}},[]),e.jsxs(ce,{title:"Units",children:[e.jsxs(A,{container:!0,sx:{borderRadius:2,marginTop:2,paddingY:3,paddingX:2},children:[e.jsxs(A,{xs:12,sx:{display:"flex",alignItems:"center",justifyContent:"space-between",margin:2},children:[e.jsx(de,{}),e.jsx(_,{variant:"contained",color:"primary",onClick:()=>N(),children:"Add Unit"})]}),e.jsxs(A,{container:!0,sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(A,{xs:12,sm:12,md:8,lg:8,xl:8,sx:{minHeight:"64dvh",margin:2},children:c?e.jsx(b,{sx:{padding:2,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(D,{size:22})}):p?e.jsx(w,{severity:"error",title:"Server error",description:"There is error fetching units"}):r.length===0?e.jsx(w,{severity:"department",title:"Unit not found",description:"The list of added units will be listed here",sx:{paddingTop:6}}):e.jsx(Ie,{units:r})}),e.jsx(A,{xs:12,sm:12,md:3.6,lg:3.6,xl:3.6,sx:{paddingTop:1},children:e.jsxs(b,{sx:{border:.4,borderColor:o.palette.grey[300],borderRadius:1.6,margin:2},children:[e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:1.6},children:[e.jsx(S,{variant:"subtitle1",children:"Unit Types"}),e.jsx(Se,{isAdding:O,handleSubmission:t=>J(t)})]}),e.jsx(te,{sx:{borderBottom:.4,borderColor:o.palette.grey[400],marginY:1}}),e.jsx(b,{children:n?e.jsx(b,{sx:{padding:2,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(D,{size:20})}):p?e.jsx(w,{severity:"error",title:"Server error",description:"There is error fetching unit type"}):i.length===0?e.jsx(w,{severity:"department",title:"Unit type not found",description:"The list of added unit types will be listed here",sx:{paddingTop:6}}):i.map((t,m)=>e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingY:.8,paddingX:2,":hover":{backgroundColor:o.palette.grey[50]}},children:[e.jsx(S,{variant:"subtitle1",sx:{textTransform:"capitalize"},children:t.name}),e.jsx(U,{children:e.jsx(me,{size:18,style:{color:o.palette.grey[500]}})})]},m))})]})})]})]}),e.jsx(Ce,{add:V,isAdding:O,types:i,units:r,managers:[{id:1,name:"Mekuanint Birara"},{id:2,name:"Biruk Asmamaw"}],onClose:R,handleSubmission:t=>Y(t)}),e.jsx(re,{})]})};export{qe as default};
