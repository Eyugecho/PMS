import{i as H,z as T,r as o,j as t,m as M,B as K,A as L,d as Q,h as R,C as W,T as Z,n as d,o as x,l as aa,G as D,g as ta,Q as ea}from"./index-CsFgNO3o.js";import{C as U,F as sa,S as na,a as ia,D as oa,A as ra,P as la,U as da}from"./PlanCard-C-yKIqjp.js";import{D as ca,G as N,E as pa}from"./DrogaDataCard-BlZzXeIA.js";import{S as $}from"./storage-Cxal_ji7.js";import{D as ma,a as ga,c as ua}from"./DialogTitle-D1Q0RY_x.js";import{A as ha}from"./Alert-C9wR4zH8.js";import{P as fa}from"./MainPage-CJwvk7F6.js";import{A as xa}from"./AddButton-D48upIPe.js";import{F as ja}from"./index-D0P4nc-w.js";import{D as ya}from"./DeletePrompt-BkwRSmdx.js";import{a as Pa}from"./axios-BRiE0AY8.js";import"./MenuItem-BvD3M8VG.js";import"./TableRow-CVrgL676.js";import"./TableCell-F9dx6MLR.js";import"./Autocomplete-91ewa39-.js";import"./Close-Caj59dBO.js";import"./index-DK6LBEOt.js";import"./IconPlus-3lROdy1r.js";import"./IconPencil-LUwePxj3.js";import"./IconDotsVertical-iUbTma2w.js";import"./IconTrash-D_o8MoK5.js";import"./Box-BBcNUpSQ.js";const Sa=({add:A,onClose:u,onSucceed:k})=>{const c=H(),{selectedKpi:p}=T(),[b,y]=o.useState(!1),[n,h]=o.useState(0),[i,e]=o.useState({state:!1,message:""}),_=()=>{if(n===0)sa()?(h(n+1),e({...i,state:!1,message:""})):e({...i,state:!0,message:"Please select the fiscal year"});else if(n===1){const s=na(p);s.valid?(e({...i,state:!1,message:""}),h(n+1)):e({...i,state:!0,message:s.errors[0]})}else if(n===2){const s=ia(p);s.valid?(e({...i,state:!1,message:""}),h(n+1)):e({...i,state:!0,message:s.errors[0]})}},B=()=>{e({...i,state:!1,message:""}),h(n-1)},P=()=>{const s=oa(p);s.valid?(e({...i,state:!1,message:""}),S(p)):e({...i,state:!0,message:s.errors[0]})},S=async s=>{y(!0);const I=await N(),C=$.getItem("selectFiscal"),j=JSON.parse(C),F=x.api+x.orgPlan,E={Authorization:`Bearer ${I}`,accept:"application/json","Content-Type":"application/json"},z={fiscal_year_id:j==null?void 0:j.id,data:s};fetch(F,{method:"POST",headers:E,body:JSON.stringify(z)}).then(l=>l.json()).then(l=>{var v;l.success?(d.success(l.message),k(),u()):d.error((v=l.data)==null?void 0:v.message)}).catch(l=>{d.error(l.message)}).finally(()=>{y(!1)})};return t.jsx(o.Fragment,{children:t.jsx(ma,{open:A,onClose:u,children:t.jsxs(M,{sx:{minWidth:"600px",minHeight:"50dvh",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[t.jsxs("div",{children:[t.jsxs(K,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingRight:1},children:[t.jsx(ga,{variant:"h3",color:c.palette.text.primary,fontSize:c.typography.h3,children:U[n].name}),t.jsx(L.div,{whileHover:{rotate:90},transition:{duration:.3},style:{cursor:"pointer",marginRight:10},onClick:u,children:t.jsx(Q,{size:"1.4rem",stroke:2})})]}),t.jsx(K,{sx:{padding:3},children:U[n].component})]}),t.jsxs(ua,{sx:{paddingX:3,paddingBottom:2},children:[i.state&&t.jsxs(ha,{severity:"error",children:[" ",i.message]}),n>0&&t.jsx(R,{onClick:()=>B(),sx:{paddingX:4,paddingY:1,marginRight:2},children:"Back"}),n===U.length-1?t.jsx(R,{type:"submit",variant:"contained",sx:{paddingX:6,paddingY:1,boxShadow:0},onClick:()=>P(),children:b?t.jsx(W,{size:18,sx:{color:"white"}}):t.jsx(Z,{variant:"subtitle1",color:c.palette.background.default,children:"Submit"})}):t.jsx(ca,{type:"button",title:"Next",variant:"contained",sx:{paddingX:6,paddingY:1,boxShadow:0},onPress:()=>_()})]})]})})})},Ra=()=>{var O;const A=aa(),{handleUpdatePlan:u}=T(),[k,c]=o.useState(!0),[p,b]=o.useState([]),[y,n]=o.useState(!1),[h,i]=o.useState(!1),[e,_]=o.useState(),[B,P]=o.useState(!1),[S,s]=o.useState(!1),[I,C]=o.useState(!1),j=()=>{i(!0)},F=()=>{i(!1)},E=a=>{var r,X,Y,q,G,V;const m={id:a==null?void 0:a.kpi_id,f_name:(r=a==null?void 0:a.frequency)==null?void 0:r.name,f_value:(X=a==null?void 0:a.frequency)==null?void 0:X.value,frequency_id:a==null?void 0:a.frequency_id,mu:(q=(Y=a==null?void 0:a.kpi)==null?void 0:Y.measuring_unit)==null?void 0:q.name,name:(G=a==null?void 0:a.kpi)==null?void 0:G.name,total_target:a==null?void 0:a.total_target,weight:a==null?void 0:a.weight},g=(V=a==null?void 0:a.target)==null?void 0:V.map(f=>({period_id:f==null?void 0:f.period_id,target:f==null?void 0:f.target}));u([{...m,targets:g}]),$.setItem("selectFiscal",JSON.stringify({id:a==null?void 0:a.fiscal_year_id,year:""})),P(!0)},z=a=>{E(a)},l=()=>{u([]),P(!1)},v=a=>{_(a),s(!0)},J=async()=>{C(!0);try{const a=await N(),m=x.api+x.deletePlan+`/${e==null?void 0:e.id}`,g=await Pa.delete(m,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});g.data.success?(s(!1),d.success(g.data.data.message),w()):d.error(g.data.data.message)}catch(a){d.error(a.message)}finally{C(!1)}},w=async()=>{const a=await N(),m=x.api+x.getOrgPlans,g={Authorization:`Bearer ${a}`,accept:"application/json","Content-Type":"application/json"};fetch(m,{method:"GET",headers:g}).then(r=>r.json()).then(r=>{r.success?(b(r.data),c(!1),n(!1)):(c(!1),d.warning(r.data.message),n(!1))}).catch(r=>{d.warning(r.message),n(!0),c(!1)})};return o.useEffect(()=>(w(),()=>{}),[]),t.jsxs(fa,{title:"Planning",rightOption:t.jsx(xa,{props:{varaint:"contained"},title:"Create new plan",onPress:()=>j()}),children:[k?t.jsx(D,{container:!0,children:t.jsx(D,{item:!0,xs:12,sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",padding:8},children:t.jsx(ra,{size:20})})}):y?t.jsx(pa,{title:"Server Error",message:"Unable to retrive fiscal years"}):p.length===0?t.jsx(ja,{severity:"planning",title:"Plan is not found",description:"The list of added plan will be listed here",sx:{paddingTop:6}}):t.jsx(D,{container:!0,sx:{paddingY:1,paddingX:2,marginTop:4},spacing:ta,children:p.map((a,m)=>t.jsx(D,{item:!0,xs:12,sm:12,md:6,lg:4,xl:3,children:t.jsx(la,{plan:a,onPress:()=>A("/planning/view",{state:a}),onEdit:()=>z(a),onDelete:()=>v(a)})},m))}),t.jsx(Sa,{add:h,onClose:F,onSucceed:()=>w()}),t.jsx(da,{add:B,onClose:l,onSucceed:()=>w()}),S&&t.jsx(ya,{type:"Delete",open:S,title:"Deleting Plan",description:"Are you sure you want to delete "+((O=e==null?void 0:e.kpi)==null?void 0:O.name),onNo:()=>s(!1),onYes:()=>J(),deleting:I,handleClose:()=>s(!1)}),t.jsx(ea,{})]})};export{Ra as default};
