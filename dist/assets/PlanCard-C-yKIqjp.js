import{c as H,P as N,j as e,C as O,i as D,r as p,R as oe,G as C,B as v,T as j,Q as q,n as z,o as E,t as le,v as ce,s as de,ag as he,ah as ue,h as W,z as A,a2 as xe,a3 as Q,w as V,m as U,I as ge,ai as me,A as fe,d as je}from"./index-CsFgNO3o.js";import{E as G,n as J,G as R,D as pe,a as ye}from"./DrogaDataCard-BlZzXeIA.js";import{S as _}from"./storage-Cxal_ji7.js";import{M as be}from"./MenuItem-BvD3M8VG.js";import{T as Z,a as k,b as Y,c as ee}from"./TableRow-CVrgL676.js";import{T}from"./TableCell-F9dx6MLR.js";import{A as ve}from"./Autocomplete-91ewa39-.js";import{M as B,P as te}from"./index-DK6LBEOt.js";import{D as Ie,a as Se,c as Ce}from"./DialogTitle-D1Q0RY_x.js";import{A as Pe}from"./Alert-C9wR4zH8.js";import{a as Te}from"./DeletePrompt-BkwRSmdx.js";var we=H("chevron-right","IconChevronRight",[["path",{d:"M9 6l6 6l-6 6",key:"svg-0"}]]),Fe=H("circle-check-filled","IconCircleCheckFilled",[["path",{d:"M17 3.34a10 10 0 1 1 -14.995 8.984l-.005 -.324l.005 -.324a10 10 0 0 1 14.995 -8.336zm-1.293 5.953a1 1 0 0 0 -1.32 -.083l-.094 .083l-3.293 3.292l-1.293 -1.292l-.094 -.083a1 1 0 0 0 -1.403 1.403l.083 .094l2 2l.094 .083a1 1 0 0 0 1.226 0l.094 -.083l4 -4l.083 -.094a1 1 0 0 0 -.083 -1.32z",fill:"currentColor",key:"svg-0",strokeWidth:"0"}]]);const $=({size:t,sx:a})=>e.jsx(O,{size:t,sx:{...a}});$.propTypes={size:N.number,sx:N.object};const se=()=>{const t=D(),[a,o]=p.useState(!1),[r,s]=p.useState([]),[h,y]=p.useState(!1),[x,m]=p.useState(null),c=g=>{x===g.id?(m(null),_.removeItem("selectFiscal")):(m(g.id),_.setItem("selectFiscal",JSON.stringify({id:g.id,year:g.year})))},f=async()=>{const g=await R(),u=E.api+E.fiscalYear,i={Authorization:`Bearer ${g}`,accept:"application/json","Content-Type":"application/json"};fetch(u,{method:"GET",headers:i}).then(l=>l.json()).then(l=>{l.success?(s(l.data),y(!1),_.setItem("fiscalYear",JSON.stringify(l.data))):y(!1)}).catch(l=>{z(l.message),y(!0)}).finally(()=>{o(!1)})};return p.useEffect(()=>{const g=_.getItem("fiscalYear"),u=_.getItem("selectFiscal");let i=null,l=null;try{g&&(i=JSON.parse(g),s(i)),u&&(l=JSON.parse(u),l!=null&&l.id&&m(l.id))}catch{f()}i||f()},[]),e.jsxs(oe.Fragment,{children:[a?e.jsx(C,{container:!0,children:e.jsx(C,{item:!0,xs:12,sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",padding:8},children:e.jsx($,{size:20})})}):h?e.jsx(G,{image:J,title:"Server Error",message:"Unable to retrive fiscal years"}):r==null?void 0:r.map((g,u)=>e.jsxs(v,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingY:2.2,paddingX:2,border:.6,borderRadius:2,borderColor:t.palette.primary.main,backgroundColor:t.palette.grey[50],cursor:"pointer",marginY:1.6},onClick:()=>c(g),children:[e.jsx(j,{variant:"h4",children:g.year}),x===g.id&&e.jsx(Fe,{size:24,style:{color:t.palette.primary.main}})]},u)),e.jsx(q,{})]})};var L={},Ee=ce;Object.defineProperty(L,"__esModule",{value:!0});var ae=L.default=void 0,_e=Ee(le()),ze=e;ae=L.default=(0,_e.default)((0,ze.jsx)("path",{d:"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"}),"KeyboardArrowDown");const De=de(t=>e.jsx(he,{elevation:0,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},...t}))(({theme:t})=>({"& .MuiPaper-root":{borderRadius:6,marginTop:t.spacing(1),minWidth:180,color:t.palette.mode==="light"?"rgb(55, 65, 81)":t.palette.grey[300],boxShadow:"rgb(255, 255, 255) 0px 0px 0px 0px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgba(0, 0, 0, 0.1) 0px 10px 15px -3px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px","& .MuiMenu-list":{padding:"4px 0"},"& .MuiMenuItem-root":{"& .MuiSvgIcon-root":{fontSize:18,color:t.palette.text.secondary,marginRight:t.spacing(1.5)},"&:active":{backgroundColor:ue(t.palette.primary.main,t.palette.action.selectedOpacity)}}}}));function Ke({menu:t,selected:a,onSelect:o}){const[r,s]=p.useState(null),h=!!r,y=c=>{s(c.currentTarget)},x=()=>{s(null)},m=c=>{o(c),x()};return e.jsxs("div",{children:[e.jsx(W,{id:"demo-customized-button","aria-controls":h?"demo-customized-menu":void 0,"aria-haspopup":"true","aria-expanded":h?"true":void 0,variant:"contained",disableElevation:!0,onClick:y,endIcon:e.jsx(ae,{}),children:a||"Select frequency"}),e.jsx(De,{id:"demo-customized-menu",MenuListProps:{"aria-labelledby":"demo-customized-button"},anchorEl:r,open:h,onClose:x,children:t==null?void 0:t.map((c,f)=>e.jsx(be,{disableRipple:!0,onClick:()=>m(c),children:c.name},c.id))})]})}const re=()=>{const t=D(),{selectedKpi:a,updateKPI:o}=A(),[r,s]=p.useState(!0),[h,y]=p.useState([]),[x,m]=p.useState(!1),c=localStorage.getItem("selectFiscal"),f=JSON.parse(c),g=(u,i)=>{o(i,{frequency_id:u.id,f_name:u.name,f_value:u.value})};return p.useEffect(()=>((async()=>{const i=await R(),l=E.api+E.planningFrequiencies,d={Authorization:`Bearer ${i}`,accept:"application/json","Content-Type":"application/json"};fetch(l,{method:"GET",headers:d}).then(b=>b.json()).then(b=>{b.success?(y(b.data),s(!1),m(!1)):(s(!1),m(!1))}).catch(b=>{z.error(b.message),m(!0),s(!1)})})(),()=>{}),[f.id]),e.jsxs(v,{children:[r?e.jsx(C,{container:!0,children:e.jsx(C,{item:!0,xs:12,sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",padding:8},children:e.jsx($,{size:20})})}):x?e.jsx(G,{image:J,title:"Server Error",message:"Unable to retrive frequency"}):e.jsxs(Z,{sx:{borderRadius:t.shape.borderRadius},children:[e.jsx(k,{children:e.jsxs(Y,{children:[e.jsx(T,{sx:{minWidth:170},children:"KPI Name"}),e.jsx(T,{sx:{minWidth:60},children:"Frequency"})]})}),e.jsx(ee,{children:a==null?void 0:a.map((u,i)=>e.jsxs(Y,{children:[e.jsx(T,{children:u.name}),e.jsxs(T,{children:[" ",e.jsx(Ke,{menu:h,selected:u==null?void 0:u.f_name,onSelect:l=>g(l,u.id)})]})]},i))})]}),e.jsx(q,{})]})},ne=()=>{const t=D(),{selectedKpi:a,addOrRemoveKPI:o,updateKPI:r}=A(),[s,h]=p.useState(!0),[y,x]=p.useState([]),[m,c]=p.useState(!1),f=(i,l)=>{const d=l,b=a,n=d.filter(S=>!b.some(w=>w.id===S.id)),I=b.filter(S=>!d.some(w=>w.id===S.id));n.forEach(S=>o(S)),I.forEach(S=>o(S))},g=(i,l)=>{const d=i.target.value;r(l,{weight:d})},u=(i,l)=>{const d=i.target.value;r(l,{total_target:d})};return p.useEffect(()=>((()=>{const l=localStorage.getItem("token"),d=E.api+E.kpi,b={Authorization:`Bearer ${l}`,accept:"application/json","Content-Type":"application/json"};fetch(d,{method:"GET",headers:b}).then(n=>n.json()).then(n=>{n.success?(x(n.data.data),h(!1),c(!1)):(h(!1),c(!1))}).catch(n=>{z.error(n.message),c(!0),h(!1)})})(),()=>{}),[]),e.jsxs(v,{children:[s?e.jsx(C,{container:!0,children:e.jsx(C,{item:!0,xs:12,sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",padding:8},children:e.jsx($,{size:20})})}):m?e.jsx(G,{image:J,title:"Server Error",message:"Unable to retrive kpi"}):e.jsxs(e.Fragment,{children:[e.jsx(v,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:e.jsx(ve,{id:"kpi-list",multiple:!0,options:y,getOptionLabel:i=>i.name,value:a,onChange:f,isOptionEqualToValue:(i,l)=>i.id===l.id,renderTags:(i,l)=>i.map((d,b)=>e.jsx(xe,{label:d.name,...l({index:b})})),fullWidth:!0,renderInput:i=>e.jsx(Q,{...i,label:"Select a KPI",variant:"outlined"}),disableClearable:!0})}),e.jsx(v,{sx:{padding:2},children:e.jsxs(Z,{children:[e.jsx(k,{children:e.jsxs(Y,{children:[e.jsx(T,{sx:{minWidth:130},children:"KPI Name"}),e.jsx(T,{sx:{minWidth:60},children:"Weight(%)"}),e.jsx(T,{sx:{minWidth:100},children:"Measured by"}),e.jsx(T,{sx:{minWidth:120},children:"Target"})]})}),e.jsx(ee,{children:a==null?void 0:a.map((i,l)=>e.jsxs(Y,{children:[e.jsx(T,{children:i.name}),e.jsx(T,{children:e.jsx(V,{sx:{p:.5,border:1,borderRadius:2,borderColor:t.palette.primary.main},value:i.weight,onChange:d=>g(d,i.id),inputProps:{"aria-label":"weight"},type:"number"})}),e.jsx(T,{sx:{textTransform:"capitalize"},children:i.mu}),e.jsx(T,{children:e.jsx(V,{sx:{p:.5,border:1,borderRadius:2,borderColor:t.palette.primary.main},value:i.total_target,onChange:d=>u(d,i.id),inputProps:{"aria-label":"target"},type:"number"})})]},l))})]})})]}),e.jsx(q,{})]})},ie=()=>{const t=D(),{selectedKpi:a,distributeTarget:o}=A(),[r,s]=p.useState(!0),[h,y]=p.useState([]),[x,m]=p.useState(!1),[c,f]=p.useState(),g=localStorage.getItem("selectFiscal"),u=JSON.parse(g),i=(n,I,S)=>{const w=n.target.value;o(w,I,S)},l=(n,I)=>{c===n?f(null):(f(n),b(I))},d=(n,I)=>I>1?n+1:"",b=async n=>{s(!0),y([]);const I=await R(),S=E.api+E.planningPeriods+`?fiscal_year=${u==null?void 0:u.id}&frequency_id=${n}&type=planning`,w={Authorization:`Bearer ${I}`,accept:"application/json","Content-Type":"application/json"};fetch(S,{method:"GET",headers:w}).then(F=>F.json()).then(F=>{F.success?(y(F.data.periods),s(!1),m(!1)):(s(!1),m(!1))}).catch(F=>{z.error(F.message),m(!0),s(!1)})};return e.jsxs(v,{children:[a==null?void 0:a.map((n,I)=>e.jsxs(v,{sx:{marginY:2},children:[e.jsxs(U,{sx:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",padding:1.6,border:.6,borderColor:t.palette.divider,backgroundColor:t.palette.primary.light,cursor:"pointer",marginY:.4},onClick:()=>l(I,n.frequency_id),children:[e.jsx(j,{variant:"h4",children:n==null?void 0:n.name}),e.jsxs(v,{children:[e.jsx(j,{variant:"caption",children:" Total target"}),e.jsxs(j,{variant:"subtitle1",children:[" ",n==null?void 0:n.total_target,B(n==null?void 0:n.mu)]})]}),e.jsxs(ge,{children:[" ",c===I?e.jsx(me,{size:18}):e.jsx(we,{size:18})," "]})]}),c===I&&e.jsxs(v,{sx:{padding:1.6,marginY:.4},children:[e.jsxs(v,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(j,{variant:"subtitle1",children:"Evaluation frequency"}),e.jsx(j,{variant:"subtitle1",sx:{backgroundColor:t.palette.primary.light,color:t.palette.primary.main,paddingY:.4,paddingX:2,borderRadius:20,marginLeft:1},children:n.f_name})]}),e.jsx(v,{sx:{marginTop:2,minHeight:"10dvh"},children:r?e.jsx(v,{sx:{display:"flex",alignItems:"center",justifyContent:"center",padding:2},children:e.jsx(O,{size:20})}):x?e.jsx(j,{variant:"subtitle1",children:"Error fetching periods"}):h.length===0?e.jsx(j,{variant:"subtitle1",children:"Please set period first"}):e.jsx(C,{container:!0,spacing:2,children:h==null?void 0:h.map((S,w)=>{var P;const F=(P=n.targets)==null?void 0:P.find(K=>K.period_id===S.id);return e.jsx(C,{item:!0,xs:12,sm:6,md:4,children:e.jsx(Q,{type:"number",label:`${te(n==null?void 0:n.f_name)} ${d(w,n.f_value)}`,variant:"outlined",fullWidth:!0,margin:"normal",value:F?F.target:"",onChange:K=>i(K,n==null?void 0:n.id,S.id)})},S.id)})})})]})]},I)),e.jsx(q,{})]})},Qe=[{id:1,name:"Select Fiscal Year",component:e.jsx(se,{})},{id:2,name:"Select KPI",component:e.jsx(ne,{})},{id:3,name:"Select Frequency",component:e.jsx(re,{})},{id:4,name:"Target Distribution",component:e.jsx(ie,{})}],M=[{id:1,name:"Selected Fiscal Year",component:e.jsx(se,{})},{id:2,name:"Selected KPI",component:e.jsx(ne,{})},{id:3,name:"Selected Frequency",component:e.jsx(re,{})},{id:4,name:"Target Distribution",component:e.jsx(ie,{})}],Ye=()=>!!_.getItem("selectFiscal"),qe=t=>{const a=[];let o=!0,r=0;return t.length===0&&(o=!1,a.push("Please select KPI before proceeding")),t.forEach(s=>{s.weight===""?(o=!1,a.push(`The ${s.name} KPI Weight is required.`)):isNaN(s.weight)?(o=!1,a.push(`The ${s.name} KPI weight must be a number.`)):s.weight<0?(o=!1,a.push(`The ${s.name} KPI weight cannot be negative.`)):s.weight>100?(o=!1,a.push(`The ${s.name} KPI Weight exceeded 100%`)):r+=parseFloat(s.weight),s.total_target===""?(o=!1,a.push(`The ${s.name} KPI target is not set.`)):isNaN(s.total_target)?(o=!1,a.push(`The ${s.name} KPI target should be a number.`)):s.total_target<0&&(o=!1,a.push(`The ${s.name} KPI target cannot be negative.`))}),r>100&&(o=!1,a.push("The sum of KPI weights exceeded 100%.")),{valid:o,errors:a}},Ae=t=>{const a=[];let o=!0;return t.forEach(r=>{r.frequency_id||(o=!1,a.push(`Please select the ${r.name} KPI evaluation frequency`))}),{valid:o,errors:a}},Re=t=>{const a=[];let o=!0;return t.forEach(r=>{if(!r.targets)o=!1,a.push(`The ${r.name} KPI is not distributed`);else{let s=0;r==null||r.targets.forEach(h=>{!h.target||h.target===""?(o=!1,a.push(`Please check ${r.name} KPI input fields, there is a period with missing value`)):isNaN(h.target)&&(o=!1,a.push(`The ${r.name} KPI distributed target should be a number.`)),s+=parseFloat(h==null?void 0:h.target)}),s<(r==null?void 0:r.total_target)&&(o=!1,a.push(`The ${r.name} KPI total target is not fully distributed | distributed: ${s} `))}}),{valid:o,errors:a}},Ze=({add:t,onClose:a,onSucceed:o})=>{const r=D(),{selectedKpi:s}=A(),[h,y]=p.useState(!1),[x,m]=p.useState(0),[c,f]=p.useState({state:!1,message:""}),g=()=>{if(x===0)Ye()?(m(x+1),f({...c,state:!1,message:""})):f({...c,state:!0,message:"Please select the fiscal year"});else if(x===1){const d=qe(s);d.valid?(f({...c,state:!1,message:""}),m(x+1)):f({...c,state:!0,message:d.errors[0]})}else if(x===2){const d=Ae(s);d.valid?(f({...c,state:!1,message:""}),m(x+1)):f({...c,state:!0,message:d.errors[0]})}},u=()=>{f({...c,state:!1,message:""}),m(x-1)},i=()=>{const d=Re(s);d.valid?(f({...c,state:!1,message:""}),l(s)):f({...c,state:!0,message:d.errors[0]})},l=async d=>{y(!0);const b=await R(),n=_.getItem("selectFiscal"),I=JSON.parse(n),S=E.api+E.orgPlan,w={Authorization:`Bearer ${b}`,accept:"application/json","Content-Type":"application/json"},F={fiscal_year_id:I==null?void 0:I.id,data:d};fetch(S,{method:"POST",headers:w,body:JSON.stringify(F)}).then(P=>P.json()).then(P=>{var K,X;P.success?(z.success((K=P==null?void 0:P.data)==null?void 0:K.message),o(),a()):z.error((X=P==null?void 0:P.data)==null?void 0:X.message)}).catch(P=>{z.error(P.message)}).finally(()=>{y(!1)})};return e.jsx(p.Fragment,{children:e.jsx(Ie,{open:t,onClose:a,children:s&&e.jsxs(U,{sx:{minWidth:"600px",minHeight:"50dvh",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsxs(v,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingRight:1},children:[e.jsx(Se,{variant:"h3",color:r.palette.text.primary,fontSize:r.typography.h3,children:M[x].name}),e.jsx(fe.div,{whileHover:{rotate:90},transition:{duration:.3},style:{cursor:"pointer",marginRight:10},onClick:a,children:e.jsx(je,{size:"1.4rem",stroke:2})})]}),e.jsx(v,{sx:{padding:3},children:M[x].component})]}),e.jsxs(Ce,{sx:{paddingX:3,paddingBottom:2},children:[c.state&&e.jsxs(Pe,{severity:"error",children:[" ",c.message]}),x>0&&e.jsx(W,{onClick:()=>u(),sx:{paddingX:4,paddingY:1,marginRight:2},children:"Back"}),x===M.length-1?e.jsx(W,{type:"submit",variant:"contained",sx:{paddingX:6,paddingY:1,boxShadow:0},onClick:()=>i(),children:h?e.jsx(O,{size:18,sx:{color:"white"}}):e.jsx(j,{variant:"subtitle1",color:r.palette.background.default,children:"Submit"})}):e.jsx(pe,{type:"button",title:"Next",variant:"contained",sx:{paddingX:6,paddingY:1,boxShadow:0},onPress:()=>g()})]})]})})})},$e=({value:t})=>{const a=D(),o=13,r=42,s=r-o/2,h=s*2*Math.PI,y=h-t/100*h;return e.jsxs("svg",{height:r*2,width:r*2,children:[e.jsx("circle",{stroke:a.palette.grey[100],fill:"transparent",strokeWidth:o,r:s,cx:r,cy:r}),e.jsx("circle",{stroke:a.palette.primary.main,fill:"transparent",strokeWidth:o,strokeDasharray:`${h} ${h}`,strokeDashoffset:y,r:s,cx:r,cy:r,style:{transition:"stroke-dashoffset 0.5s ease"}}),e.jsx("text",{x:"50%",y:"50%",dy:".3em",textAnchor:"middle",fontSize:"20px",fill:a.palette.grey[800],children:`${t}%`})]})},Me=({plan:t,onPress:a,onEdit:o,onDelete:r})=>{var h,y,x,m,c,f,g,u;const s=D();return e.jsxs(ye,{onPress:a,children:[e.jsxs(v,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(j,{variant:"body1",children:"KPI Name"}),!(t!=null&&t.is_distributed)&&e.jsx(Te,{orientation:"horizontal",onEdit:o,onDelete:r})]}),e.jsx(j,{variant:"h3",children:(h=t==null?void 0:t.kpi)==null?void 0:h.name}),e.jsxs(C,{container:!0,sx:{paddingTop:2},children:[e.jsxs(C,{item:!0,xs:6,sx:{paddingY:2.4},children:[e.jsxs(v,{children:[e.jsx(j,{variant:"body1",children:"Perspective Type"}),e.jsx(j,{variant:"h4",children:(x=(y=t==null?void 0:t.kpi)==null?void 0:y.perspective_type)==null?void 0:x.name})]}),e.jsxs(v,{sx:{paddingTop:2},children:[e.jsx(j,{variant:"body1",children:"Measuring Unit"}),e.jsx(j,{variant:"h4",children:(c=(m=t==null?void 0:t.kpi)==null?void 0:m.measuring_unit)==null?void 0:c.name})]})]}),e.jsxs(C,{item:!0,xs:6,sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:2},children:[e.jsx($e,{value:t==null?void 0:t.weight}),e.jsx(j,{variant:"subtitle1",sx:{marginTop:2},children:"Weight"})]})]}),e.jsxs(C,{container:!0,marginTop:1,children:[e.jsx(C,{item:!0,xs:6,children:e.jsxs(v,{children:[e.jsx(j,{variant:"body1",children:"Frequency"}),e.jsx(j,{variant:"h4",children:(f=t==null?void 0:t.frequency)==null?void 0:f.name})]})}),e.jsx(C,{item:!0,xs:6,children:e.jsxs(U,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:1.6,backgroundColor:s.palette.grey[50]},children:[e.jsx(j,{variant:"subtitle1",children:"Target"}),e.jsxs(j,{variant:"h4",children:[t==null?void 0:t.total_target,B((u=(g=t==null?void 0:t.kpi)==null?void 0:g.measuring_unit)==null?void 0:u.name)]})]})})]}),e.jsx(C,{container:!0,sx:{display:"flex",flexWrap:"wrap",marginTop:3,borderTop:.8,borderColor:s.palette.divider,padding:.8,paddingTop:2},children:t==null?void 0:t.target.map((i,l)=>{var d,b,n;return e.jsxs(C,{item:!0,xs:6,sx:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:1,marginTop:2},children:[e.jsxs(j,{variant:"body2",children:[te((d=t==null?void 0:t.frequency)==null?void 0:d.name)," ",l+1]}),e.jsx(v,{sx:{paddingY:.8,paddingX:1.2,backgroundColor:s.palette.grey[50],borderRadius:s.shape.borderRadius},children:e.jsxs(j,{variant:"h4",children:[i==null?void 0:i.target,B((n=(b=t==null?void 0:t.kpi)==null?void 0:b.measuring_unit)==null?void 0:n.name)]})})]},l)})})]})};Me.propTypes={plans:N.object};export{$ as A,Qe as C,Re as D,Ye as F,Me as P,qe as S,Ze as U,Ae as a};
