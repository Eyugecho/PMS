import{l as fe,u as ee,ar as ae,r as t,j as a,_ as ye,t as je,m as I,$ as Pe,as as Se,a0 as ve,a4 as _e,Y as W,Z as Ce,b as we,at as be,f as V,B as u,h as y,a5 as ke,n as De,au as Ae,G as m,ag as Fe,d as Ie,av as Ee,F as Ue,g as Be,ah as Te,aw as $e,aj as ze,ax as Re,ay as Me}from"./index-DL-CLDEe.js";import{C as K,S as Ne,F as Xe,D as Ye,I as qe,U as Oe}from"./is-employee-B1SWexxr.js";import{A as te}from"./Alert-B6r8ITbi.js";import{P as Ge}from"./PlanCard-CFMUCEtq.js";import{S as Z}from"./SelectorMenu-i2G5QBs3.js";import"./no_result-CfkzRtwQ.js";import"./Autocomplete-D8TvuXv2.js";import"./Close-B1KvSMQT.js";import"./DrogaDonutChart-gWJPFz3l.js";const Ke=({add:h,onClose:j,onSucceed:E})=>{const P=fe(),S=ee(n=>n.customization.selectedFiscalYear),{selectedKpi:x}=ae(),[v,_]=t.useState(!1),[r,C]=t.useState(0),[c,d]=t.useState({state:!1,message:""}),M=()=>{if(r===0){const n=Ne(x);n.valid?(d({...c,state:!1,message:""}),C(r+1)):d({...c,state:!0,message:n.errors[0]})}else if(r===1){const n=Xe(x);n.valid?(d({...c,state:!1,message:""}),C(r+1)):d({...c,state:!0,message:n.errors[0]})}},U=()=>{d({...c,state:!1,message:""}),C(r-1)},B=()=>{const n=Ye(x);n.valid?(d({...c,state:!1,message:""}),N(x)):d({...c,state:!0,message:n.errors[0]})},N=async n=>{_(!0);const X=await V(),Y=y.api+y.orgPlan,T={Authorization:`Bearer ${X}`,accept:"application/json","Content-Type":"application/json"},$={fiscal_year_id:S==null?void 0:S.id,data:n};fetch(Y,{method:"POST",headers:T,body:JSON.stringify($)}).then(l=>l.json()).then(l=>{var z;l.success?(u.success(l.message),E(),j()):u.error((z=l.data)==null?void 0:z.message)}).catch(l=>{u.error(l.message)}).finally(()=>{_(!1)})};return a.jsx(t.Fragment,{children:a.jsx(ye,{open:h,onClose:j,children:a.jsxs(je,{sx:{minWidth:"600px",minHeight:"50dvh",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[a.jsxs("div",{children:[a.jsxs(I,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingRight:1},children:[a.jsx(Pe,{variant:"h3",color:P.palette.text.primary,children:K[r].name}),a.jsx(Se.div,{whileHover:{rotate:90},transition:{duration:.3},style:{cursor:"pointer",marginRight:10},onClick:j,children:a.jsx(ve,{size:"1.4rem",stroke:2})})]}),a.jsx(I,{sx:{padding:3},children:K[r].component})]}),a.jsxs(_e,{sx:{paddingX:3,paddingBottom:2},children:[c.state&&a.jsxs(te,{severity:"error",children:[" ",c.message]}),r>0&&a.jsx(W,{onClick:()=>U(),sx:{paddingX:4,paddingY:1,marginRight:2},children:"Back"}),r===K.length-1?a.jsx(W,{type:"submit",variant:"contained",sx:{py:1,paddingX:6,boxShadow:0,borderRadius:2},onClick:()=>B(),children:v?a.jsx(Ce,{size:18,sx:{color:"white"}}):a.jsx(we,{variant:"subtitle1",color:P.palette.background.paper,children:"Submit"})}):a.jsx(be,{type:"button",title:"Next",variant:"contained",sx:{paddingX:6,paddingY:1,boxShadow:0},onPress:()=>M()})]})]})})})},ta=()=>{var L;const h=ee(e=>e.customization.selectedFiscalYear),j=ke(),E=qe(),{handleUpdatePlan:P}=ae(),[S,x]=t.useState(!1),[v,_]=t.useState(!0),[r,C]=t.useState([]),[c,d]=t.useState(!1),[M,U]=t.useState(!1),[B,N]=t.useState(!0),[n,X]=t.useState(),[Y,T]=t.useState(!1),[$,l]=t.useState(!1),[z,H]=t.useState(!1),[q,ne]=t.useState(""),[O]=t.useState([{label:"Perspectives Type",value:""}]),[G]=t.useState([{label:"Measuring Unit",value:""}]),[f,se]=t.useState({m_unit:"",perspective:""}),[o,R]=t.useState({page:0,per_page:10,total:0}),ie=e=>{const s=e.target.value;ne(s),R({...o,page:0})},J=e=>{const{value:s,name:p}=e.target;se({...f,[p]:s})},oe=(e,s)=>{R({...o,page:s})},re=e=>{R({...o,per_page:e.target.value,page:0})},le=()=>{U(!0)},ce=()=>{U(!1)},de=e=>{var i,b,k,D,A,F;const s={id:e==null?void 0:e.kpi_id,f_name:(i=e==null?void 0:e.frequency)==null?void 0:i.name,f_value:(b=e==null?void 0:e.frequency)==null?void 0:b.value,frequency_id:e==null?void 0:e.frequency_id,mu:(D=(k=e==null?void 0:e.kpi)==null?void 0:k.measuring_unit)==null?void 0:D.name,name:(A=e==null?void 0:e.kpi)==null?void 0:A.name,total_target:e==null?void 0:e.total_target,weight:e==null?void 0:e.weight},p=(F=e==null?void 0:e.target)==null?void 0:F.map(g=>({period_id:g==null?void 0:g.period_id,target:g==null?void 0:g.target}));P([{...s,targets:p}]),Me.setItem("selectFiscal",JSON.stringify({id:e==null?void 0:e.fiscal_year_id,year:""})),T(!0)},pe=e=>{de(e)},ge=()=>{P([]),T(!1)},ue=e=>{X(e),l(!0)},he=async()=>{H(!0);try{const e=await V(),s=y.api+y.deletePlan+`/${n==null?void 0:n.id}`,p=await Re.delete(s,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});p.data.success?(l(!1),u.success(p.data.data.message),w()):u.error(p.data.data.message)}catch(e){u.error(e.message)}finally{H(!1)}},me=e=>{O.length<2&&e.forEach(s=>O.push({label:s.name,value:s.id}))},xe=e=>{G.length<2&&e.forEach(s=>G.push({label:s.name,value:s.id}))},w=async()=>{if(h){_(!0);const e=await V(),s=y.api+y.getMyPlans+`?fiscal_year_id=${h==null?void 0:h.id}&page=${o.page}&per_page=${o.per_page}&search=${q}&perspective_type_id=${f.perspective}&measuring_unit_id=${f.m_unit}`,p={Authorization:`Bearer ${e}`,accept:"application/json","Content-Type":"application/json"};fetch(s,{method:"GET",headers:p}).then(i=>i.json()).then(i=>{var b,k,D,A,F,g,Q;i.success?(C((k=(b=i.data)==null?void 0:b.plans)==null?void 0:k.data),N((D=i.data)==null?void 0:D.weightSum),me((A=i.data)==null?void 0:A.perspectiveTypes),xe((F=i.data)==null?void 0:F.measuringUnits),R({...o,total:(Q=(g=i.data)==null?void 0:g.plans)==null?void 0:Q.total}),d(!1)):(u.warning(i.data.message),d(!1))}).catch(i=>{u.warning(i.message),d(!0)}).finally(()=>{_(!1)})}};return t.useEffect(()=>{S?w():x(!0)},[h,o.page,o.per_page,f]),t.useEffect(()=>{const e=setTimeout(()=>{w()},600);return()=>{clearTimeout(e)}},[q]),a.jsxs(De,{title:"Planning",rightOption:!E&&a.jsxs(a.Fragment,{children:[a.jsx(Ae,{props:{varaint:"contained"},title:"Create new plan",onPress:()=>le(),disable:B}),!v&&B&&a.jsx(I,{sx:{marginY:1},children:a.jsx(te,{icon:!1,severity:"info",children:"Already Planned 100%"})})]}),children:[a.jsxs(m,{container:!0,sx:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:3.8,px:2},children:[a.jsx(m,{item:!0,xs:12,sm:12,md:4,lg:2.6,xl:2,children:a.jsx(Fe,{value:q,onChange:e=>ie(e)})}),a.jsx(m,{item:!0,xs:12,sm:12,md:6,children:a.jsxs(I,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:[a.jsx(Z,{name:"perspective",options:O,selected:f.perspective,handleSelection:J}),a.jsx(I,{sx:{marginLeft:2},children:a.jsx(Z,{name:"m_unit",options:G,selected:f.m_unit,handleSelection:J})})]})})]}),v?a.jsx(m,{container:!0,children:a.jsx(m,{item:!0,xs:12,sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",padding:8},children:a.jsx(Ie,{size:20})})}):c?a.jsx(Ee,{title:"Server Error",message:"Unable to retrive Plans"}):r.length===0?a.jsx(Ue,{severity:"planning",title:"Plan is not found",description:"The list of added plan will be listed here",sx:{paddingTop:6}}):a.jsx(m,{container:!0,sx:{paddingY:1,paddingX:2,marginTop:.2},spacing:Be,children:r.map((e,s)=>a.jsx(m,{item:!0,xs:12,sm:12,md:6,lg:4,xl:3,children:a.jsx(Ge,{plan:e,onPress:()=>j("/planning/view",{state:e}),onEdit:()=>pe(e),onDelete:()=>ue(e),editInitiative:!0,is_employee:E})},s))}),!v&&o.total>o.per_page&&a.jsx(Te,{component:"div",rowsPerPageOptions:[10,25,50,100],count:o.total,rowsPerPage:o.per_page,page:o.page,onPageChange:oe,onRowsPerPageChange:re,labelRowsPerPage:"Plans per page"}),a.jsx(Ke,{add:M,onClose:ce,onSucceed:()=>w()}),a.jsx(Oe,{add:Y,onClose:ge,onSucceed:()=>w()}),$&&a.jsx($e,{type:"Delete",open:$,title:"Deleting Plan",description:"Are you sure you want to delete "+((L=n==null?void 0:n.kpi)==null?void 0:L.name),onNo:()=>l(!1),onYes:()=>he(),deleting:z,handleClose:()=>l(!1)}),a.jsx(ze,{})]})};export{ta as default};
