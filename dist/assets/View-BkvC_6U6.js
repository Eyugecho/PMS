import{r as d,aa as _e,ab as Ie,ac as ke,j as e,ad as Re,ae as De,af as $e,P as Y,i as ge,R as K,B as U,A as xe,d as Ue,G,T as L,a2 as ne,a3 as je,w as te,h as ye,C as Ce,n as A,o as F,m as Ae,I as ze,a9 as Fe,l as Ne,y as Be,z as We,g as Me,Q as Le}from"./index-CsFgNO3o.js";import{P as we}from"./index-DK6LBEOt.js";import{P as Oe,U as Ke}from"./PlanCard-C-yKIqjp.js";import{S as Ge}from"./storage-Cxal_ji7.js";import{D as Te,G as H}from"./DrogaDataCard-BlZzXeIA.js";import{D as Ve,a as qe,c as Xe}from"./DialogTitle-D1Q0RY_x.js";import{A as be}from"./Autocomplete-91ewa39-.js";import{T as ae,a as re,b as W,c as ie}from"./TableRow-CVrgL676.js";import{T as b}from"./TableCell-F9dx6MLR.js";import{A as Ye}from"./Alert-C9wR4zH8.js";import{P as He}from"./MainPage-CJwvk7F6.js";import{a as Je,D as ve}from"./DeletePrompt-BkwRSmdx.js";import{a as Se}from"./axios-BRiE0AY8.js";import{T as Qe}from"./TableContainer-qijX9D2r.js";import{K as Ze,a as et}from"./KeyboardArrowUp-eGxCS8hM.js";import{S as tt}from"./search-Q2QaBXfU.js";import{I as st}from"./IconTargetArrow-CNY_8Ufo.js";import"./MenuItem-BvD3M8VG.js";import"./Close-Caj59dBO.js";import"./IconPencil-LUwePxj3.js";import"./IconDotsVertical-iUbTma2w.js";import"./IconTrash-D_o8MoK5.js";import"./Box-BBcNUpSQ.js";function Pe(){const m=d.useRef(!1);return _e(()=>(m.current=!0,()=>{m.current=!1}),[]),m}function nt(){const m=Pe(),[h,n]=d.useState(0),s=d.useCallback(()=>{m.current&&n(h+1)},[h]);return[d.useCallback(()=>Ie.postRender(s),[s]),h]}class at extends d.Component{getSnapshotBeforeUpdate(h){const n=this.props.childRef.current;if(n&&h.isPresent&&!this.props.isPresent){const s=this.props.sizeRef.current;s.height=n.offsetHeight||0,s.width=n.offsetWidth||0,s.top=n.offsetTop,s.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function rt({children:m,isPresent:h}){const n=d.useId(),s=d.useRef(null),l=d.useRef({width:0,height:0,top:0,left:0}),{nonce:j}=d.useContext(ke);return d.useInsertionEffect(()=>{const{width:r,height:_,top:g,left:S}=l.current;if(h||!s.current||!r||!_)return;s.current.dataset.motionPopId=n;const p=document.createElement("style");return j&&(p.nonce=j),document.head.appendChild(p),p.sheet&&p.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${r}px !important;
            height: ${_}px !important;
            top: ${g}px !important;
            left: ${S}px !important;
          }
        `),()=>{document.head.removeChild(p)}},[h]),e.jsx(at,{isPresent:h,childRef:s,sizeRef:l,children:d.cloneElement(m,{ref:s})})}const pe=({children:m,initial:h,isPresent:n,onExitComplete:s,custom:l,presenceAffectsLayout:j,mode:r})=>{const _=Re(it),g=d.useId(),S=d.useMemo(()=>({id:g,initial:h,isPresent:n,custom:l,onExitComplete:p=>{_.set(p,!0);for(const y of _.values())if(!y)return;s&&s()},register:p=>(_.set(p,!1),()=>_.delete(p))}),j?[Math.random()]:[n]);return d.useMemo(()=>{_.forEach((p,y)=>_.set(y,!1))},[n]),d.useEffect(()=>{!n&&!_.size&&s&&s()},[n]),r==="popLayout"&&(m=e.jsx(rt,{isPresent:n,children:m})),e.jsx(De.Provider,{value:S,children:m})};function it(){return new Map}function ot(m){return d.useEffect(()=>()=>m(),[])}const O=m=>m.key||"";function lt(m,h){m.forEach(n=>{const s=O(n);h.set(s,n)})}function dt(m){const h=[];return d.Children.forEach(m,n=>{d.isValidElement(n)&&h.push(n)}),h}const ct=({children:m,custom:h,initial:n=!0,onExitComplete:s,exitBeforeEnter:l,presenceAffectsLayout:j=!0,mode:r="sync"})=>{const _=d.useContext($e).forceRender||nt()[0],g=Pe(),S=dt(m);let p=S;const y=d.useRef(new Map).current,M=d.useRef(p),P=d.useRef(new Map).current,R=d.useRef(!0);if(_e(()=>{R.current=!1,lt(S,P),M.current=p}),ot(()=>{R.current=!0,P.clear(),y.clear()}),R.current)return e.jsx(e.Fragment,{children:p.map(i=>e.jsx(pe,{isPresent:!0,initial:n?void 0:!1,presenceAffectsLayout:j,mode:r,children:i},O(i)))});p=[...p];const I=M.current.map(O),N=S.map(O),C=I.length;for(let i=0;i<C;i++){const x=I[i];N.indexOf(x)===-1&&!y.has(x)&&y.set(x,void 0)}return r==="wait"&&y.size&&(p=[]),y.forEach((i,x)=>{if(N.indexOf(x)!==-1)return;const E=P.get(x);if(!E)return;const T=I.indexOf(x);let k=i;if(!k){const B=()=>{y.delete(x);const D=Array.from(P.keys()).filter(w=>!N.includes(w));if(D.forEach(w=>P.delete(w)),M.current=S.filter(w=>{const $=O(w);return $===x||D.includes($)}),!y.size){if(g.current===!1)return;_(),s&&s()}};k=e.jsx(pe,{isPresent:!1,onExitComplete:B,custom:h,presenceAffectsLayout:j,mode:r,children:E},O(E)),y.set(x,k)}p.splice(T,0,k)}),p=p.map(i=>{const x=i.key;return y.has(x)?i:e.jsx(pe,{isPresent:!0,presenceAffectsLayout:j,mode:r,children:i},O(i))}),e.jsx(e.Fragment,{children:y.size?p:p.map(i=>d.cloneElement(i))})},ut=(m,h)=>{const n=[];let s=!0;return m.length===0&&(s=!1,n.push("Please select the unit first")),m.forEach(l=>{l.child_weight==0?(s=!1,n.push(`The ${l.unit_name} Unit weight is required.`)):isNaN(l.child_weight)?(s=!1,n.push(`The ${l.unit_name} Unit weight must be a number.`)):l.child_weight<0?(s=!1,n.push(`The ${l.unit_name} Unit weight cannot be negative.`)):l.child_weight>100&&(s=!1,n.push(`The ${l.unit_name} Unit weight exceeded 100%`)),l.unit_targets.length===0?(s=!1,n.push("Enter the units target")):l.unit_targets.length>0&&l.unit_targets.forEach(j=>{j.parent_id===h&&j.target==0?(s=!1,n.push(`Please enter ${l.unit_name} unit target`)):isNaN(j.target)?(s=!1,n.push(`The ${l.unit_name} target must be a number.`)):j.target<0&&(s=!1,n.push(`The ${l.unit_name} target cannot be negative.`))})}),{valid:s,errors:n}},se=(m,h)=>{const n=[];let s=!0;return m.forEach(l=>{(l==null?void 0:l.unit_targets.find(r=>r.parent_id===h))||(s=!1,n.push(`Please enter ${l.unit_name} target`)),l.unit_targets.forEach(r=>{r.parent_id===h&&r.target==0?(s=!1,n.push(`Please enter ${l.unit_name} target`)):isNaN(r.target)?(s=!1,n.push(`The ${l.unit_name} target must be a number.`)):r.target<0&&(s=!1,n.push(`The ${l.unit_name} target cannot be negative.`))})}),{valid:s,errors:n}},ht=(m,h)=>{const n=[];let s=!0;return m.length===0&&(s=!1,n.push("Please select the employee first")),m.forEach(l=>{l.child_weight==0?(s=!1,n.push(`The ${l.unit_name}  weight is required.`)):isNaN(l.child_weight)?(s=!1,n.push(`The ${l.unit_name} weight must be a number.`)):l.child_weight<0?(s=!1,n.push(`The ${l.unit_name} employee weight is cannot be negative.`)):l.child_weight>100&&(s=!1,n.push(`The ${l.unit_name} employee weight exceeded 100%`)),l.unit_targets.length===0?(s=!1,n.push("Enter the employees target")):l.unit_targets.length>0&&l.unit_targets.forEach(j=>{j.parent_id===h&&j.target===0?(s=!1,n.push(`Please enter ${l.unit_name} employee target`)):isNaN(j.target)?(s=!1,n.push(`The ${l.unit_name} target must be a number.`)):j.target<0&&(s=!1,n.push(`The ${l.unit_name} target cannot be negative.`))})}),{valid:s,errors:n}},Ee=({add:m,onClose:h,plan_id:n,targets:s,naming:l})=>{const j=ge(),[r,_]=K.useState(0),g=d.useRef(r),[S,p]=d.useState("next"),[y,M]=K.useState("units"),[P,R]=K.useState(!1),[I,N]=d.useState([]),[C,i]=K.useState({state:!1,message:""}),[x,E]=d.useState([]),[T,k]=d.useState([]),[B,D]=d.useState([]),[w,$]=d.useState([]),oe=a=>{M(a)},le=(a,t)=>{E(t);const u=t.find(o=>!x.some(c=>c.id===o.id)),f=x.find(o=>!t.some(c=>c.id===o.id));if(u){const o={unit_id:u.id,unit_name:u.name,total_target:s[r].target,child_weight:0,unit_targets:[]};k(c=>[...c,o])}if(f){const o=T.filter(c=>c.unit_id!==f.id);k(o)}},de=(a,t,u)=>{const f=a.target.value;k(o=>o.map(c=>{if(c.unit_id===u){const v=c.unit_targets.findIndex(z=>z.parent_id===t),V=v!==-1?c.unit_targets.map((z,q)=>q===v?{...z,target:f}:z):[...c.unit_targets,{parent_id:t,target:f,weight:""}];return{...c,unit_targets:V}}return c}))},ce=(a,t)=>{const u=a.target.value;k(f=>f.map(o=>o.unit_id===t?{...o,child_weight:u}:o))},ue=(a,t)=>{var o;D(t);const u=t.find(c=>!B.some(v=>v.id===c.id)),f=B.find(c=>!t.some(v=>v.id===c.id));if(u){const c={unit_id:u.id,unit_name:(o=u.user)==null?void 0:o.name,total_target:s[r].target,child_weight:0,unit_targets:[]};$(v=>[...v,c])}if(f){const c=w.filter(v=>v.unit_id!==f.id);$(c)}},he=(a,t,u)=>{const f=a.target.value;$(o=>o.map(c=>{if(c.unit_id===u){const v=c.unit_targets.findIndex(z=>z.parent_id===t),V=v!==-1?c.unit_targets.map((z,q)=>q===v?{...z,target:f}:z):[...c.unit_targets,{parent_id:t,target:f}];return{...c,unit_targets:V}}return c}))},fe=(a,t)=>{const u=a.target.value;$(f=>f.map(o=>o.unit_id===t?{...o,child_weight:u}:o))},me=async()=>{N([]);const a=await H(),t=F.api+F.childUnits,u={Authorization:`Bearer ${a}`,accept:"application/json","Content-Type":"application/json"};fetch(t,{method:"GET",headers:u}).then(f=>f.json()).then(f=>{f.success?N(f.data):A.error(f.data.message)}).catch(f=>{A.error(f.message)})},J=()=>{if(r===0&&y==="units"){const a=ut(T,s[r].id);a.valid?(p("next"),_(t=>(t+1)%s.length),i({...C,state:!1,message:""})):i({...C,state:!0,message:a.errors[0]})}if(r>0&&y==="units"){const a=se(T,s[r].id);a.valid?(p("next"),_(t=>(t+1)%s.length),i({...C,state:!1,message:""})):i({...C,state:!0,message:a.errors[0]})}if(r===0&&y==="employees"){const a=ht(w,s[r].id);a.valid?(p("next"),_(t=>(t+1)%s.length),i({...C,state:!1,message:""})):i({...C,state:!0,message:a.errors[0]})}if(r>0&&y==="employees"){const a=se(w,s[r].id);a.valid?(p("next"),_(t=>(t+1)%s.length),i({...C,state:!1,message:""})):i({...C,state:!0,message:a.errors[0]})}},Q=()=>{r>0&&(p("prev"),_(a=>(a-1+s.length)%s.length))},Z=()=>{const a=se(T,s[r].id),t=se(w,s[r].id);if(!a.valid)return i({...C,state:!0,message:a.errors[0]}),!1;if(!t.valid)return i({...C,state:!0,message:t.errors[0]}),!1;if(a.valid&&t.valid)return!0},ee=async()=>{if(Z()){i({...C,state:!1,message:""}),R(!0);const a=await H(),t=F.api+F.distributeTarget,u={Authorization:`Bearer ${a}`,accept:"application/json","Content-Type":"application/json"};fetch(t,{method:"POST",headers:u,body:JSON.stringify({plan_id:n,unit_target:T,employee_target:w})}).then(o=>o.json()).then(o=>{var c,v;o.success?(R(!1),A.success((c=o.data)==null?void 0:c.message),h(),E([]),k([]),D([]),$([])):(R(!1),A.error((v=o.data)==null?void 0:v.message))}).catch(o=>{A.error(o.message),R(!1)})}};return d.useEffect(()=>(me(),()=>{}),[]),d.useEffect(()=>{g.current=r},[r]),e.jsx(K.Fragment,{children:e.jsxs(Ve,{open:m,onClose:h,children:[e.jsx(U,{sx:{position:"absolute",right:6,top:14},children:e.jsx(xe.div,{whileHover:{rotate:90},transition:{duration:.3},style:{cursor:"pointer",marginRight:12},onClick:h,children:e.jsx(Ue,{size:"1.2rem",stroke:2})})}),s.length>0&&e.jsxs(G,{container:!0,sx:{display:"flex",flexDirection:"column",minWidth:"600px",padding:1.2},children:[e.jsx(G,{item:!0,xs:12,sx:{display:"flex",flexDirection:"row"},children:e.jsx(ct,{mode:"wait",children:e.jsxs(xe.div,{initial:{opacity:0,x:S==="next"?100:-100},animate:{opacity:1,x:0},exit:{opacity:0,x:S==="next"?-100:100},transition:{duration:.3},style:{width:"100%"},children:[e.jsx(U,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingRight:2},children:e.jsxs(U,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(qe,{variant:"h4",children:[l," ",r+1]}),e.jsxs(U,{sx:{display:"flex",alignItems:"center",paddingX:2,borderLeft:1},children:[e.jsx(L,{variant:"body2",children:" Total target is"}),e.jsx(L,{variant:"subtitle1",sx:{backgroundColor:j.palette.grey[100],paddingX:2,borderRadius:10,marginLeft:1},children:s[r].target})]})]})}),e.jsxs(U,{sx:{paddingX:2,marginTop:1.4},children:[e.jsx(U,{sx:{display:"flex",alignItems:"center",marginY:1},children:["units","employees"].map((a,t)=>e.jsx(ne,{label:a,sx:{marginLeft:1,cursor:"pointer",textTransform:"capitalize"},color:"primary",variant:y===a?"filled":"outlined",onClick:()=>oe(a)},t))}),r===0&&e.jsx(e.Fragment,{children:y==="employees"?e.jsx(be,{id:"employee_list",multiple:!0,options:(I==null?void 0:I.employees)||[],getOptionLabel:a=>{var t;return((t=a.user)==null?void 0:t.name)||""},value:B,onChange:ue,renderTags:(a,t)=>a.map((u,f)=>{var o;return e.jsx(ne,{className:"employee-chips",label:((o=u.user)==null?void 0:o.name)||"",...t({index:f})})}),fullWidth:!0,renderInput:a=>e.jsx(je,{...a,label:"Select an employee",variant:"outlined"}),sx:{marginTop:4},disableClearable:!0}):e.jsx(be,{id:"unit_list",multiple:!0,options:(I==null?void 0:I.child_unit)||[],getOptionLabel:a=>a.name||"",value:x,onChange:le,renderTags:(a,t)=>a.map((u,f)=>e.jsx(ne,{className:"unit-chips",label:u.name||"",...t({index:f})})),fullWidth:!0,renderInput:a=>e.jsx(je,{...a,label:"Select a unit",variant:"outlined"}),sx:{marginTop:4},disableClearable:!0})}),y==="employees"?e.jsxs(ae,{children:[e.jsx(re,{children:e.jsxs(W,{children:[e.jsx(b,{sx:{minWidth:120},children:"Employee name"}),r===0&&e.jsx(b,{sx:{minWidth:80},children:"Annum weight(%)"}),e.jsx(b,{sx:{minWidth:80},children:"Employee target"})]})}),e.jsx(ie,{children:w.length===0?e.jsx(W,{children:e.jsx(b,{sx:{display:"flex",alignItems:"center",padding:2,border:0},colSpan:3,children:"Please select employee"})}):w==null?void 0:w.map((a,t)=>{var o;const u=(o=a.unit_targets)==null?void 0:o.findIndex(c=>c.parent_id===s[r].id),f=u!==-1&&u!==void 0?a.unit_targets[u].target:"";return e.jsxs(W,{children:[e.jsx(b,{children:a.unit_name}),r===0&&e.jsx(b,{children:e.jsx(te,{sx:{p:.5,border:.4,borderRadius:2,borderColor:"primary.main"},value:a.child_weight,onChange:c=>fe(c,a.unit_id),inputProps:{"aria-label":"target"},type:"number"})}),e.jsx(b,{children:e.jsx(te,{sx:{p:.5,border:.4,borderRadius:2,borderColor:"primary.main"},value:f,onChange:c=>he(c,s[r].id,a.unit_id),inputProps:{"aria-label":"target"},type:"number"})})]},t)})})]}):e.jsxs(ae,{children:[e.jsx(re,{children:e.jsxs(W,{children:[e.jsx(b,{sx:{minWidth:120},children:"Unit name"}),r===0&&e.jsx(b,{sx:{minWidth:80},children:"Annum Weight(%)"}),e.jsx(b,{sx:{minWidth:80},children:"Unit target"})]})}),e.jsx(ie,{children:T.length===0?e.jsx(W,{children:e.jsx(b,{sx:{display:"flex",alignItems:"center",padding:2,border:0},colSpan:3,children:"Please select unit"})}):T==null?void 0:T.map((a,t)=>{var o;const u=(o=a.unit_targets)==null?void 0:o.findIndex(c=>c.parent_id===s[r].id),f=u!==-1&&u!==void 0?a.unit_targets[u].target:"";return e.jsxs(W,{children:[e.jsx(b,{children:a.unit_name}),r===0&&e.jsx(b,{children:e.jsx(te,{sx:{p:.5,border:1,borderRadius:2,borderColor:"primary.main"},value:a.child_weight,onChange:c=>ce(c,a.unit_id),inputProps:{"aria-label":"target"}})}),e.jsx(b,{children:e.jsx(te,{sx:{p:.5,border:1,borderRadius:2,borderColor:"primary.main"},value:f,onChange:c=>de(c,s[r].id,a.unit_id),inputProps:{"aria-label":"target"},type:"number"})})]},t)})})]})]})]},r)})}),e.jsxs(Xe,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(U,{children:[" ",C.state&&e.jsxs(Ye,{severity:"error",children:[" ",C.message]})]}),e.jsxs(U,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingX:2},children:[e.jsx(ye,{sx:{marginRight:3},onClick:()=>Q(),children:"Back"}),r===s.length-1?e.jsx(ye,{type:"button",variant:"contained",sx:{py:1,paddingX:6,boxShadow:0,borderRadius:2},onClick:()=>ee(),disabled:P,children:P?e.jsx(Ce,{size:18,sx:{color:"white"}}):e.jsx(L,{variant:"subtitle1",color:j.palette.background.default,children:"Submit"})}):e.jsx(Te,{title:"Next",type:"button",variant:"contained",sx:{paddingX:6,boxShadow:0},onPress:()=>J()})]})]})]})]})})};Ee.propTypes={add:Y.bool,onClose:Y.func,plan:Y.array,plan_id:Y.number,targets:Y.array,naming:Y.string};const ft=({plans:m})=>{var I,N,C;const h=ge(),[n,s]=d.useState(null),[l,j]=d.useState(null),[r,_]=d.useState(),[g,S]=d.useState(!1),[p,y]=d.useState(!1),M=i=>{n===i?(s(null),j(null)):(s(i),j(null))},P=i=>{_(i),S(!0)},R=async()=>{y(!0);try{const i=await H(),x=F.api+F.deletePlan+`/${r==null?void 0:r.id}`,E=await Se.delete(x,{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}});E.data.success?(S(!1),A.success(E.data.data.message)):A.error(E.data.data.message)}catch(i){A.error(i.message)}finally{y(!1)}};return e.jsxs(K.Fragment,{children:[e.jsx(Qe,{component:Ae,sx:{minHeight:"44dvh",marginTop:2,backgroundColor:h.palette.grey[100],borderRadius:2},children:e.jsxs(ae,{sx:{minWidth:650},"aria-label":"Distributed target table",children:[e.jsx(re,{children:e.jsxs(W,{children:[e.jsx(b,{children:"Unit name"}),e.jsx(b,{children:"Inherited Weights(%)"}),e.jsx(b,{children:"KPI Weights(%)"}),e.jsx(b,{children:"Action"})]})}),e.jsx(ie,{children:m==null?void 0:m.map((i,x)=>{var E,T,k,B;return e.jsxs(e.Fragment,{children:[e.jsxs(W,{sx:{backgroundColor:n==x&&h.palette.primary[200],":hover":{backgroundColor:h.palette.primary[200],color:h.palette.background.default,cursor:"pointer",borderRadius:2}},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",border:0},children:[e.jsx(ze,{"aria-label":"expand row",size:"small",onClick:()=>M(x),children:n===x?e.jsx(Ze,{}):e.jsx(et,{})}),e.jsxs(L,{variant:"subtitle1",sx:{marginLeft:2},children:[" ",i!=null&&i.unit?(E=i==null?void 0:i.unit)==null?void 0:E.name:(k=(T=i==null?void 0:i.employee)==null?void 0:T.user)==null?void 0:k.name]})]}),e.jsxs(b,{sx:{border:0},children:[parseFloat(i==null?void 0:i.inherit_weight).toFixed(2),"%"]}),e.jsxs(b,{sx:{border:0},children:[parseFloat(i==null?void 0:i.weight).toFixed(2),"%"]}),e.jsx(b,{sx:{border:0},children:e.jsx(Je,{onView:()=>M(x),onDelete:()=>P(i)})})]},x),n==x&&e.jsx(W,{children:e.jsx(b,{colSpan:7,children:e.jsx(Fe,{in:n!==null,timeout:"auto",unmountOnExit:!0,sx:{backgroundColor:h.palette.background.default,borderRadius:2},children:e.jsxs(ae,{sx:{minWidth:650},"aria-label":"Organization plan table",children:[e.jsx(re,{children:e.jsxs(W,{children:[e.jsx(b,{children:"Period"}),e.jsx(b,{children:"Target"})]})}),e.jsx(ie,{children:(B=i==null?void 0:i.target)==null?void 0:B.map((D,w)=>{var $;return e.jsxs(W,{sx:l==D.id?{backgroundColor:h.palette.background.default,":hover":{backgroundColor:h.palette.grey[100],color:h.palette.background.default,cursor:"pointer",borderRadius:2}}:{backgroundColor:h.palette.primary.light,":hover":{backgroundColor:h.palette.grey[100],color:h.palette.background.default,cursor:"pointer",borderRadius:2}},children:[e.jsx(b,{sx:{border:0},children:we(($=i==null?void 0:i.frequency)==null?void 0:$.name)+" "+(w+1)}),e.jsx(b,{sx:{border:0,fontWeight:"bold"},children:D==null?void 0:D.target})]},w)})})]})})})})]})})})]})}),g&&e.jsx(ve,{type:"Delete",open:g,title:"Deleting child plan",description:`Are you sure you want to delete ${r!=null&&r.unit?((I=r==null?void 0:r.unit)==null?void 0:I.name)+" unit":(C=(N=r==null?void 0:r.employee)==null?void 0:N.user)==null?void 0:C.name}`,onNo:()=>S(!1),onYes:()=>R(),deleting:p,handleClose:()=>S(!1)})]})},Ft=()=>{var Z,ee,a;const m=ge(),h=Ne(),{state:n}=Be(),{handleUpdatePlan:s}=We(),[l,j]=d.useState(!1),[r,_]=d.useState(!0),[g,S]=d.useState(n),[p,y]=d.useState([]),[M,P]=d.useState(!1),[R,I]=d.useState("units"),[N,C]=d.useState(!1),[i,x]=d.useState(!1),[E,T]=d.useState(!1),[k,B]=d.useState(!1),[D,w]=d.useState(),$=()=>{s([]),x(!1)},oe=t=>{var o,c,v,V,z,q;const u={id:t==null?void 0:t.kpi_id,f_name:(o=t==null?void 0:t.frequency)==null?void 0:o.name,f_value:(c=t==null?void 0:t.frequency)==null?void 0:c.value,frequency_id:t==null?void 0:t.frequency_id,mu:(V=(v=t==null?void 0:t.kpi)==null?void 0:v.measuring_unit)==null?void 0:V.name,name:(z=t==null?void 0:t.kpi)==null?void 0:z.name,total_target:t==null?void 0:t.total_target,weight:t==null?void 0:t.weight},f=(q=t==null?void 0:t.target)==null?void 0:q.map(X=>({period_id:X==null?void 0:X.period_id,target:X==null?void 0:X.target}));s([{...u,targets:f}]),Ge.setItem("selectFiscal",JSON.stringify({id:t==null?void 0:t.fiscal_year_id,year:""})),x(!0)},le=t=>{oe(t)},de=()=>{T(!0)},ce=async()=>{B(!0);try{const t=await H(),u=F.api+F.deletePlan+`/${n==null?void 0:n.id}`,f=await Se.delete(u,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});f.data.success?(T(!1),A.success(f.data.data.message),h(-1)):A.error(f.data.data.message)}catch(t){A.error(t.message)}finally{B(!1)}},ue=()=>{C(!0)},he=()=>{C(!1)},fe=t=>{const u=t.target.value;w(u)},me=t=>{I(t)},J=async()=>{const t=await H(),u=F.api+F.showPlan+"/"+(n==null?void 0:n.id),f={Authorization:`Bearer ${t}`,accept:"application/json","Content-Type":"application/json"};fetch(u,{method:"GET",headers:f}).then(o=>o.json()).then(o=>{o.success&&S(o.data),P(!1)}).catch(o=>{A(o.message),P(!0)})},Q=async()=>{_(!0);const t=await H(),u=F.api+F.childTarget+(n==null?void 0:n.id)+`?unit_type=${R}&search=${D}`,f={Authorization:`Bearer ${t}`,accept:"application/json","Content-Type":"application/json"};fetch(u,{method:"GET",headers:f}).then(o=>o.json()).then(o=>{o.success?(y(o.data),P(!1)):P(!0)}).catch(o=>{A(o.message),P(!0)}).finally(()=>{_(!1)})};return d.useEffect(()=>{const t=setTimeout(()=>{Q()},800);return()=>{clearTimeout(t)}},[D]),d.useEffect(()=>{J(),l?Q():j(!0)},[n==null?void 0:n.id,R]),e.jsxs(K.Fragment,{children:[e.jsx(He,{back:!0,title:`${n?(Z=g==null?void 0:g.kpi)==null?void 0:Z.name:"Plan Details"}`,children:e.jsxs(G,{container:!0,spacing:Me,sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",marginTop:2,padding:2},children:[e.jsxs(G,{item:!0,xs:12,sm:12,md:11,lg:3.7,xl:2.8,children:[e.jsx(Oe,{plan:g,onEdit:()=>le(g),onDelete:()=>de()}),e.jsx(Te,{fullWidth:!0,title:"Cascade Targets",onPress:()=>ue(),sx:{marginY:2,padding:1.6,boxShadow:0}})]}),e.jsxs(G,{item:!0,xs:12,sm:12,md:11,lg:8,xl:9,sx:{border:1,borderColor:m.palette.divider,backgroundColor:m.palette.background.default,borderRadius:3,padding:2,marginTop:3},children:[e.jsxs(U,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",marginBottom:2.4},children:[e.jsx(L,{variant:"h4",children:"Target Distributed"}),e.jsx(U,{sx:{display:"flex",alignItems:"center"},children:["units","employees"].map((t,u)=>e.jsx(ne,{label:t,sx:{marginLeft:u>0&&2,cursor:"pointer",textTransform:"capitalize",paddingX:2,paddingY:.4},color:"primary",variant:R===t?"filled":"outlined",onClick:()=>me(t),children:t},u))})]}),e.jsx(G,{container:!0,children:e.jsx(G,{item:!0,xs:12,md:11,sm:8,lg:4,xl:4,children:e.jsx(tt,{title:"Search",value:D,onChange:t=>fe(t)})})}),r?e.jsx(U,{sx:{padding:4,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ce,{size:20})}):M?e.jsx(U,{sx:{padding:4,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(L,{variant:"body2",children:"There is error fetching the targets"})}):p.length===0?e.jsxs(U,{sx:{padding:4,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx(st,{size:80,color:m.palette.grey[400]}),e.jsx(L,{variant:"h4",sx:{marginTop:1.6},children:"Target is not found"}),e.jsx(L,{variant:"caption",children:"The list of distributed target will be listed here"})]}):e.jsx(ft,{plans:p})]})]})}),e.jsx(Ke,{add:i,onClose:$,onSucceed:()=>J()}),E&&e.jsx(ve,{type:"Delete",open:E,title:"Deleting Plan",description:"Are you sure you want to delete "+((ee=g==null?void 0:g.kpi)==null?void 0:ee.name),onNo:()=>T(!1),onYes:()=>ce(),deleting:k,handleClose:()=>T(!1)}),e.jsx(Ee,{add:N,onClose:he,plan_id:g==null?void 0:g.id,targets:g==null?void 0:g.target,naming:we((a=g==null?void 0:g.frequency)==null?void 0:a.name)}),e.jsx(Le,{})]})};export{Ft as default};
