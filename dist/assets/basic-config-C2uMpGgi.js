import{b2 as bt,b3 as vt,aT as it,r as l,b4 as St,j as e,b6 as Ct,bd as Pt,bz as _t,bf as kt,O as Ce,m as E,G as $,Y as L,af as Pe,bO as _e,b as T,q as ke,v as we,w as Fe,x as ie,y as X,z as De,I as he,bP as wt,a7 as Ee,a3 as G,aa as qe,ab as Ae,_ as fe,$ as Ie,a1 as Te,T as I,a4 as $e,aj as me,f as Z,h as f,B as n,ac as Ft,V as lt,a2 as ve,bQ as Dt,bR as Et,l as xe,M as qt,N as nt,Z as At,ad as It,R as ct,at as dt,ap as Tt,P as je,aG as ot,t as $t,as as Bt,a0 as Yt,U as Ot,ae as be,ai as Wt,al as Nt,am as zt,n as Mt}from"./index-DL-CLDEe.js";import{M as Vt}from"./MoreVert-BRUUUxnj.js";function Jt(h){return bt("MuiAccordionDetails",h)}vt("MuiAccordionDetails",["root"]);const Rt=["className"],Lt=_t(),Gt=h=>{const{classes:a}=h;return kt({root:["root"]},Jt,a)},Ht=it("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(h,a)=>a.root})(({theme:h})=>({padding:h.spacing(1,2,2)})),Ut=l.forwardRef(function(a,q){const B=Lt({props:a,name:"MuiAccordionDetails"}),{className:m}=B,s=St(B,Rt),Y=B,w=Gt(Y);return e.jsx(Ht,Ct({className:Pt(w.root,m),ref:q,ownerState:Y},s))}),Qt=()=>{const[h,a]=l.useState([]),[q,B]=l.useState(!1),[m,s]=l.useState(null),[Y,w]=l.useState(null),[U,Q]=l.useState(""),[R,F]=l.useState(""),[_,S]=l.useState(null),[A,V]=l.useState(""),[x,z]=l.useState(""),[C,o]=l.useState(!1),c=async()=>{var D;o(!0);try{const j=await Z(),ee=f.api+f.perspectiveTypes,H=await fetch(ee,{method:"GET",headers:{Authorization:`Bearer ${j}`,"Content-Type":"application/json"}}),J=await H.json();J!=null&&J.success?a((D=J==null?void 0:J.data)==null?void 0:D.data):n.error((H==null?void 0:H.message)||"Failed to fetch perspectives")}catch(j){n.error((j==null?void 0:j.message)||"Error fetching perspectives")}finally{o(!1)}};l.useEffect(()=>{c()},[]);const y=async D=>{try{const j=localStorage.getItem("token");if(!j)throw new Error("No token found");const ee=editIndex!==null?"PATCH":"POST",H=editIndex!==null?`${f.api}perspective-types/${perceptives[editIndex].id}`:`${f.api}perspective-types`,J=await fetch(H,{method:ee,headers:{Authorization:`Bearer ${j}`,"Content-Type":"application/json",Accept:"application/json, text/plain, */*"},body:JSON.stringify({name:D.perspectiveName})}),se=await J.json();J.ok?se.success?(setPerceptives(ce=>editIndex!==null?ce.map((ye,ge)=>ge===editIndex?se.data:ye):[...ce,se.data]),W(),setSnackbarMessage("Perspective saved successfully!"),setSnackbarSeverity("success")):(setSnackbarMessage("Error creating/updating perspective: "+se.message),setSnackbarSeverity("error")):(setSnackbarMessage("Perspective already exists"),setSnackbarSeverity("warning")),setSnackbarOpen(!0)}catch(j){setSnackbarMessage("Error creating/updating perspective: "+j.message),setSnackbarSeverity("error"),setSnackbarOpen(!0)}},P=async D=>{await y(D)},O=async D=>{try{const j=localStorage.getItem("token"),ee=await fetch(`${f.api}perspective-types/${D}`,{method:"DELETE",headers:{Authorization:`Bearer ${j}`,"Content-Type":"application/json"}});if(ee.status===204)setPerceptives(H=>H.filter(J=>J.id!==D)),setSnackbarMessage("Perspective deleted successfully!"),setSnackbarSeverity("success");else{const H=await ee.json();H.success?(setPerceptives(J=>J.filter(se=>se.id!==D)),setSnackbarMessage("Perspective deleted successfully!"),setSnackbarSeverity("success")):(setSnackbarMessage("Failed to delete perspective: "+H.message),setSnackbarSeverity("error"))}}catch(j){setSnackbarMessage("Error deleting perspective: "+j.message),setSnackbarSeverity("error")}setSnackbarOpen(!0),handleCloseMenu()},k=Ce({initialValues:{perspectiveName:""},onSubmit:(D,{resetForm:j})=>{editIndex!==null?P(D):y(D),j()}}),M=()=>{B(!0)},W=()=>{B(!1),Q(""),F(""),z(""),V(""),S(null)},K=(D,j)=>{s(D.currentTarget),w(j)},re=()=>{s(null),w(null)},ae=useTheme();return e.jsx(E,{p:0,children:e.jsxs($,{container:!0,spacing:3,children:[e.jsxs($,{item:!0,xs:12,children:[e.jsx($,{item:!0,xs:12,p:2,style:{padding:"2px 2px 2px 25px"},children:e.jsx(L,{variant:"contained",color:"primary",onClick:()=>{k.resetForm(),setEditIndex(!1),M()},children:"Create New Perspective"})}),e.jsx(Pe,{children:perceptives.length===0?e.jsxs(E,{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",children:[e.jsx(_e,{color:"disabled",style:{fontSize:60}}),e.jsx(T,{variant:"subtitle1",color:"textSecondary",align:"center",marginLeft:2,children:"No perspectives entered yet."})]}):e.jsx(ke,{style:{border:"1px solid #ddd"},children:e.jsxs(we,{sx:{minWidth:650,borderCollapse:"collapse"},children:[e.jsx(Fe,{children:e.jsx(ie,{children:["Perspectives","Actions"].map(D=>e.jsx(X,{sx:{background:ae.palette.grey[100],color:"#000",fontWeight:"bold",fontSize:"0.9rem",borderBottom:`2px solid ${ae.palette.divider}`,position:"relative",padding:"12px 16px","&:not(:last-of-type)":{borderRight:`1px solid ${ae.palette.divider}`}},children:D},D))})}),e.jsx(De,{children:perceptives.map((D,j)=>e.jsxs(ie,{sx:{backgroundColor:ae.palette.background.paper,borderRadius:2,"&:nth-of-type(odd)":{backgroundColor:ae.palette.grey[50]},"&:hover":{backgroundColor:ae.palette.grey[100]}},children:[e.jsx(X,{component:"th",scope:"row",sx:{display:"flex",alignItems:"center",border:0,padding:"12px 16px"},children:D.name}),e.jsxs(X,{sx:{border:0,padding:"12px 16px"},children:[e.jsx(he,{color:"primary",onClick:ee=>K(ee,j),children:e.jsx(wt,{})}),e.jsxs(Ee,{anchorEl:m,open:!!m&&Y===j,onClose:re,children:[e.jsxs(G,{onClick:()=>{S(j),z(perspective.name),V(perspective.description),re(),M()},children:[e.jsx(qe,{fontSize:"small"})," Edit"]}),e.jsxs(G,{onClick:()=>{O(),re()},children:[e.jsx(Ae,{fontSize:"small"})," Delete"]})]})]})]},D.id))})]})})})]}),e.jsxs(fe,{open:q,onClose:W,children:[e.jsx(Ie,{children:_!==null?"Edit Perspective":"Add Perspective"}),e.jsx(Te,{children:e.jsxs("form",{onSubmit:k.handleSubmit,children:[e.jsx(I,{autoFocus:!0,margin:"dense",label:"Perspective Name",type:"text",fullWidth:!0,variant:"outlined",value:_!==null?x:U,onChange:_!==null?handleEditChange:handleChange}),e.jsx(I,{margin:"dense",label:"Description",type:"text",fullWidth:!0,variant:"outlined",value:_!==null?A:R,onChange:_!==null?handleEditDesChange:handleDescriptionChange})]})}),e.jsxs($e,{children:[e.jsx(L,{onClick:W,color:"primary",children:"Cancel"}),_!==null?e.jsx(L,{onClick:handleEditSave,color:"primary",children:"Save"}):e.jsx(L,{onClick:y,color:"primary",children:"Add"})]})]}),e.jsx(me,{})]})})};function Xt({value:h,color:a}){return e.jsxs(E,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(E,{sx:{width:"100%",mr:1},children:e.jsx(Et,{variant:"determinate",value:h,sx:{backgroundColor:"#eee","& .MuiLinearProgress-bar":{backgroundColor:a}}})}),e.jsx(E,{sx:{minWidth:35},children:e.jsx(T,{variant:"body2",sx:{color:"text.secondary"},children:`${Math.round(h)}`})})]})}function Zt(){const[h,a]=l.useState([]),[q,B]=l.useState(!1),[m,s]=l.useState({scale:"",score:"",color:"",description:""}),[Y,w]=l.useState(!1),[U,Q]=l.useState(!1),R=async()=>{w(!0);const x=await Z(),z=f.api+f.performanceratingscale;fetch(z,{method:"GET",headers:{Authorization:`Bearer ${x}`,accept:"application/json","Content-Type":"application/json"}}).then(C=>C.json()).then(C=>{C.success?(a(C.data.data),w(!1)):(w(!1),Q(!0),n(C.data.message))}).catch(C=>{n.error(C.data.data.message),Q(!0),w(!1)})},F=()=>B(!0),_=()=>B(!1),S=x=>{const{name:z,value:C}=x.target;s({...m,[z]:C})},A=x=>{s({...m,color:x.hex})},V=async()=>{w(!0);const x=await Z(),z=f.api+f.performanceratingscale;fetch(z,{method:"POST",headers:{Authorization:`Bearer ${x}`,accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({scale:m.scale,score:m.score,color:m.color,description:m.description})}).then(C=>C.json()).then(C=>{C.success?(a(o=>[...o,C.data]),_(),R(),s({scale:"",score:"",color:"",description:""}),n.success(C.data.message)):n.error(C.data.message)}).catch(C=>{n.error("Error: "+C.message)}).finally(()=>{w(!1)})};return l.useEffect(()=>{R()},[]),e.jsxs(E,{sx:{width:"100%",p:2},children:[e.jsx(L,{variant:"contained",color:"primary",onClick:F,children:"Add"}),h.length===0?e.jsx(T,{sx:{mt:2},children:"No Performance Rating Scale Created Yet. Click the Add button to create one."}):e.jsx(E,{sx:{mt:2},children:h==null?void 0:h.map((x,z)=>e.jsxs(E,{sx:{mb:2},children:[e.jsx(T,{variant:"h6",children:x.description||`Performance Rate Scale - ${z+1}`}),e.jsx(T,{variant:"body2",children:`Scale: ${x.scale}`}),e.jsx(T,{variant:"body2",children:x.description}),e.jsx(Xt,{value:x.score,color:x.color})]},z))}),e.jsx(Ft,{open:q,onClose:_,children:e.jsxs(E,{sx:{p:4,bgcolor:"background.paper",maxWidth:400,mx:"auto",my:"5%"},children:[e.jsx(T,{variant:"h6",gutterBottom:!0,children:"Create Performance Rating Scale"}),e.jsx(lt,{id:"scale-select-label",children:"Scale"}),e.jsxs(ve,{labelId:"scale-select-label",name:"scale",value:m.scale,onChange:S,fullWidth:!0,sx:{mb:2},children:[e.jsx(G,{value:"Very Good",children:"Very Good"}),e.jsx(G,{value:"Good",children:"Good"}),e.jsx(G,{value:"Average",children:"Average"}),e.jsx(G,{value:"Poor",children:"Poor"})]}),e.jsx(I,{name:"score",label:"Score (e.g., >50, <90, =30)",value:m.score,onChange:S,fullWidth:!0,type:"text",sx:{mb:2}}),e.jsx(T,{variant:"body2",gutterBottom:!0,children:"Select Color"}),e.jsx(Dt,{color:m.color,onChangeComplete:A}),e.jsx(I,{name:"description",label:"Description",value:m.description,onChange:S,fullWidth:!0,sx:{mt:2}}),e.jsxs(E,{sx:{display:"flex",justifyContent:"space-between",mt:3},children:[e.jsx(L,{variant:"outlined",color:"error",onClick:_,children:"Cancel"}),e.jsx(L,{variant:"contained",color:"primary",onClick:V,disabled:Y,children:Y?"Saving...":"Save"})]})]})}),e.jsx(me,{})]})}const Kt=()=>{const[h,a]=l.useState([]),[q,B]=l.useState(!1),[m,s]=l.useState(null),[Y,w]=l.useState(!1),[U,Q]=l.useState(null);xe();const R=async()=>{w(!0);try{const o=await Z(),c=f.api+f.jobposition,P=await(await fetch(c,{method:"GET",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}})).json();P!=null&&P.success?a(P.data.data||[]):n.error((P==null?void 0:P.message)||"Failed to fetch job positions")}catch(o){n.error((o==null?void 0:o.message)||"Error fetching job positions")}finally{w(!1)}},F=async o=>{if(o.name.trim()&&o.job_code.trim()&&m!==null){w(!0);const c=await Z();if(!c){n.error("Authorization token is missing."),w(!1);return}const y=f.api+f.jobposition+`/${o.id}`,P={Authorization:`Bearer ${c}`,"Content-Type":"application/json",accept:"application/json"},O={name:o.name,code:o.job_code};try{const k=await fetch(y,{method:"PATCH",headers:P,body:JSON.stringify(O)});if(!k.ok){const W=await k.json();throw n.error((W==null?void 0:W.message)||"Failed to update job position."),new Error((W==null?void 0:W.message)||"Failed to update job position.")}const M=await k.json();if(M.success){const W=h.map((K,re)=>re===m?M.data.job_position:K);a(W),n.success((M==null?void 0:M.message)||"Job Position updated successfully!"),V(),await R()}else n.error((M==null?void 0:M.message)||"Failed to update job position")}catch(k){n.error((k==null?void 0:k.message)||"Error updating job position")}finally{w(!1)}}else n.error("Both job position name and code are required.")},_=async o=>{if(o.name.trim()&&o.job_code.trim()){w(!0);try{const c=await Z();if(!c){n.error("Authorization token is missing."),w(!1);return}let y,P;m!==null?(y=f.api+f.jobposition+`/${o.id}`,P="PATCH"):(y=f.api+f.jobposition,P="POST");const O=await fetch(y,{method:P,headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"},body:JSON.stringify(o)}),k=await O.json();O.ok&&k.success?(m!==null?(a(M=>M.map((W,K)=>K===m?k.data.job_position:W)),n.success(O.data.message||"Job Position updated successfully")):(a(M=>[...M,k.data.job_position]),n.success(O.data.message||"Job Position added successfully")),V(),await R()):n.error(k.message||"Failed to submit job position")}catch(c){n.error("Error submitting job position: "+(c.message||"Unknown error"))}finally{w(!1)}}else n.error("Job Position name and code cannot be empty.")},S=async o=>{const c=await Z();try{const y=f.api+f.jobposition+`/${o}`,O=await(await fetch(y,{method:"DELETE",headers:{Authorization:`Bearer ${c}`}})).json();O.success?(a(h.filter(k=>k.id!==o)),n.success(O.message||"Job Position deleted successfully")):n.error(O.message||"Failed to delete job position")}catch(y){n.error("Error deleting job position: "+(y.message||"Unknown error"))}};l.useEffect(()=>{R()},[]);const A=(o=null,c=null)=>{s(c),x.setValues(o||{name:"",job_code:""}),B(!0)},V=()=>{B(!1),s(null),x.resetForm()},x=Ce({initialValues:{name:"",job_code:""},validationSchema:qt({name:nt().required("Job Position name is required"),job_code:nt().required("Code is required")}),onSubmit:o=>{m!==null?F(o):_(o)}}),z=(o,c)=>{Q(o.currentTarget),s(c)},C=()=>{Q(null)};return e.jsxs(E,{children:[e.jsx($,{container:!0,spacing:3,children:e.jsxs($,{item:!0,xs:12,children:[e.jsx(L,{variant:"contained",color:"primary",onClick:()=>A(),children:"Add"}),e.jsx(Pe,{children:Y?e.jsx(E,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:e.jsx(At,{})}):h.length===0?e.jsxs(E,{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",children:[e.jsx(_e,{color:"disabled",style:{fontSize:60}}),e.jsx(T,{variant:"subtitle1",color:"textSecondary",align:"center",marginLeft:2,children:"No job positions entered yet."})]}):e.jsx(ke,{style:{border:"1px solid #ddd"},children:e.jsxs(we,{sx:{minWidth:650,borderCollapse:"collapse"},children:[e.jsx(Fe,{children:e.jsx(ie,{children:["Job Position","Code","Actions"].map(o=>e.jsx(X,{children:o},o))})}),e.jsx(De,{children:h.map((o,c)=>e.jsxs(ie,{children:[e.jsx(X,{children:o.name}),e.jsx(X,{children:o.job_code}),e.jsxs(X,{children:[e.jsx(he,{color:"primary",onClick:y=>z(y,c),children:e.jsx(Vt,{})}),e.jsxs(Ee,{anchorEl:U,open:!!U&&m===c,onClose:C,children:[e.jsxs(G,{onClick:()=>{A(o,c),C()},children:[e.jsx(qe,{})," Edit"]}),e.jsxs(G,{onClick:()=>{S(o.id),C()},children:[e.jsx(Ae,{})," Delete"]})]})]})]},o.id))})]})})})]})}),e.jsxs(fe,{open:q,onClose:V,children:[e.jsx(Ie,{children:m!==null?"Edit Job Position":"Add Job Position"}),e.jsx(Te,{children:e.jsxs("form",{onSubmit:x.handleSubmit,children:[e.jsx(I,{autoFocus:!0,margin:"dense",label:"Job Position",type:"text",fullWidth:!0,variant:"outlined",...x.getFieldProps("name"),error:x.touched.name&&!!x.errors.name,helperText:x.touched.name&&x.errors.name}),e.jsx(I,{margin:"dense",label:"Job Code",type:"text",fullWidth:!0,variant:"outlined",...x.getFieldProps("job_code"),error:x.touched.job_code&&!!x.errors.job_code,helperText:x.touched.job_code&&x.errors.job_code}),e.jsxs($e,{children:[e.jsx(L,{onClick:V,color:"primary",children:"Cancel"}),e.jsx(L,{type:"submit",color:"primary",children:m!==null?"Update":"Add"})]})]})})]}),e.jsx(me,{})]})};function ea(){const[h,a]=l.useState([]),[q,B]=l.useState(null),[m,s]=l.useState(!1),[Y,w]=l.useState(null),[U,Q]=l.useState(null);xe(),l.useEffect(()=>{R()},[]);const R=async()=>{try{const c=await Z(),y=f.api+"frequencies",O=await(await fetch(y,{method:"GET",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"}})).json();O.success?a(O.data.data):n.error("Failed to fetch frequencies")}catch{n.error("Error occurred while fetching frequencies")}},F=Ce({initialValues:{name:"",value:""},onSubmit:async(c,{resetForm:y})=>{try{const P=q!==null?"PATCH":"POST",O=q!==null?`${f.api}frequencies/${h[q].id}`:`${f.api}frequencies`,k=await Z(),W=await(await fetch(O,{method:P,headers:{Authorization:`Bearer ${k}`,"Content-Type":"application/json"},body:JSON.stringify({name:c.name,value:c.value})})).json();W.success?(n.success(q!==null?"Frequency updated":"Frequency created"),R(),z()):n.error(W.message||"Failed to save frequency")}catch{n.error("Error occurred while saving frequency")}y()}}),_=c=>{F.setFieldValue("name",h[c].name),F.setFieldValue("value",h[c].value),B(c),x()},S=async c=>{try{const y=await Z(),P=f.api+`frequencies/${h[c].id}`,k=await(await fetch(P,{method:"DELETE",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"}})).json();k.success?(n.success("Frequency deleted"),R()):n.error(k.message||"Failed to delete frequency")}catch{n.error("Error occurred while deleting frequency")}},A=(c,y)=>{w(c.currentTarget),Q(y)},V=()=>{w(null),Q(null)},x=()=>{s(!0)},z=()=>{s(!1),F.resetForm(),B(null)},o=It().some(c=>c.permissions.some(y=>y.name==="create:endofdayactivity"));return e.jsxs(ct.Fragment,{children:[e.jsx($,{container:!0,children:e.jsxs($,{item:!0,xs:12,children:[e.jsxs($,{xs:12,sx:{display:"flex",alignItems:"center",justifyContent:"space-between",my:2},children:[e.jsx(E,{}),e.jsx(dt,{title:"Create Frequency",variant:"outlined",onPress:x})]}),h.length===0?e.jsxs(E,{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",children:[e.jsx(_e,{color:"disabled",style:{fontSize:60}}),e.jsx(T,{variant:"subtitle1",color:"textSecondary",align:"center",marginLeft:2,children:"No frequencies registered yet."})]}):e.jsx(ke,{children:e.jsxs(we,{children:[e.jsx(Fe,{children:e.jsx(ie,{children:["Frequency Name","Value","Actions"].map(c=>e.jsx(X,{children:c},c))})}),e.jsx(De,{children:h.map((c,y)=>e.jsxs(ie,{children:[e.jsx(X,{component:"th",scope:"row",children:c.name}),e.jsx(X,{children:c.value}),e.jsxs(X,{children:[e.jsx(he,{color:"primary",onClick:P=>A(P,y),children:e.jsx(Tt,{size:"1.4rem",stroke:1.8,color:"grey"})}),e.jsxs(Ee,{anchorEl:Y,open:!!Y&&U===y,onClose:V,children:[e.jsxs(G,{onClick:()=>{_(y),V()},children:[e.jsx(qe,{fontSize:"small",disabled:!o})," Edit"]}),e.jsxs(G,{onClick:()=>{S(y),V()},children:[e.jsx(Ae,{fontSize:"small"})," Delete"]})]})]})]},c.id))})]})})]})}),e.jsxs(fe,{open:m,onClose:z,children:[e.jsx(Ie,{children:q!==null?"Edit Frequency":"Create Frequency"}),e.jsx(Te,{children:e.jsxs(E,{component:"form",onSubmit:F.handleSubmit,children:[e.jsx(I,{autoFocus:!0,margin:"dense",id:"name",name:"name",label:"Frequency Name",type:"text",fullWidth:!0,value:F.values.name,onChange:F.handleChange,error:F.touched.name&&!!F.errors.name,helperText:F.touched.name&&F.errors.name}),e.jsx(I,{margin:"dense",id:"value",name:"value",label:"Value",type:"number",fullWidth:!0,value:F.values.value,onChange:F.handleChange,error:F.touched.value&&!!F.errors.value,helperText:F.touched.value&&F.errors.value}),e.jsxs($e,{children:[e.jsx(L,{onClick:z,color:"primary",children:"Cancel"}),e.jsx(L,{onClick:F.handleSubmit,color:"primary",children:"Save"})]})]})})]}),e.jsx(me,{})]})}it("div")(({theme:h,ownerState:a})=>({color:h.palette.mode==="dark"?h.palette.grey[700]:"#eaeaf0",display:"flex",height:22,alignItems:"center",...a.active&&{color:"#784af4"},"& .QontoStepIcon-completedIcon":{color:"#784af4",zIndex:1,fontSize:18},"& .QontoStepIcon-circle":{width:8,height:8,borderRadius:"50%",backgroundColor:"currentColor"}}));je.bool,je.string,je.bool;const u=["Fiscal Year","Planning Period","Frequency Period Value","Evaluation Period"];function ta(){var Me,Ve,Je,Re,Le,Ge,He,Ue,Qe,Xe,Ze,Ke,et,tt,at,st,rt;const h=xe(),[a,q]=l.useState(0),[B,m]=l.useState(!1),[s,Y]=l.useState({}),[w,U]=l.useState([]),[Q,R]=l.useState([]),[F,_]=l.useState(!1),[S,A]=l.useState(!1),[V,x]=l.useState([]),[z,C]=l.useState([]),[o,c]=l.useState(null),[y,P]=l.useState(null),[O,k]=l.useState([]),[M,W]=l.useState([!1,!1,!1]),[K,re]=l.useState(),[ae,D]=l.useState(""),[j,ee]=l.useState(null),H=async()=>{try{const r=localStorage.getItem("token"),t=await fetch(`${f.api+f.fiscal_years}`,{headers:{Authorization:`Bearer ${r}`,Accept:"application/json","Content-Type":"application/json"}}),i=await t.json();if(t.ok){const d=i.data.data.map(p=>({id:p.id,year:p.year}));re(d),d&&ce(d[0].id)}else n.error(i.message||"Failed to fetch fiscal year")}catch{n.error("An error occurred while fetching fiscal year")}},J=async r=>{try{const t=localStorage.getItem("token"),i=`${f.api}${f.get_frequency_definition}?fiscal_year_id=${r}`,d={Authorization:`Bearer ${t}`,Accept:"application/json","Content-Type":"application/json"},p=await fetch(i,{headers:d}),v=await p.json();if(p.ok&&v.success){const b=v.data.fiscalYear,N=v.data.periods;ee({...b,periods:N})}else n.error(v.message||"Failed to fetch fiscal year details")}catch{n.error("An error occurred while fetching fiscal year details")}},se=r=>{const t=r.target.value;D(t),J(t)},ce=r=>{D(r),J(r)};l.useEffect(()=>{H()},[]);const ye=r=>{R(t=>[...t,r])},ge=r=>{U(t=>[...t,{...r,type:"Planning Period"}])},ut=r=>{U(t=>[...t,{...r,type:"Frequency Period Value"}])},pt=r=>{U(t=>[...t,{...r,type:"Evaluation Period"}])},ht=()=>{q(0),m(!0)},ft=async()=>{if(mt()){const t=[...M];t[a]=!0,W(t),q(i=>Math.min(i+1,u.length-1))}else n.error("Please complete all required fields.");if(u[a]==="Fiscal Year"){const t=await We();if(!t)return;c(t)}if(!(u[a]==="Planning Period"&&!await Ne())){if(u[a]==="Frequency Period Value"){const t=await Oe();if(!t)return;P(t)}a<u.length-1&&(q(t=>t+1),m(!0))}},mt=()=>{var r,t,i,d,p,v,b,N,g,ne;switch(a){case 0:return((r=s["Fiscal Year"])==null?void 0:r.year)&&((t=s["Fiscal Year"])==null?void 0:t.startDate)&&((i=s["Fiscal Year"])==null?void 0:i.endDate);case 1:return((d=s["Planning Period"])==null?void 0:d.startDate)&&((p=s["Planning Period"])==null?void 0:p.endDate);case 2:return((v=s["Frequency Period Value"])==null?void 0:v.frequency)&&((N=(b=s["Frequency Period Value"])==null?void 0:b.dates)==null?void 0:N.every(te=>te.start_date&&te.end_date));case 3:return((g=s["Evaluation Period"])==null?void 0:g.startDate)&&((ne=s["Evaluation Period"])==null?void 0:ne.endDate);default:return!1}},xt=async()=>{const r=u.reduce((i,d)=>(d!=="Frequency"&&d!=="Fiscal Year"&&(i[d]=s[d]||""),i),{});u[a]==="Fiscal Year"&&R(i=>[...i,{year:s["Fiscal Year"].year}]),u[a]==="Frequency Period Value"&&s[u[a]]&&(r["Frequency Period Value"]={...s[u[a]],frequency:s[u[a]].frequencyName});const t=s[u[a]]||"";C(i=>[...i,{step:u[a],data:t}]),s["Fiscal Year"]&&(r["Fiscal Year"]=s["Fiscal Year"]),u[a]==="Evaluation Period"&&await Ye(),k(i=>{const d=[...i,r];return localStorage.setItem("savedData",JSON.stringify(d)),d}),Y({}),q(0),m(!1)},le=r=>{const{name:t,value:i,type:d}=r.target;Y(d==="number"?p=>({...p,[u[a]]:{...p[u[a]],[t]:Number(i)}}):p=>({...p,[u[a]]:{...p[u[a]],[t]:i}}))},Ye=async()=>{var N,g,ne,te;const r=localStorage.getItem("token"),t=`${f.api}${f.evaluation_periods}`,i={Authorization:`Bearer ${r}`,Accept:"application/json","Content-Type":"application/json"},d=((N=s["Evaluation Period"])==null?void 0:N.frequency_period_value_id)||((g=s["Frequency Period Value"])==null?void 0:g.frequency)||"";if(!d){A(oe=>({...oe,parent_id:"Parent ID is invalid or missing"})),n.error("Parent ID is invalid or missing.");return}const p=(ne=s["Evaluation Period"])==null?void 0:ne.startDate,v=(te=s["Evaluation Period"])==null?void 0:te.endDate;if(!p||!v){A(oe=>({...oe,start_date:"Start date is required",end_date:"End date is required"})),n.error("Start date and End date are required.");return}const b={fiscal_year_id:(o==null?void 0:o.id)||"",dates:[{parent_id:d,start_date:p,end_date:v}]};try{_(!0),A({});const oe=await fetch(t,{method:"POST",headers:i,body:JSON.stringify(b)}),pe=await oe.json();if(oe.ok)return n.success("Evaluation period created successfully"),pt(pe.data),pe.data;n.error(`Evaluation period submission failed: ${pe.message}`),A(pe.data.errors||{})}catch{n.error("An error occurred while submitting evaluation period")}finally{_(!1)}},Oe=async()=>{var p,v,b;const r=localStorage.getItem("token"),t=`${f.api}${f.frequency_period_values}`,i={Authorization:`Bearer ${r}`,Accept:"application/json","Content-Type":"application/json"},d={frequency_id:((p=s["Frequency Period Value"])==null?void 0:p.frequency)||"",fiscal_year_id:((v=s["Frequency Period Value"])==null?void 0:v.fiscal_year_id)||(o==null?void 0:o.id)||"",dates:((b=s["Frequency Period Value"])==null?void 0:b.dates)||[]};if(d.dates.length===0||d.dates.some(N=>!N.start_date||!N.end_date)){n.error("Please fill in all start and end dates.");return}try{_(!0),A({});const g=await(await fetch(t,{method:"POST",headers:i,body:JSON.stringify(d)})).json();if(g.success)return n.success("Frequency period value created successfully"),ut(g.data),g.data;if(g.status===422){const{message:ne,errors:te}=g.data;te&&te.frequency_id?n.error(te.frequency_id[0]||"Frequency ID error"):n.error(ne||"Frequency period value submission failed"),A(te||{})}else n.error(`Frequency period value submission failed: ${g.message}`)}catch{n.error("An error occurred while submitting the frequency period value")}finally{_(!1)}},We=async()=>{var p,v,b;const r=localStorage.getItem("token"),t=`${f.api}${f.fiscal_years}`,i={Authorization:`Bearer ${r}`,Accept:"application/json","Content-Type":"application/json"},d={year:((p=s["Fiscal Year"])==null?void 0:p.year)||"",start_date:((v=s["Fiscal Year"])==null?void 0:v.startDate)||"",end_date:((b=s["Fiscal Year"])==null?void 0:b.endDate)||""};try{_(!0),A({});const g=await(await fetch(t,{method:"POST",headers:i,body:JSON.stringify(d)})).json();if(g.success)return n.success("Fiscal year created successfully"),ye(g.data),g.data;n.error(`Fiscal year submission failed: ${g.message}`),g.data.message.includes("The end date must be at least 360 days after the start date")?(n.error("The end date must be at least 360 days after the start date."),A({end_date:[g.data.message]})):A(g.data.errors||{})}catch{n.error("An error occurred while submitting fiscal year")}finally{_(!1)}},Ne=async()=>{var p,v,b;const r=localStorage.getItem("token"),t=`${f.api}${f.planning_periods}`,i={Authorization:`Bearer ${r}`,Accept:"application/json","Content-Type":"application/json"},d={fiscal_year_id:o==null?void 0:o.id,start_date:((p=s["Planning Period"])==null?void 0:p.startDate)||"",end_date:((v=s["Planning Period"])==null?void 0:v.endDate)||""};try{_(!0),A({});const g=await(await fetch(t,{method:"POST",headers:i,body:JSON.stringify(d)})).json();if(g.success)return n.success("Planning period created successfully"),ge(g.data),g.data;n.error(`Planning period submission failed: ${g.message}`),g.status===422&&((b=g.data)==null?void 0:b.message)==="Start and End dates must be within the fiscal year range."?(A({start_date:["Start date must be within the fiscal year range."],end_date:["End date must be within the fiscal year range."]}),n.error("Start and End dates must be within the fiscal year range.")):A(g.data.errors||{})}catch{n.error("An error occurred while submitting the planning period.")}finally{_(!1)}},yt=async()=>{const r=await Z(),t=f.api+"frequencies",i={Authorization:`Bearer ${r}`,Accept:"application/json","Content-Type":"application/json"};try{_(!0),A({});const p=await(await fetch(t,{method:"GET",headers:i})).json();p.success?x(p.data.data):(n.error(`Failed to fetch frequencies: ${p.message}`),A(p.errors||{}))}catch{n.error("An error occurred while fetching frequencies")}finally{_(!1)}};l.useEffect(()=>{yt()},[]),l.useEffect(()=>{const r=localStorage.getItem("savedData");r&&k(JSON.parse(r))},[]);const de=async r=>{r.preventDefault(),u[a]==="Fiscal Year"?await We():u[a]==="Planning Period"?await Ne():u[a]==="Frequency Period Value"?await Oe():u[a]==="Evaluation Period"&&await Ye()},gt=r=>{const t=r.target.value,i=V.find(b=>b.id===t),d=(i==null?void 0:i.name)||"",p=(i==null?void 0:i.value)||1,v=Array.from({length:p},()=>({start_date:"",end_date:""}));Y(b=>({...b,[u[a]]:{...b[u[a]]||{},frequency:t,frequencyName:d,dates:v}}))},ue=(r,t,i)=>{const{value:d}=r.target;Y(p=>{const v=p[u[a]]||{dates:[]},b=[...v.dates];return b[t]||(b[t]={start_date:"",end_date:""}),i==="start_date"?b[t].start_date=d:i==="end_date"&&(b[t].end_date=d),{...p,[u[a]]:{...v,dates:b}}})},ze=()=>{m(!1)},jt=()=>{q(r=>r-1)};return e.jsxs(ot,{sx:{width:"100%"},spacing:4,children:[e.jsx(fe,{open:B,onClose:ze,children:e.jsxs($t,{sx:{minWidth:"600px",minHeight:"50dvh",display:"flex",flexDirection:"column",justifyContent:"space-between",padding:2.4},children:[e.jsxs(E,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingRight:1},children:[e.jsx(T,{variant:"h3",color:h.palette.text.primary,children:u[a]}),e.jsx(Bt.div,{whileHover:{rotate:90},transition:{duration:.3},style:{cursor:"pointer"},onClick:ze,children:e.jsx(Yt,{size:"1.3rem",stroke:2})})]}),u[a]==="Fiscal Year"?e.jsx(e.Fragment,{children:e.jsxs("form",{onSubmit:de,children:[e.jsx(I,{name:"year",label:"Year",value:((Me=s[u[a]])==null?void 0:Me.year)||"",onChange:le,fullWidth:!0,margin:"normal",error:!!S.year}),e.jsx(I,{name:"startDate",label:"Start Date",type:"date",InputLabelProps:{shrink:!0},value:((Ve=s[u[a]])==null?void 0:Ve.startDate)||"",onChange:le,fullWidth:!0,margin:"normal",error:!!S.start_date}),e.jsx(I,{name:"endDate",label:"End Date",type:"date",InputLabelProps:{shrink:!0},value:((Je=s[u[a]])==null?void 0:Je.endDate)||"",onChange:le,fullWidth:!0,margin:"normal",error:!!S.end_date})]})}):u[a]==="Planning Period"?e.jsxs("form",{onSubmit:de,children:[e.jsx(I,{name:"fiscal_year_id",label:"Fiscal Year",value:((Re=s["Fiscal Year"])==null?void 0:Re.year)||"",InputProps:{readOnly:!0},fullWidth:!0,margin:"normal"}),e.jsx(I,{name:"startDate",label:"Start Date",type:"date",InputLabelProps:{shrink:!0},value:((Le=s[u[a]])==null?void 0:Le.startDate)||"",onChange:le,fullWidth:!0,margin:"normal",error:!!S.start_date,helperText:(Ge=S.start_date)==null?void 0:Ge.join(", ")}),e.jsx(I,{name:"endDate",label:"End Date",type:"date",InputLabelProps:{shrink:!0},value:((He=s[u[a]])==null?void 0:He.endDate)||"",onChange:le,fullWidth:!0,margin:"normal",error:!!S.end_date,helperText:(Ue=S.end_date)==null?void 0:Ue.join(", ")})]}):u[a]==="Frequency Period Value"?e.jsx(e.Fragment,{children:e.jsx(E,{sx:{mb:0,maxHeight:"50vh",overflowY:"auto"},children:e.jsxs("form",{onSubmit:de,children:[e.jsx(I,{name:"fiscal_year_id",label:"Fiscal Year",value:((Qe=s["Fiscal Year"])==null?void 0:Qe.year)||"",InputProps:{readOnly:!0},fullWidth:!0,margin:"normal"}),e.jsxs(Ot,{fullWidth:!0,margin:"normal",sx:{mb:2},children:[e.jsx(lt,{id:"frequency-label",children:"Select Frequency"}),e.jsx(ve,{name:"frequency",value:((Xe=s[u[a]])==null?void 0:Xe.frequency)||"",onChange:gt,fullWidth:!0,margin:"normal",label:"Select Frequency",sx:{mb:2},children:V.map(r=>e.jsx(G,{value:r.id,children:r.name},r.id))})]}),(Ke=(Ze=s[u[a]])==null?void 0:Ze.dates)==null?void 0:Ke.map((r,t)=>{var i;return e.jsxs($,{container:!0,spacing:2,sx:{mb:2,maxHeight:"80vh",overflowY:"auto"},children:[e.jsx($,{item:!0,xs:6,children:e.jsx(I,{name:`start_date_${t}`,label:`Start Date ${t+1}`,type:"date",fullWidth:!0,InputLabelProps:{shrink:!0},value:r.start_date||"",onChange:d=>ue(d,t,"start_date")})}),e.jsx($,{item:!0,xs:6,children:e.jsx(I,{name:`end_date_${t}`,label:`End Date ${t+1}`,type:"date",fullWidth:!0,InputLabelProps:{shrink:!0},value:r.end_date||"",onChange:d=>ue(d,t,"end_date"),error:!!S.end_date,helperText:(i=S.end_date)==null?void 0:i.join(", ")})})]},t)})]})})}):u[a]==="Evaluation Period"?e.jsx(e.Fragment,{children:e.jsx(E,{sx:{mb:0,maxHeight:"50vh",overflowY:"auto",p:2},children:e.jsxs("form",{onSubmit:de,children:[e.jsxs(be,{variant:"outlined",sx:{p:2,mb:3,backgroundColor:"#f5f5f5",borderRadius:"8px"},children:[e.jsx(T,{variant:"h6",sx:{mb:2,fontWeight:"bold"},children:"Fiscal Year Details"}),e.jsx(I,{name:"fiscal_year_id",label:"Fiscal Year",value:((et=s["Fiscal Year"])==null?void 0:et.year)||"",InputProps:{readOnly:!0},fullWidth:!0,margin:"normal",sx:{mb:2}}),e.jsx(I,{name:"frequency_name",label:"Frequency",value:((tt=V.find(r=>{var t,i;return r.id===(((t=s[u[a]])==null?void 0:t.frequency_period_value_id)||((i=s["Frequency Period Value"])==null?void 0:i.frequency))}))==null?void 0:tt.name)||"",InputProps:{readOnly:!0},fullWidth:!0,margin:"normal",error:!!S.frequency_period_value_id,helperText:(at=S.frequency_period_value_id)==null?void 0:at.join(", "),sx:{mb:2}})]}),(rt=(st=s["Frequency Period Value"])==null?void 0:st.dates)==null?void 0:rt.map((r,t)=>{var i,d,p,v,b,N;return e.jsxs(be,{variant:"outlined",sx:{p:2,mb:3,backgroundColor:"#fafafa",boxShadow:"0 4px 8px rgba(0,0,0,0.1)",borderRadius:"8px"},children:[e.jsxs(T,{variant:"h6",sx:{mb:2,fontWeight:"bold"},children:["Period ",t+1]}),e.jsxs($,{container:!0,spacing:2,sx:{mb:2},children:[e.jsx($,{item:!0,xs:6,children:e.jsx(I,{name:`frequency_start_date_${t}`,label:"Frequency Start Date",type:"date",fullWidth:!0,InputLabelProps:{shrink:!0},value:r.start_date||"",InputProps:{readOnly:!0,sx:{backgroundColor:"#e3f2fd",borderRadius:"6px",padding:"10px","&:hover":{boxShadow:"0 4px 8px rgba(0, 0, 0, 0.2)"}}}})}),e.jsx($,{item:!0,xs:6,children:e.jsx(I,{name:`frequency_end_date_${t}`,label:"Frequency End Date",type:"date",fullWidth:!0,InputLabelProps:{shrink:!0},value:r.end_date||"",InputProps:{readOnly:!0,sx:{backgroundColor:"#e3f2fd",borderRadius:"6px",padding:"10px","&:hover":{boxShadow:"0 4px 8px rgba(0, 0, 0, 0.2)"}}}})})]}),e.jsxs($,{container:!0,spacing:2,children:[e.jsx($,{item:!0,xs:6,children:e.jsx(I,{name:`evaluation_start_date_${t}`,label:"Evaluation Start Date",type:"date",fullWidth:!0,InputLabelProps:{shrink:!0},value:((p=(d=(i=s[u[a]])==null?void 0:i.evaluation_dates)==null?void 0:d[t])==null?void 0:p.start_date)||"",onChange:g=>ue(g,t,"start_date"),error:!!S.start_date,helperText:Array.isArray(S.start_date)?S.start_date.join(", "):S.start_date,sx:{backgroundColor:"#fffde7",borderRadius:"6px",padding:"10px","&:hover":{boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)"}}})}),e.jsx($,{item:!0,xs:6,children:e.jsx(I,{name:`evaluation_end_date_${t}`,label:"Evaluation End Date",type:"date",fullWidth:!0,InputLabelProps:{shrink:!0},value:((N=(b=(v=s[u[a]])==null?void 0:v.evaluation_dates)==null?void 0:b[t])==null?void 0:N.end_date)||"",onChange:g=>ue(g,t,"end_date"),sx:{backgroundColor:"#fffde7",borderRadius:"6px",padding:"10px","&:hover":{boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)"}}})})]})]},t)})]})})}):null,e.jsxs(ot,{direction:"row",spacing:2,sx:{mt:2},children:[a>0&&e.jsx(L,{variant:"contained",color:"inherit",onClick:jt,children:"Back"}),a<u.length-1&&e.jsx(L,{variant:"contained",color:"primary",type:"submit",onClick:ft,children:"Next"}),a===u.length-1&&e.jsx(L,{variant:"contained",color:"primary",onClick:xt,children:"Save"})]})]})}),e.jsx(be,{sx:{borderRadius:2,background:"linear-gradient(135deg, #f3f4f6, #f0f0f0)"},children:e.jsxs(Pe,{children:[e.jsxs(E,{mb:3,sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(ve,{value:ae,onChange:se,displayEmpty:!0,variant:"outlined",sx:{backgroundColor:"white",boxShadow:1,borderRadius:1},children:[e.jsx(G,{value:"",disabled:!0,children:"Select Fiscal Year"}),K&&Array.isArray(K)&&K.length>0?K.map(r=>e.jsx(G,{value:r.id,children:r.year},r.id)):e.jsx(G,{disabled:!0,children:"No Fiscal Years Available"})]}),e.jsx(dt,{title:"Create Period",variant:"contained",onPress:()=>ht()})]}),j&&e.jsxs(E,{children:[e.jsxs(E,{display:"flex",flexDirection:"column",mb:3,p:2,sx:{backgroundColor:"#ffffff",borderRadius:2,boxShadow:2},children:[e.jsxs(T,{variant:"h4",marginBottom:1,marginTop:1,color:"primary",fontWeight:"bold",children:["Fiscal Year ",j.year]}),e.jsxs(T,{variant:"body1",color:"textSecondary",children:[e.jsx("strong",{children:"Start Date:"})," ",j.start_date]}),e.jsxs(T,{variant:"body1",color:"textSecondary",children:[e.jsx("strong",{children:"End Date:"})," ",j.end_date]})]}),e.jsx(Wt,{sx:{marginBottom:3}}),j.periods&&Array.isArray(j.periods)&&j.periods.length>0?j.periods.map(r=>e.jsxs(E,{display:"flex",flexDirection:"column",mb:2,p:2,sx:{backgroundColor:"#fafafa",borderRadius:2,boxShadow:1},children:[e.jsx(T,{variant:"h6",color:"primary",fontWeight:"bold",children:r.type}),e.jsxs(T,{variant:"body1",color:"textSecondary",children:[e.jsx("strong",{children:"Start Date:"})," ",r.start_date]}),e.jsxs(T,{variant:"body1",color:"textSecondary",children:[e.jsx("strong",{children:"End Date:"})," ",r.end_date]})]},r.id)):e.jsx(T,{variant:"body1",color:"textSecondary",children:"No periods available for this fiscal year."})]})]})})]})}var Be={},aa=zt;Object.defineProperty(Be,"__esModule",{value:!0});var Se=Be.default=void 0,sa=aa(Nt()),ra=e;Se=Be.default=(0,sa.default)((0,ra.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");function ia(){const h=xe(),[a,q]=ct.useState(0),B=s=>{q(s===a?0:s)},m=[{id:1,name:"Frequencies",component:e.jsx(ea,{})},{id:2,name:"Periods",component:e.jsx(ta,{})},{id:4,name:"Perspectives",component:e.jsx(Qt,{})},{id:6,name:"Performance Rating",component:e.jsx(Zt,{})},{id:7,name:"Job Positions",component:e.jsx(Kt,{})}];return e.jsx(Mt,{maxWidth:"lg",title:"Pre-setups",children:e.jsx($,{container:!0,spacing:3,mt:1,sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx($,{item:!0,xs:10,children:e.jsx($,{container:!0,spacing:1,children:m.map((s,Y)=>e.jsxs($,{item:!0,xs:12,expanded:a===s.id,sx:{backgroundColor:h.palette.background.default},children:[e.jsxs(E,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",backgroundColor:a===s.id?h.palette.primary.main:h.palette.grey[100],paddingY:2,paddingX:2.6,borderRadius:2,transition:"all 0.4s ease"},onClick:()=>B(s.id),children:[e.jsx(T,{variant:"h4",color:a===s.id?"white":h.palette.text.primary,sx:{fontWeight:"bold"},children:s.name}),e.jsx(he,{onClick:()=>B(s.id),children:a===s.id?e.jsx(Se,{style:{color:"white"}}):e.jsx(Se,{})})]}),a===s.id&&e.jsx(Ut,{children:s.component})]},Y))})})})})}export{ia as default};
