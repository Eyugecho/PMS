import{M as Y,N as P,P as x,l as N,O as Z,r as n,j as e,_ as ee,m as se,$ as re,I as U,a0 as ae,a1 as te,U as B,V as W,W as q,X as z,a4 as ie,Y as g,Z as oe,R as O,q as le,t as ne,v as V,w as D,x as m,y as r,z as K,b as de,aL as ce,aM as ue,aj as he,f as xe,B as k,h as M}from"./index-DL-CLDEe.js";import{K as je,a as be}from"./KeyboardArrowUp-C1VMsA8Z.js";const me=Y().shape({actual_value:P().required("Evaluation value is required"),description:P()}),X=({add:j,isAdding:v,unitName:f,currentValue:c,onClose:i,handleSubmission:d})=>{const b=N(),t=Z({initialValues:{actual_value:"",description:""},validationSchema:me,onSubmit:u=>{d(u)}});return n.useEffect(()=>{c&&t.setValues({actual_value:c>0?c:""})},[c]),e.jsx(n.Fragment,{children:e.jsxs(ee,{open:j,onClose:i,children:[e.jsxs(se,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingRight:2,backgroundColor:b.palette.grey[50]},children:[e.jsx(re,{variant:"h4",color:b.palette.text.primary,children:f&&f+" Evaluation"}),e.jsx(U,{onClick:i,children:e.jsx(ae,{size:20})})]}),e.jsxs("form",{noValidate:!0,onSubmit:t.handleSubmit,children:[e.jsxs(te,{children:[e.jsxs(B,{fullWidth:!0,error:t.touched.actual_value&&!!t.errors.actual_value,sx:{marginTop:1},children:[e.jsx(W,{htmlFor:"actual_value",children:"Actual Value"}),e.jsx(q,{id:"actual_value",name:"actual_value",label:"Actual Value",value:t.values.actual_value,onChange:t.handleChange,fullWidth:!0}),t.touched.actual_value&&t.errors.actual_value&&e.jsx(z,{error:!0,id:"standard-weight-helper-text-actual_value",children:t.errors.actual_value})]}),e.jsxs(B,{fullWidth:!0,error:t.touched.description&&!!t.errors.description,sx:{marginTop:3},children:[e.jsx(W,{htmlFor:"description",children:"Remark (optional)"}),e.jsx(q,{id:"description",name:"description",label:"Remark (optional)",value:t.values.description,onChange:t.handleChange,fullWidth:!0,multiline:!0,rows:4}),t.touched.description&&t.errors.description&&e.jsx(z,{error:!0,id:"standard-weight-helper-text-description",children:t.errors.description})]})]}),e.jsxs(ie,{sx:{paddingX:2},children:[e.jsx(g,{onClick:i,sx:{marginLeft:10},children:"Cancel"}),e.jsx(g,{type:"submit",variant:"contained",sx:{paddingX:6,boxShadow:0,borderRadius:2},disabled:v,children:v?e.jsx(oe,{size:18,sx:{color:"white"}}):"Submit"})]})]})]})})};X.propTypes={add:x.bool,isAdding:x.bool,unitName:x.string,currentValue:x.number,onClose:x.func,handleSubmission:x.func};const fe=({plans:j,unitName:v,unitType:f,onRefresh:c})=>{const i=N(),[d,b]=n.useState(null),[t,u]=n.useState(null),[y,$]=n.useState(null),[H,T]=n.useState(!1),[L,p]=n.useState(!1),[G,S]=n.useState("0"),w=s=>{d===s?(b(null),u(null)):(b(s),u(null))},J=s=>{u(t===s?null:s)},A=(s,o,h)=>{J(s),$(s),S(h==="update"?o:"0"),T(!0)},Q=async s=>{p(!0);const o=await xe(),h=M.api+M.evaluate,C={Authorization:`Bearer ${o}`,accept:"application/json","Content-Type":"application/json"},_={target_setting_id:y,actual_value:s==null?void 0:s.actual_value,description:s==null?void 0:s.description};fetch(h,{method:"POST",headers:C,body:JSON.stringify(_)}).then(l=>l.json()).then(l=>{l.success?(p(!1),R(),k.success(l.data.message),c()):(p(!1),k.error(l.data.message))}).catch(l=>{k.error(l.message),p(!1)})},R=()=>{T(!1)};return e.jsxs(O.Fragment,{children:[e.jsx(le,{component:ne,sx:{minHeight:"22dvh"},children:e.jsxs(V,{sx:{minWidth:450},"aria-label":"unit plan table",children:[e.jsx(D,{children:e.jsxs(m,{children:[e.jsx(r,{children:"KPI Name"}),e.jsx(r,{children:"Inherited Weights(%)"}),e.jsx(r,{children:"KPI Weights(%)"}),e.jsx(r,{children:"Total Targets"}),e.jsx(r,{children:"Measuring Unit"}),e.jsx(r,{children:"Frequency"}),e.jsx(r,{children:"Action"})]})}),e.jsx(K,{children:j==null?void 0:j.map((s,o)=>{var h,C,_,l,F;return e.jsxs(O.Fragment,{children:[e.jsxs(m,{sx:{backgroundColor:d==o?i.palette.grey[50]:i.palette.background.default,":hover":{backgroundColor:i.palette.grey[50],color:i.palette.background.default,cursor:"pointer",borderRadius:2}},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",border:0},children:[e.jsx(U,{"aria-label":"expand row",size:"small",onClick:()=>w(o),children:d===o?e.jsx(je,{}):e.jsx(be,{})}),e.jsx(de,{variant:"subtitle1",color:i.palette.text.primary,children:(h=s==null?void 0:s.kpi)==null?void 0:h.name})]}),e.jsxs(r,{sx:{border:0},children:[s!=null&&s.inherit_weight?parseFloat(s==null?void 0:s.inherit_weight).toFixed(1)+"%":"N/A"," "]}),e.jsxs(r,{sx:{border:0},children:[parseFloat(s==null?void 0:s.weight).toFixed(1),"%"]}),e.jsx(r,{sx:{border:0},children:s==null?void 0:s.total_target}),e.jsx(r,{sx:{border:0},children:(_=(C=s==null?void 0:s.kpi)==null?void 0:C.measuring_unit)==null?void 0:_.name}),e.jsx(r,{sx:{border:0},children:(l=s==null?void 0:s.frequency)==null?void 0:l.name}),e.jsx(r,{sx:{border:0},children:e.jsx(g,{variant:"outlined",onClick:()=>w(o),children:"Targets"})})]}),d==o&&e.jsx(m,{children:e.jsx(r,{colSpan:7,children:e.jsx(ce,{in:d!==null,timeout:"auto",unmountOnExit:!0,children:e.jsxs(V,{sx:{minWidth:650},"aria-label":"Organization plan table",children:[e.jsx(D,{children:e.jsxs(m,{children:[e.jsx(r,{children:"Periods"}),e.jsx(r,{children:"Targets"}),e.jsx(r,{children:"Actuals"}),(s==null?void 0:s.target.some(a=>a.can_be_evaluate===!0))&&e.jsx(r,{children:"Action"})]})}),e.jsx(K,{children:(F=s==null?void 0:s.target)==null?void 0:F.map((a,E)=>{var I;return e.jsxs(m,{sx:t==a.id?{backgroundColor:i.palette.grey[100],":hover":{backgroundColor:i.palette.grey[100],color:i.palette.background.default,cursor:"pointer",borderRadius:2}}:{backgroundColor:i.palette.primary.light,":hover":{backgroundColor:i.palette.grey[100],color:i.palette.background.default,cursor:"pointer",borderRadius:2}},children:[e.jsx(r,{sx:{border:0},children:ue((I=s==null?void 0:s.frequency)==null?void 0:I.name)+" "+(E+1)}),e.jsx(r,{sx:{border:0},children:a==null?void 0:a.target}),e.jsx(r,{sx:{border:0},children:a==null?void 0:a.actual_value}),(a==null?void 0:a.can_be_evaluate)&&((a==null?void 0:a.actual_value)==0?e.jsx(r,{sx:{border:0},children:e.jsx(g,{variant:"contained",sx:{boxShadow:0},onClick:()=>A(a.id,0,"evaluate"),children:"Evaluate"})}):e.jsx(r,{sx:{border:0},children:e.jsx(g,{variant:"text",sx:{boxShadow:0},onClick:()=>A(a.id,a==null?void 0:a.actual_value,"update"),children:"Update Evaluation"})}))]},E)})})]})})})})]},o)})})]})}),y&&e.jsx(X,{add:H,unitName:v,unitType:f,isAdding:L,currentValue:G,onClose:R,handleSubmission:s=>Q(s)}),e.jsx(he,{})]})};export{fe as P};
