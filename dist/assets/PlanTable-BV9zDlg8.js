import{a as N,b as F,i as V,u as J,j as e,r as d,B as Q,I as $,d as Y,F as I,e as B,O as P,f as D,h as j,C as G,R as Z,m as ee,T as O,a9 as re,Q as ae,n as k,o as W}from"./index-CsFgNO3o.js";import{P as se}from"./index-DK6LBEOt.js";import{D as te,a as oe,b as ie,c as le}from"./DialogTitle-D1Q0RY_x.js";import{T as ne}from"./TableContainer-qijX9D2r.js";import{T as z,a as q,b as x,c as K}from"./TableRow-CVrgL676.js";import{T as a}from"./TableCell-F9dx6MLR.js";import{K as ce,a as de}from"./KeyboardArrowUp-eGxCS8hM.js";const ue=N().shape({actual_value:F().required("Evaluation value is required"),description:F()}),he=({add:u,isAdding:m,unitName:b,unitType:C,onClose:t,handleSubmission:n})=>{const h=V(),s=J({initialValues:{actual_value:"",description:""},validationSchema:ue,onSubmit:c=>{n(c)}});return e.jsx(d.Fragment,{children:e.jsxs(te,{open:u,onClose:t,children:[e.jsxs(Q,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingRight:2,backgroundColor:h.palette.primary.main},children:[e.jsx(oe,{variant:"h4",color:h.palette.background.default,children:b?`${b}`:"Evaluation"}),e.jsx($,{onClick:t,children:e.jsx(Y,{size:20,color:"white"})})]}),e.jsxs("form",{noValidate:!0,onSubmit:s.handleSubmit,children:[e.jsxs(ie,{children:[e.jsxs(I,{fullWidth:!0,error:s.touched.actual_value&&!!s.errors.actual_value,sx:{marginTop:1},children:[e.jsx(B,{htmlfor:"actual_value",children:"Actual Value"}),e.jsx(P,{id:"actual_value",name:"actual_value",label:"Actual Value",value:s.values.actual_value,onChange:s.handleChange,fullWidth:!0}),s.touched.actual_value&&s.errors.actual_value&&e.jsx(D,{error:!0,id:"standard-weight-helper-text-actual_value",children:s.errors.actual_value})]}),e.jsxs(I,{fullWidth:!0,error:s.touched.description&&!!s.errors.description,sx:{marginTop:3},children:[e.jsx(B,{htmlfor:"description",children:"Remark (optional)"}),e.jsx(P,{id:"description",name:"description",label:"Remark (optional)",value:s.values.description,onChange:s.handleChange,fullWidth:!0,multiline:!0,rows:4}),s.touched.description&&s.errors.description&&e.jsx(D,{error:!0,id:"standard-weight-helper-text-description",children:s.errors.description})]})]}),e.jsxs(le,{sx:{paddingX:2},children:[e.jsx(j,{onClick:t,sx:{marginLeft:10},children:"Cancel"}),e.jsx(j,{type:"submit",variant:"contained",sx:{paddingX:6,boxShadow:0},disabled:m,children:m?e.jsx(G,{size:18,sx:{color:"white"}}):"Done"})]})]})]})})},ve=({plans:u,unitName:m,unitType:b,page:C})=>{const t=V(),[n,h]=d.useState(null),[s,c]=d.useState(null),[T,H]=d.useState(null),[L,y]=d.useState(!1),[M,g]=d.useState(!1),_=r=>{n===r?(h(null),c(null)):(h(r),c(null))},U=r=>{c(s===r?null:r)},S=r=>{U(r),H(r),y(!0)},X=r=>{g(!0);const l=localStorage.getItem("token"),p=W.api+W.evaluate,f={Authorization:`Bearer ${l}`,accept:"application/json","Content-Type":"application/json"},v={target_setting_id:T,actual_value:r==null?void 0:r.actual_value,description:r==null?void 0:r.description};fetch(p,{method:"POST",headers:f,body:JSON.stringify(v)}).then(i=>i.json()).then(i=>{i.success?(g(!1),w(),k.success(i.data.message)):(g(!1),k.error(i.message))}).catch(i=>{k.error(i.message),g(!1)})},w=()=>{y(!1)};return e.jsxs(Z.Fragment,{children:[e.jsx(ne,{component:ee,sx:{minHeight:"64dvh",border:.4,borderColor:t.palette.grey[300],borderRadius:2},children:e.jsxs(z,{sx:{minWidth:650},"aria-label":"Organization plan table",children:[e.jsx(q,{children:e.jsxs(x,{children:[e.jsx(a,{children:"Fiscal Year"}),e.jsx(a,{children:"KPI Name"}),e.jsx(a,{children:"KPI Weights(%)"}),e.jsx(a,{children:"Total Targets"}),e.jsx(a,{children:"Measuring Unit"}),e.jsx(a,{children:"Frequency"}),e.jsx(a,{children:"Action"})]})}),e.jsx(K,{children:u==null?void 0:u.map((r,l)=>{var p,f,v,i,R;return e.jsxs(e.Fragment,{children:[e.jsxs(x,{sx:{backgroundColor:n==l?t.palette.primary[200]:t.palette.background.default,":hover":{backgroundColor:t.palette.primary[200],color:t.palette.background.default,cursor:"pointer",borderRadius:2}},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",border:0},children:[e.jsx($,{"aria-label":"expand row",size:"small",onClick:()=>_(l),children:n===l?e.jsx(ce,{}):e.jsx(de,{})}),e.jsx(O,{variant:"body2",sx:{marginLeft:2},children:r==null?void 0:r.fiscal_year.year})]}),e.jsx(a,{sx:{border:0},children:e.jsx(O,{variant:"subtitle1",children:(p=r==null?void 0:r.kpi)==null?void 0:p.name})}),e.jsx(a,{sx:{border:0},children:parseFloat(r==null?void 0:r.weight).toFixed(2)}),e.jsx(a,{sx:{border:0},children:r==null?void 0:r.total_target}),e.jsx(a,{sx:{border:0},children:(v=(f=r==null?void 0:r.kpi)==null?void 0:f.measuring_unit)==null?void 0:v.name}),e.jsx(a,{sx:{border:0},children:(i=r==null?void 0:r.frequency)==null?void 0:i.name}),e.jsx(a,{sx:{border:0},children:e.jsx(j,{variant:"outlined",onClick:()=>_(l),children:"Targets"})})]},l),n==l&&e.jsx(x,{children:e.jsx(a,{colSpan:7,children:e.jsx(re,{in:n!==null,timeout:"auto",unmountOnExit:!0,children:e.jsxs(z,{sx:{minWidth:650},"aria-label":"Organization plan table",children:[e.jsx(q,{children:e.jsxs(x,{children:[e.jsx(a,{children:"Periods"}),e.jsx(a,{children:"Targets"}),e.jsx(a,{children:"Actuals"}),C==="evaluation"&&e.jsx(a,{children:"Action"})]})}),e.jsx(K,{children:(R=r==null?void 0:r.target)==null?void 0:R.map((o,A)=>{var E;return e.jsxs(x,{sx:s==o.id?{backgroundColor:t.palette.grey[100],":hover":{backgroundColor:t.palette.grey[100],color:t.palette.background.default,cursor:"pointer",borderRadius:2}}:{backgroundColor:t.palette.primary.light,":hover":{backgroundColor:t.palette.grey[100],color:t.palette.background.default,cursor:"pointer",borderRadius:2}},children:[e.jsx(a,{sx:{border:0},children:se((E=r==null?void 0:r.frequency)==null?void 0:E.name)+" "+(A+1)}),e.jsx(a,{sx:{border:0},children:o==null?void 0:o.target}),e.jsx(a,{sx:{border:0},children:o==null?void 0:o.actual_value}),C==="evaluation"&&((o==null?void 0:o.actual_value)==0?e.jsx(a,{sx:{border:0},children:e.jsx(j,{variant:"contained",sx:{boxShadow:0},onClick:()=>S(o.id),children:"Evaluate"})}):e.jsx(a,{sx:{border:0},children:e.jsx(j,{variant:"text",sx:{boxShadow:0},onClick:()=>S(o.id),children:"Update Evaluation"})}))]},A)})})]})})})})]})})})]})}),T&&e.jsx(he,{add:L,unitName:m,unitType:b,isAdding:M,onClose:w,handleSubmission:r=>X(r)}),e.jsx(ae,{})]})};export{ve as P};
