import{al as se,am as ne,j as e,aT as re,a7 as ie,aU as oe,r as j,Y as A,a3 as le,l as q,ar as z,u as R,m as v,G as w,d as L,av as U,v as Y,w as G,x as $,y as I,z as V,aj as B,f as M,h as _,B as F,C as ce,T as X,an as O,t as H,b as E,aJ as de,I as ue,E as he,aV as ge,at as J,Z as Q,aM as xe,_ as me,$ as fe,as as je,a0 as pe,a4 as be,ay as ye}from"./index-DL-CLDEe.js";import{n as Z}from"./no_result-CfkzRtwQ.js";import{A as ve}from"./Autocomplete-D8TvuXv2.js";import{A as Ie}from"./Alert-B6r8ITbi.js";var W={},Pe=ne;Object.defineProperty(W,"__esModule",{value:!0});var k=W.default=void 0,Se=Pe(se()),Te=e;k=W.default=(0,Se.default)((0,Te.jsx)("path",{d:"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"}),"KeyboardArrowDown");const Ce=re(n=>e.jsx(ie,{elevation:0,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},...n}))(({theme:n})=>({"& .MuiPaper-root":{borderRadius:6,marginTop:n.spacing(1),minWidth:180,color:n.palette.mode==="light"?"rgb(55, 65, 81)":n.palette.grey[300],boxShadow:"rgb(255, 255, 255) 0px 0px 0px 0px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgba(0, 0, 0, 0.1) 0px 10px 15px -3px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px","& .MuiMenu-list":{padding:"4px 0"},"& .MuiMenuItem-root":{"& .MuiSvgIcon-root":{fontSize:18,color:n.palette.text.secondary,marginRight:n.spacing(1.5)},"&:active":{backgroundColor:oe(n.palette.primary.main,n.palette.action.selectedOpacity)}}}}));function we({menu:n,selected:t,onSelect:r}){const[o,s]=j.useState(null),d=!!o,P=l=>{s(l.currentTarget)},m=()=>{s(null)},b=l=>{r(l),m()};return e.jsxs("div",{children:[e.jsx(A,{id:"demo-customized-button","aria-controls":d?"demo-customized-menu":void 0,"aria-haspopup":"true","aria-expanded":d?"true":void 0,variant:"contained",disableElevation:!0,onClick:P,endIcon:e.jsx(k,{}),children:t||"Select frequency"}),e.jsx(Ce,{id:"demo-customized-menu",MenuListProps:{"aria-labelledby":"demo-customized-button"},anchorEl:o,open:d,onClose:m,children:n==null?void 0:n.map((l,p)=>e.jsx(le,{disableRipple:!0,onClick:()=>b(l),children:l.name},l.id))})]})}const ee=()=>{const n=q(),{selectedKpi:t,updateKPI:r}=z(),[o,s]=j.useState(!0),[d,P]=j.useState([]),[m,b]=j.useState(!1),l=R(h=>h.customization.selectedFiscalYear),p=(h,i)=>{r(i,{frequency_id:h.id,f_name:h.name,f_value:h.value})},C=h=>{const i=h.find(u=>u.value==4);i&&t.forEach(u=>p(i,u.id))};return j.useEffect(()=>((async()=>{const i=await M(),u=_.api+_.planningFrequiencies+`?fiscal_year_id=${l==null?void 0:l.id}`,c={Authorization:`Bearer ${i}`,accept:"application/json","Content-Type":"application/json"};fetch(u,{method:"GET",headers:c}).then(f=>f.json()).then(f=>{f.success?(P(f.data),C(f.data),s(!1),b(!1)):(s(!1),b(!1))}).catch(f=>{F.error(f.message),b(!0),s(!1)})})(),()=>{}),[l.id]),e.jsxs(v,{children:[o?e.jsx(w,{container:!0,children:e.jsx(w,{item:!0,xs:12,sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",padding:8},children:e.jsx(L,{size:20})})}):m?e.jsx(U,{image:Z,title:"Server Error",message:"Unable to retrive frequency"}):e.jsxs(Y,{sx:{borderRadius:n.shape.borderRadius},children:[e.jsx(G,{children:e.jsxs($,{children:[e.jsx(I,{sx:{minWidth:170},children:"KPI Name"}),e.jsx(I,{sx:{minWidth:60},children:"Frequency"})]})}),e.jsx(V,{children:t==null?void 0:t.map((h,i)=>e.jsxs($,{children:[e.jsx(I,{children:h.name}),e.jsx(I,{children:e.jsx(we,{menu:d,selected:h==null?void 0:h.f_name,onSelect:u=>p(u,h.id)})})]},i))})]}),e.jsx(B,{})]})},te=()=>{const n=q(),{selectedKpi:t,addOrRemoveKPI:r,updateKPI:o}=z(),[s,d]=j.useState(!0),[P,m]=j.useState([]),[b,l]=j.useState(!1),p=(i,u)=>{const c=u,f=t,a=c.filter(x=>!f.some(S=>S.id===x.id)),g=f.filter(x=>!c.some(S=>S.id===x.id));a.forEach(x=>r(x)),g.forEach(x=>r(x))},C=(i,u)=>{const c=i.target.value;o(u,{weight:c})},h=(i,u)=>{const c=i.target.value;o(u,{total_target:c})};return j.useEffect(()=>((()=>{const u=localStorage.getItem("token"),c=_.api+_.kpi,f={Authorization:`Bearer ${u}`,accept:"application/json","Content-Type":"application/json"};fetch(c,{method:"GET",headers:f}).then(a=>a.json()).then(a=>{a.success?(m(a.data.data),d(!1),l(!1)):(d(!1),l(!1))}).catch(a=>{F.error(a.message),l(!0),d(!1)})})(),()=>{}),[]),e.jsxs(v,{children:[s?e.jsx(w,{container:!0,children:e.jsx(w,{item:!0,xs:12,sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",padding:8},children:e.jsx(L,{size:20})})}):b?e.jsx(U,{image:Z,title:"Server Error",message:"Unable to retrive kpi"}):e.jsxs(e.Fragment,{children:[e.jsx(v,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:e.jsx(ve,{id:"kpi-list",multiple:!0,options:P,getOptionLabel:i=>i.name,value:t,onChange:p,isOptionEqualToValue:(i,u)=>i.id===u.id,renderTags:(i,u)=>i.map((c,f)=>e.jsx(ce,{label:c.name,...u({index:f})})),fullWidth:!0,renderInput:i=>e.jsx(X,{...i,label:"Select a KPI",variant:"outlined"}),disableClearable:!0})}),e.jsx(v,{sx:{padding:2},children:e.jsxs(Y,{children:[e.jsx(G,{children:e.jsxs($,{children:[e.jsx(I,{sx:{minWidth:130},children:"KPI Name"}),e.jsx(I,{sx:{minWidth:60},children:"Weight(%)"}),e.jsx(I,{sx:{minWidth:100},children:"Measured by"}),e.jsx(I,{sx:{minWidth:120},children:"Target"})]})}),e.jsx(V,{children:t==null?void 0:t.map((i,u)=>e.jsxs($,{children:[e.jsx(I,{children:i.name}),e.jsx(I,{children:e.jsx(O,{sx:{p:.5,border:1,borderRadius:2,borderColor:n.palette.primary.main},value:i.weight,onChange:c=>C(c,i.id),inputProps:{"aria-label":"weight"},type:"number"})}),e.jsx(I,{sx:{textTransform:"capitalize"},children:i.mu}),e.jsx(I,{children:e.jsx(O,{sx:{p:.5,border:1,borderRadius:2,borderColor:n.palette.primary.main},value:i.total_target,onChange:c=>h(c,i.id),inputProps:{"aria-label":"target"},type:"number"})})]},u))})]})})]}),e.jsx(B,{})]})},ae=()=>{const n=q(),{selectedKpi:t,distributeTarget:r}=z(),[o,s]=j.useState(!0),[d,P]=j.useState([]),[m,b]=j.useState(!1),[l,p]=j.useState(),C=R(a=>a.customization.selectedFiscalYear),h=(a,g,x)=>{const S=a.target.value;r(S,g,x)},i=(a,g)=>{l===a?p(null):(p(a),f(g))},u=(a,g)=>g>1?a+1:"",c=a=>{const g=(a==null?void 0:a.total_target)/a.f_value;d&&d.forEach(x=>r(g,a.id,x.id))},f=async a=>{s(!0),P([]);const g=await M(),x=_.api+_.planningPeriods+`?fiscal_year=${C==null?void 0:C.id}&frequency_id=${a}&type=planning`,S={Authorization:`Bearer ${g}`,accept:"application/json","Content-Type":"application/json"};fetch(x,{method:"GET",headers:S}).then(T=>T.json()).then(T=>{T.success?(P(T.data.periods),s(!1),b(!1)):(s(!1),b(!1))}).catch(T=>{F.error(T.message),b(!0),s(!1)})};return e.jsxs(v,{children:[t==null?void 0:t.map((a,g)=>e.jsxs(v,{sx:{marginY:2},children:[e.jsxs(H,{sx:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",padding:1.6,border:.6,borderColor:n.palette.divider,backgroundColor:n.palette.primary.light,cursor:"pointer",marginY:.4},onClick:()=>i(g,a.frequency_id),children:[e.jsx(E,{variant:"h4",children:a==null?void 0:a.name}),e.jsxs(v,{children:[e.jsx(E,{variant:"caption",children:" Total target"}),e.jsxs(E,{variant:"subtitle1",children:[" ",a==null?void 0:a.total_target,de(a==null?void 0:a.mu)]})]}),e.jsxs(ue,{children:[" ",l===g?e.jsx(he,{size:18}):e.jsx(ge,{size:18})," "]})]}),l===g&&e.jsxs(v,{sx:{padding:1.6,marginY:.4},children:[e.jsxs(w,{container:!0,children:[e.jsx(w,{item:!0,xs:12,sm:12,md:6,children:e.jsxs(v,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(E,{variant:"subtitle1",color:n.palette.text.primary,children:"Evaluated"}),e.jsx(E,{variant:"subtitle1",sx:{backgroundColor:n.palette.grey[100],color:n.palette.text.primary,paddingY:.4,paddingX:2,borderRadius:20,marginLeft:1},children:a.f_name})]})}),e.jsx(w,{item:!0,xs:12,sm:12,md:6,sx:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx(J,{title:"Evenly Distribute",variant:"outlined",onPress:()=>c(a),disabled:d.length===0})})]}),e.jsx(v,{sx:{marginTop:2,minHeight:"10dvh"},children:o?e.jsx(v,{sx:{display:"flex",alignItems:"center",justifyContent:"center",padding:2},children:e.jsx(Q,{size:20})}):m?e.jsx(E,{variant:"subtitle1",children:"Error fetching periods"}):d.length===0?e.jsx(E,{variant:"subtitle1",children:"Please set period first"}):e.jsx(w,{container:!0,spacing:2,children:d==null?void 0:d.map((x,S)=>{var y;const T=(y=a.targets)==null?void 0:y.find(K=>K.period_id===x.id);return e.jsx(w,{item:!0,xs:12,sm:6,md:4,children:e.jsx(X,{type:"number",label:`${xe(a==null?void 0:a.f_name)} ${u(S,a.f_value)}`,variant:"outlined",fullWidth:!0,margin:"normal",value:T?T.target:"",onChange:K=>h(K,a==null?void 0:a.id,x.id)})},x.id)})})})]})]},g)),e.jsx(B,{})]})},De=[{id:2,name:"Select KPI",component:e.jsx(te,{})},{id:3,name:"Select Frequency",component:e.jsx(ee,{})},{id:4,name:"Target Distribution",component:e.jsx(ae,{})}],D=[{id:2,name:"Selected KPI",component:e.jsx(te,{})},{id:3,name:"Selected Frequency",component:e.jsx(ee,{})},{id:4,name:"Target Distribution",component:e.jsx(ae,{})}],Ee=n=>{const t=[];let r=!0,o=0;return n.length===0&&(r=!1,t.push("Please select KPI before proceeding")),n.forEach(s=>{s.weight===""?(r=!1,t.push(`The ${s.name} KPI Weight is required.`)):isNaN(s.weight)?(r=!1,t.push(`The ${s.name} KPI weight must be a number.`)):s.weight==0?(r=!1,t.push(`The ${s.name} KPI weight cannot be 0`)):s.weight<0?(r=!1,t.push(`The ${s.name} KPI weight cannot be negative.`)):s.weight>100?(r=!1,t.push(`The ${s.name} KPI Weight exceeded 100%`)):o+=parseFloat(s.weight),s.total_target===""?(r=!1,t.push(`The ${s.name} KPI target is not set.`)):isNaN(s.total_target)?(r=!1,t.push(`The ${s.name} KPI target should be a number.`)):s.total_target==0?(r=!1,t.push(`The ${s.name} KPI target cannot be 0`)):s.total_target<0&&(r=!1,t.push(`The ${s.name} KPI target cannot be negative.`))}),o>100&&(r=!1,t.push("The sum of KPI weights exceeded 100%.")),{valid:r,errors:t}},_e=n=>{const t=[];let r=!0;return n.forEach(o=>{o.frequency_id||(r=!1,t.push(`Please select the ${o.name} KPI evaluation frequency`))}),{valid:r,errors:t}},Ke=n=>{const t=[];let r=!0;return n.forEach(o=>{if(!o.targets)r=!1,t.push(`The ${o.name} KPI is not distributed`);else{let s=0;o==null||o.targets.forEach(d=>{!d.target||d.target===""?(r=!1,t.push(`Please check ${o.name} KPI input fields, there is a period with missing value`)):isNaN(d.target)&&(r=!1,t.push(`The ${o.name} KPI distributed target should be a number.`)),s+=parseFloat(d==null?void 0:d.target)}),s<(o==null?void 0:o.total_target)&&(r=!1,t.push(`The ${o.name} KPI total target is not fully distributed | distributed: ${s} `))}}),{valid:r,errors:t}},Ae=({add:n,onClose:t,onSucceed:r})=>{const o=q(),{selectedKpi:s}=z(),[d,P]=j.useState(!1),[m,b]=j.useState(0),[l,p]=j.useState({state:!1,message:""}),C=()=>{if(m===0){const c=Ee(s);c.valid?(p({...l,state:!1,message:""}),b(m+1)):p({...l,state:!0,message:c.errors[0]})}else if(m===1){const c=_e(s);c.valid?(p({...l,state:!1,message:""}),b(m+1)):p({...l,state:!0,message:c.errors[0]})}},h=()=>{p({...l,state:!1,message:""}),b(m-1)},i=()=>{const c=Ke(s);c.valid?(p({...l,state:!1,message:""}),u(s)):p({...l,state:!0,message:c.errors[0]})},u=async c=>{P(!0);const f=await M(),a=ye.getItem("selectFiscal"),g=JSON.parse(a),x=_.api+_.orgPlan,S={Authorization:`Bearer ${f}`,accept:"application/json","Content-Type":"application/json"},T={fiscal_year_id:g==null?void 0:g.id,data:c};fetch(x,{method:"POST",headers:S,body:JSON.stringify(T)}).then(y=>y.json()).then(y=>{var K,N;y.success?(F.success((K=y==null?void 0:y.data)==null?void 0:K.message),r(),t()):F.error((N=y==null?void 0:y.data)==null?void 0:N.message)}).catch(y=>{F.error(y.message)}).finally(()=>{P(!1)})};return e.jsx(j.Fragment,{children:e.jsx(me,{open:n,onClose:t,children:s&&e.jsxs(H,{sx:{minWidth:"600px",minHeight:"50dvh",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsxs(v,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingRight:1},children:[e.jsx(fe,{variant:"h3",color:o.palette.text.primary,fontSize:o.typography.h3,children:D[m].name}),e.jsx(je.div,{whileHover:{rotate:90},transition:{duration:.3},style:{cursor:"pointer",marginRight:10},onClick:t,children:e.jsx(pe,{size:"1.4rem",stroke:2})})]}),e.jsx(v,{sx:{padding:3},children:D[m].component})]}),e.jsxs(be,{sx:{paddingX:3,paddingBottom:2},children:[l.state&&e.jsxs(Ie,{severity:"error",children:[" ",l.message]}),m>0&&e.jsx(A,{onClick:()=>h(),sx:{paddingX:4,paddingY:1,marginRight:2},children:"Back"}),m===D.length-1?e.jsx(A,{type:"submit",variant:"contained",sx:{paddingX:6,paddingY:1,boxShadow:0},onClick:()=>i(),children:d?e.jsx(Q,{size:18,sx:{color:"white"}}):e.jsx(E,{variant:"subtitle1",color:"white",children:"Submit"})}):e.jsx(J,{type:"button",title:"Next",variant:"contained",sx:{paddingX:6,paddingY:1,boxShadow:0},onPress:()=>C()})]})]})})})},Re=()=>{const n=R(t=>t.user.user);if(n!=null&&n.roles){const t=n.roles.map(r=>r.name.trim().toLowerCase());return t.length===1&&t.includes("employee")}return!1};export{De as C,Ke as D,_e as F,Re as I,Ee as S,Ae as U};
